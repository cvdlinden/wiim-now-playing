{"mappings":"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","sources":["<anon>","src/js/debug.js"],"sourcesContent":["var $4165fb5e9d27a5f7$exports = {};\n// =======================================================\n// WiiM Now Playing\n// Debugging script for the WiiM Now Playing server\n// Namespacing\nwindow.WNP = window.WNP || {};\n// Default settings\nWNP.s = {\n    // Host runs on default port 80, but in cases where another port is chosen adapt\n    locHostname: location.hostname,\n    locPort: location.port && location.port != \"80\" && location.port != \"1234\" ? location.port : \"80\",\n    rndAlbumArtUri: \"./img/fake-album-1.jpg\",\n    // Device selection\n    aDeviceUI: [\n        \"btnRefresh\",\n        \"selDeviceChoices\",\n        \"devName\",\n        \"mediaTitle\",\n        \"mediaSubTitle\",\n        \"mediaArtist\",\n        \"mediaAlbum\",\n        \"mediaBitRate\",\n        \"mediaBitDepth\",\n        \"mediaSampleRate\",\n        \"mediaQualityIdent\",\n        \"devVol\",\n        \"mediaSource\"\n    ],\n    // Server actions to be used in the app\n    aServerUI: [\n        \"btnReboot\",\n        \"btnUpdate\",\n        \"btnShutdown\",\n        \"btnReloadUI\",\n        \"sServerUrlHostname\",\n        \"sServerUrlIP\",\n        \"sServerVersion\",\n        \"sClientVersion\",\n        \"chkLyricsEnabled\"\n    ],\n    // Ticks to be used in the app (debug)\n    aTicksUI: [\n        \"tickDevicesGetUp\",\n        \"tickDevicesRefreshUp\",\n        \"tickServerSettingsUp\",\n        \"tickStateUp\",\n        \"tickStateDown\",\n        \"tickMetadataUp\",\n        \"tickMetadataDown\",\n        \"tickLyricsUp\",\n        \"tickLyricsDown\",\n        \"tickDeviceSetUp\",\n        \"tickDeviceSetDown\",\n        \"tickServerSettingsDown\",\n        \"tickDevicesGetDown\",\n        \"tickDevicesRefreshDown\",\n        \"tickVolumeGetUp\",\n        \"tickVolumeGetDown\",\n        \"tickVolumeSetUp\",\n        \"tickVolumeSetDown\",\n        \"tickPresetsListUp\",\n        \"tickPresetsListDown\"\n    ],\n    // Debug UI elements\n    // aDebugUI: [\"state\", \"metadata\", \"lyrics\", \"lyricsStatus\", \"lyricsProvider\", \"lyricsTrackKey\", \"lyricsCacheEnabled\", \"lyricsCacheStatus\", \"lyricsCacheSize\", \"lyricsCacheMax\", \"lyricsCachePrefetchMode\", \"lyricsCachePrefetchConcurrency\", \"lyricsPrefetch\", \"lyricsPrefetchStatus\", \"lyricsPrefetchTrackKey\", \"lyricsPrefetchMode\", \"lyricsPrefetchReason\", \"sPresetsList\", \"sServerSettings\", \"sManufacturer\", \"sModelName\", \"sLocation\", \"sTimeStampDiff\", \"sAlbumArtUri\", \"sAlbumArtUriRaw\", \"sAlbumArtUriStatus\", \"oPresetsGroup\", \"btnDevices\", \"btnGetVolume\", \"btnSetVolume\", \"mediaLoopMode\", \"sTransportState\", \"sPlayMedium\", \"sPlayerProgress\"]\n    aDebugUI: [\n        \"state\",\n        \"metadata\",\n        \"lyrics\",\n        \"lyricsStatus\",\n        \"lyricsTrackKey\",\n        \"sPresetsList\",\n        \"sServerSettings\",\n        \"sManufacturer\",\n        \"sModelName\",\n        \"sLocation\",\n        \"sTimeStampDiff\",\n        \"sAlbumArtUri\",\n        \"sAlbumArtUriRaw\",\n        \"sAlbumArtUriStatus\",\n        \"oPresetsGroup\",\n        \"btnDevices\",\n        \"btnGetVolume\",\n        \"btnSetVolume\",\n        \"mediaLoopMode\",\n        \"sTransportState\",\n        \"sPlayMedium\",\n        \"sPlayerProgress\"\n    ]\n};\n// Data placeholders.\nWNP.d = {\n    serverSettings: null,\n    deviceList: null,\n    prevTransportState: null,\n    prevPlayMedium: null,\n    prevSourceIdent: null,\n    prevTrackInfo: null // Previous track info, used to detect changes in the metadata\n};\n// Reference placeholders.\n// These are set in the init function\n// and are used to reference the UI elements in the app.\nWNP.r = {};\n/**\r\n * Initialisation of app.\r\n * @returns {undefined}\r\n */ WNP.Init = function() {\n    console.log(\"WNP\", \"Initialising...\");\n    // Init Socket.IO, connect to port where server resides\n    console.log(\"WNP\", \"Listening on \" + this.s.locHostname + \":\" + this.s.locPort);\n    window.socket = io.connect(\":\" + this.s.locPort);\n    // Set references to the UI elements\n    this.setUIReferences();\n    // Set tick handlers\n    this.setTickHandlers();\n    // Set Socket.IO definitions\n    this.setSocketDefinitions();\n    // Set UI event listeners\n    this.setUIListeners();\n    // Initial calls, wait a bit for socket to start\n    setTimeout(()=>{\n        // Get server settings\n        this.r.tickServerSettingsUp.classList.add(\"tickAnimate\");\n        socket.emit(\"server-settings\");\n        // Get devices\n        this.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"devices-get\");\n        // // Get volume\n        // this.r.tickVolumeGetUp.classList.add(\"tickAnimate\");\n        // socket.emit(\"device-api\", \"getPlayerStatus\");\n        // Get presets\n        this.r.tickPresetsListUp.classList.add(\"tickAnimate\");\n        socket.emit(\"device-api\", \"getPresetInfo\");\n    }, 500);\n    // Create random album intervals, every 3 minutes\n    WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\n    var rndAlbumInterval = setInterval(function() {\n        WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\n    }, 180000);\n};\n/**\r\n * Reference to the UI elements of the app.\r\n * @returns {undefined}\r\n */ WNP.setUIReferences = function() {\n    console.log(\"WNP\", \"Set UI references...\");\n    function addElementToRef(id) {\n        const element = document.getElementById(id);\n        if (element) WNP.r[id] = element;\n        else console.warn(\"WNP\", `Element with ID '${id}' not found in current HTML.`);\n    }\n    // Set references to the UI elements\n    this.s.aDeviceUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n    this.s.aServerUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n    this.s.aTicksUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n    this.s.aDebugUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n};\n/**\r\n * Set the tick event handlers for the app.\r\n * @returns {undefined}\r\n */ WNP.setTickHandlers = function() {\n    function removeTickAnimate(e) {\n        e.target.classList.remove(\"tickAnimate\");\n    }\n    // Set the tick handlers for the app\n    this.s.aTicksUI.forEach((tick)=>{\n        if (this.r[tick]) this.r[tick].addEventListener(\"animationend\", removeTickAnimate);\n        else console.warn(\"WNP\", `Element with ID '${tick}' not found.`);\n    });\n};\n/**\r\n * Setting the listeners on the UI elements of the app.\r\n * @returns {undefined}\r\n */ WNP.setUIListeners = function() {\n    console.log(\"WNP\", \"Set UI Listeners...\");\n    // ------------------------------------------------\n    // Player buttons\n    // (no player buttons in debug mode)\n    // ------------------------------------------------\n    // Settings buttons\n    // Device selection dropdown\n    this.r.selDeviceChoices.addEventListener(\"change\", function() {\n        WNP.r.tickDeviceSetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"device-set\", this.value);\n    });\n    // Devices get button\n    this.r.btnDevices.addEventListener(\"click\", function() {\n        WNP.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"devices-get\");\n    });\n    // Refresh devices button\n    this.r.btnRefresh.addEventListener(\"click\", function() {\n        WNP.r.tickDevicesRefreshUp.classList.add(\"tickAnimate\");\n        socket.emit(\"devices-refresh\");\n        // Wait for discovery to finish\n        setTimeout(()=>{\n            WNP.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\n            socket.emit(\"devices-get\");\n            WNP.r.tickServerSettingsUp.classList.add(\"tickAnimate\");\n            socket.emit(\"server-settings\");\n            WNP.r.tickPresetsListUp.classList.add(\"tickAnimate\");\n            socket.emit(\"device-api\", \"getPresetInfo\");\n        }, 5000);\n    });\n    // Get volume button\n    this.r.btnGetVolume.addEventListener(\"click\", function() {\n        WNP.r.tickVolumeGetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"device-api\", \"getPlayerStatus\");\n    });\n    // Set volume button\n    this.r.btnSetVolume.addEventListener(\"click\", function() {\n        var volume = parseInt(WNP.r.devVol.value);\n        if (isNaN(volume) || volume < 0 || volume > 100) {\n            alert(\"Please enter a valid volume between 0 and 100.\");\n            return;\n        }\n        WNP.r.tickVolumeSetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"device-api\", \"setPlayerCmd:vol:\" + volume);\n    });\n    // Reboot button\n    this.r.btnReboot.addEventListener(\"click\", function() {\n        socket.emit(\"server-reboot\");\n    });\n    // Update button\n    this.r.btnUpdate.addEventListener(\"click\", function() {\n        socket.emit(\"server-update\");\n    });\n    // Shutdown button\n    this.r.btnShutdown.addEventListener(\"click\", function() {\n        socket.emit(\"server-shutdown\");\n    });\n    // Reload UI button\n    this.r.btnReloadUI.addEventListener(\"click\", function() {\n        location.reload();\n    });\n    // Lyrics toggle\n    this.r.chkLyricsEnabled.addEventListener(\"change\", function() {\n        socket.emit(\"server-settings-update\", {\n            features: {\n                lyrics: {\n                    enabled: this.checked\n                }\n            }\n        });\n    });\n};\n/**\r\n * Set the socket definitions to listen for specific websocket traffic and handle accordingly.\r\n * @returns {undefined}\r\n */ WNP.setSocketDefinitions = function() {\n    console.log(\"WNP\", \"Setting Socket definitions...\");\n    // On server settings\n    socket.on(\"server-settings\", function(msg) {\n        console.log(\"IO: server-settings\", msg);\n        WNP.r.tickServerSettingsDown.classList.add(\"tickAnimate\");\n        // Store server settings\n        WNP.d.serverSettings = msg;\n        WNP.r.sServerSettings.innerHTML = JSON.stringify(msg);\n        // RPi has bash, so possibly able to reboot/shutdown.\n        if (msg && msg.os && msg.os.userInfo && msg.os.userInfo.shell === \"/bin/bash\") {\n            WNP.r.btnReboot.disabled = false;\n            WNP.r.btnUpdate.disabled = false;\n            WNP.r.btnShutdown.disabled = false;\n        }\n        // Set device name\n        WNP.r.devName.innerText = msg && msg.selectedDevice && msg.selectedDevice.friendlyName ? msg.selectedDevice.friendlyName : \"-\";\n        WNP.r.sManufacturer.innerText = msg && msg.selectedDevice && msg.selectedDevice.manufacturer ? msg.selectedDevice.manufacturer : \"-\";\n        WNP.r.sModelName.innerText = msg && msg.selectedDevice && msg.selectedDevice.modelName ? msg.selectedDevice.modelName : \"-\";\n        WNP.r.sLocation.innerHTML = msg && msg.selectedDevice && msg.selectedDevice.location ? \"<a href=\\\"\" + msg.selectedDevice.location + \"\\\">\" + msg.selectedDevice.location + \"</a>\" : \"-\";\n        // Set the server local url\n        if (msg && msg.os && msg.os.hostname) {\n            var sUrl = \"http://\" + msg.os.hostname.toLowerCase() + \".local\";\n            sUrl += location && location.port && location.port != 80 ? \":\" + location.port + \"/\" : \"/\";\n            WNP.r.sServerUrlHostname.innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\n        } else WNP.r.sServerUrlHostname.innerText = \"-\";\n        // Set the server ip address\n        if (msg && msg.selectedDevice && msg.selectedDevice.location && msg.os && msg.os.networkInterfaces) {\n            // Grab the ip address pattern of the selected device\n            // Assumption is that the wiim-now-playing server is on the same ip range as the client..\n            var sLocationIp = msg.selectedDevice.location.split(\"/\")[2]; // Extract ip address from location\n            var aIpAddress = sLocationIp.split(\".\"); // Split ip address in parts\n            aIpAddress.pop(); // Remove the last part\n            var sIpPattern = aIpAddress.join(\".\"); // Construct ip address pattern\n            // Search for server ip address(es) in this range...\n            Object.keys(msg.os.networkInterfaces).forEach(function(key, index) {\n                var sIpFound = msg.os.networkInterfaces[key].find((addr)=>addr.address.startsWith(sIpPattern));\n                if (sIpFound) {\n                    // Construct ip address and optional port\n                    var sUrl = \"http://\" + sIpFound.address;\n                    sUrl += location && location.port && location.port != 80 ? \":\" + location.port + \"/\" : \"/\";\n                    WNP.r.sServerUrlIP.innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\n                }\n            });\n        } else WNP.r.sServerUrlIP.innerText = \"-\";\n        // Set the server version\n        WNP.r.sServerVersion.innerText = msg && msg.version && msg.version.server ? msg.version.server : \"-\";\n        // Set the client version\n        WNP.r.sClientVersion.innerText = msg && msg.version && msg.version.client ? msg.version.client : \"-\";\n        // Lyrics enabled/disabled\n        if (WNP.r.chkLyricsEnabled) WNP.r.chkLyricsEnabled.checked = Boolean(msg && msg.features && msg.features.lyrics && msg.features.lyrics.enabled);\n        WNP.updateLyricsCacheSettings();\n    });\n    // On devices get\n    socket.on(\"devices-get\", function(msg) {\n        console.log(\"IO: devices-get\", msg);\n        WNP.r.tickDevicesGetDown.classList.add(\"tickAnimate\");\n        // Store and sort device list\n        WNP.d.deviceList = msg;\n        WNP.d.deviceList.sort((a, b)=>{\n            return a.friendlyName < b.friendlyName ? -1 : 1;\n        });\n        // Clear choices\n        WNP.r.selDeviceChoices.innerHTML = \"<option value=\\\"\\\">Select a device...</em></li>\";\n        // Add WiiM devices\n        var devicesWiiM = WNP.d.deviceList.filter((d)=>{\n            return d.manufacturer.startsWith(\"Linkplay\");\n        });\n        if (devicesWiiM.length > 0) {\n            // Device select options\n            var optGroup = document.createElement(\"optgroup\");\n            optGroup.label = \"WiiM devices\";\n            devicesWiiM.forEach((device)=>{\n                var opt = document.createElement(\"option\");\n                opt.value = device.location;\n                opt.innerText = device.friendlyName;\n                opt.title = \"By \" + device.manufacturer;\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) opt.setAttribute(\"selected\", \"selected\");\n                optGroup.appendChild(opt);\n            });\n            WNP.r.selDeviceChoices.appendChild(optGroup);\n        }\n        // Other devices\n        // Possibly removing this section in future releases.\n        var devicesOther = WNP.d.deviceList.filter((d)=>{\n            return !d.manufacturer.startsWith(\"Linkplay\");\n        });\n        if (devicesOther.length > 0) {\n            // Device select dropdown options\n            var optGroup = document.createElement(\"optgroup\");\n            optGroup.label = \"Other devices\";\n            devicesOther.forEach((device)=>{\n                var opt = document.createElement(\"option\");\n                opt.value = device.location;\n                opt.innerText = device.friendlyName;\n                opt.title = \"By \" + device.manufacturer;\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) opt.setAttribute(\"selected\", \"selected\");\n                optGroup.appendChild(opt);\n            });\n            WNP.r.selDeviceChoices.appendChild(optGroup);\n        }\n        // No devices found\n        if (devicesWiiM.length == 0 && devicesOther.length == 0) WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">No devices found!</em></li>\";\n    });\n    // On state\n    socket.on(\"state\", function(msg) {\n        if (!msg) return false;\n        WNP.r.tickStateDown.classList.add(\"tickAnimate\");\n        WNP.r.state.innerHTML = JSON.stringify(msg);\n        // Get player progress data from the state message.\n        var timeStampDiff = 0;\n        if (msg.CurrentTransportState === \"PLAYING\") timeStampDiff = msg.stateTimeStamp && msg.metadataTimeStamp ? Math.round((msg.stateTimeStamp - msg.metadataTimeStamp) / 1000) : 0;\n        var relTime = msg.RelTime ? msg.RelTime : \"00:00:00\";\n        var trackDuration = msg.TrackDuration ? msg.TrackDuration : \"00:00:00\";\n        WNP.r.sTimeStampDiff.innerHTML = timeStampDiff + \"s\";\n        // Get current player progress and set UI elements accordingly.\n        var oPlayerProgress = WNP.getPlayerProgress(relTime, trackDuration, timeStampDiff, msg.CurrentTransportState);\n        WNP.r.sPlayerProgress.innerText = JSON.stringify(oPlayerProgress);\n        // Device transport state or play medium changed...?\n        if (WNP.d.prevTransportState !== msg.CurrentTransportState || WNP.d.prevPlayMedium !== msg.PlayMedium) {\n            WNP.r.sTransportState.innerText = msg.CurrentTransportState;\n            WNP.r.sPlayMedium.innerText = msg.PlayMedium;\n            WNP.d.prevTransportState = msg.CurrentTransportState; // Remember the last transport state\n            WNP.d.prevPlayMedium = msg.PlayMedium; // Remember the last PlayMedium\n        }\n    });\n    // On metadata\n    socket.on(\"metadata\", function(msg) {\n        if (!msg) return false;\n        WNP.r.tickMetadataDown.classList.add(\"tickAnimate\");\n        WNP.r.metadata.innerHTML = JSON.stringify(msg);\n        // Source detection\n        var playMedium = msg.PlayMedium ? msg.PlayMedium : \"\";\n        var trackSource = msg.TrackSource ? msg.TrackSource : \"\";\n        var sourceIdent = WNP.getSourceIdent(playMedium, trackSource);\n        // Did the source ident change...?\n        if (sourceIdent !== WNP.d.prevSourceIdent) {\n            if (sourceIdent !== \"\") mediaSource.innerText = playMedium + \": \" + trackSource + \" (\" + sourceIdent + \")\";\n            else mediaSource.innerText = playMedium + \": \" + trackSource;\n            WNP.d.prevSourceIdent = sourceIdent; // Remember the last Source Ident\n        }\n        // Song Title, Subtitle, Artist, Album\n        WNP.r.mediaTitle.innerText = msg.trackMetaData && msg.trackMetaData[\"dc:title\"] ? msg.trackMetaData[\"dc:title\"] : \"\";\n        WNP.r.mediaSubTitle.innerText = msg.trackMetaData && msg.trackMetaData[\"dc:subtitle\"] ? msg.trackMetaData[\"dc:subtitle\"] : \"\";\n        WNP.r.mediaArtist.innerText = msg.trackMetaData && msg.trackMetaData[\"upnp:artist\"] ? msg.trackMetaData[\"upnp:artist\"] : \"\";\n        WNP.r.mediaAlbum.innerText = msg.trackMetaData && msg.trackMetaData[\"upnp:album\"] ? msg.trackMetaData[\"upnp:album\"] : \"\";\n        // Audio quality\n        var songBitrate = msg.trackMetaData && msg.trackMetaData[\"song:bitrate\"] ? msg.trackMetaData[\"song:bitrate\"] : \"\";\n        var songBitDepth = msg.trackMetaData && msg.trackMetaData[\"song:format_s\"] ? msg.trackMetaData[\"song:format_s\"] : \"\";\n        var songSampleRate = msg.trackMetaData && msg.trackMetaData[\"song:rate_hz\"] ? msg.trackMetaData[\"song:rate_hz\"] : \"\";\n        WNP.r.mediaBitRate.innerText = songBitrate > 0 ? songBitrate > 1000 ? (songBitrate / 1000).toFixed(2) + \" mbps (\" + songBitrate + \")\" : songBitrate + \" kbps (\" + songBitrate + \")\" : \"\";\n        WNP.r.mediaBitDepth.innerText = songBitDepth > 0 ? songBitDepth > 24 ? \"24 bit (\" + songBitDepth + \")\" : songBitDepth + \" bit (\" + songBitDepth + \")\" : \"\";\n        WNP.r.mediaSampleRate.innerText = songSampleRate > 0 ? (songSampleRate / 1000).toFixed(1) + \" kHz (\" + songSampleRate + \")\" : \"\";\n        // Audio quality ident badge (HD/Hi-res/CD/...)\n        var songQuality = msg.trackMetaData && msg.trackMetaData[\"song:quality\"] ? msg.trackMetaData[\"song:quality\"] : \"\";\n        var songActualQuality = msg.trackMetaData && msg.trackMetaData[\"song:actualQuality\"] ? msg.trackMetaData[\"song:actualQuality\"] : \"\";\n        var qualiIdent = WNP.getQualityIdent(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n        if (qualiIdent !== \"\") WNP.r.mediaQualityIdent.innerText = qualiIdent + \" (\" + songQuality + \", \" + songActualQuality + \")\";\n        else WNP.r.mediaQualityIdent.innerText = songQuality + \", \" + songActualQuality;\n        // Pre-process Album Art uri, if any is available from the metadata.\n        var albumArtUriRaw = msg.trackMetaData && msg.trackMetaData[\"upnp:albumArtURI\"] ? msg.trackMetaData[\"upnp:albumArtURI\"] : \"\";\n        var albumArtUri = WNP.checkAlbumArtURI(albumArtUriRaw, msg.metadataTimeStamp);\n        // Set Album Art, only if the track changed and the URI changed\n        var trackChanged = false;\n        var currentTrackInfo = WNP.r.mediaTitle.innerText + \"|\" + WNP.r.mediaSubTitle.innerText + \"|\" + WNP.r.mediaArtist.innerText + \"|\" + WNP.r.mediaAlbum.innerText;\n        var currentAlbumArt = WNP.r.sAlbumArtUri.innerText;\n        if (WNP.d.prevTrackInfo !== currentTrackInfo) {\n            trackChanged = true;\n            WNP.d.prevTrackInfo = currentTrackInfo; // Remember the last track info\n            console.log(\"WNP\", \"Track changed:\", currentTrackInfo);\n        }\n        if (trackChanged && currentAlbumArt != albumArtUri) {\n            WNP.r.sAlbumArtUriRaw.innerText = albumArtUriRaw;\n            WNP.r.sAlbumArtUri.innerText = albumArtUri;\n        }\n        // Device volume\n        WNP.r.devVol.value = msg.CurrentVolume ? msg.CurrentVolume : \"-\"; // Set the volume on the UI\n        // Loop mode status\n        if (msg.LoopMode) switch(msg.LoopMode){\n            case \"5\":\n                WNP.r.mediaLoopMode.innerText = \"Shuffle enabled, Repeat enabled - loop once\";\n                break;\n            case \"3\":\n                WNP.r.mediaLoopMode.innerText = \"Shuffle enabled, Repeat disabled\";\n                break;\n            case \"2\":\n                WNP.r.mediaLoopMode.innerText = \"Shuffle enabled, Repeat enabled - loop\";\n                break;\n            case \"1\":\n                WNP.r.mediaLoopMode.innerText = \"Shuffle disabled, Repeat enabled - loop once\";\n                break;\n            case \"0\":\n                WNP.r.mediaLoopMode.innerText = \"Shuffle disabled, Repeat enabled - loop\";\n                break;\n            default:\n                WNP.r.mediaLoopMode.innerText = \"Shuffle disabled, Repeat disabled\";\n        }\n        else WNP.r.mediaLoopMode.innerText = \"Unknown\";\n    });\n    // On lyrics\n    socket.on(\"lyrics\", function(msg) {\n        console.log(\"IO: lyrics\", msg);\n        WNP.r.tickLyricsDown.classList.add(\"tickAnimate\");\n        WNP.r.lyrics.innerHTML = JSON.stringify(msg);\n        WNP.r.lyricsStatus.innerText = msg && msg.status ? msg.status : \"-\";\n        // WNP.r.lyricsProvider.innerText = (msg && msg.provider) ? msg.provider : \"-\";\n        WNP.r.lyricsTrackKey.innerText = msg && msg.trackKey ? msg.trackKey : \"-\";\n        // const diagnostics = msg?.diagnostics || {};\n        // if (WNP.r.lyricsCacheStatus) {\n        //     WNP.r.lyricsCacheStatus.innerText = diagnostics.cacheStatus || \"-\";\n        // }\n        // if (WNP.r.lyricsCacheSize) {\n        //     WNP.r.lyricsCacheSize.innerText = WNP.formatBytes(diagnostics.cacheSizeBytes);\n        // }\n        // if (WNP.r.lyricsCacheMax) {\n        //     WNP.r.lyricsCacheMax.innerText = WNP.formatBytes(diagnostics.cacheMaxBytes);\n        // }\n        WNP.updateLyricsCacheSettings();\n    });\n    // socket.on(\"lyrics-prefetch\", function (msg) {\n    //     console.log(\"IO: lyrics-prefetch\", msg);\n    //     if (WNP.r.lyricsPrefetch) {\n    //         WNP.r.lyricsPrefetch.innerHTML = JSON.stringify(msg);\n    //     }\n    //     if (WNP.r.lyricsPrefetchStatus) {\n    //         WNP.r.lyricsPrefetchStatus.innerText = (msg && msg.status) ? msg.status : \"-\";\n    //     }\n    //     if (WNP.r.lyricsPrefetchTrackKey) {\n    //         WNP.r.lyricsPrefetchTrackKey.innerText = (msg && msg.trackKey) ? msg.trackKey : \"-\";\n    //     }\n    //     if (WNP.r.lyricsPrefetchMode) {\n    //         WNP.r.lyricsPrefetchMode.innerText = (msg && msg.mode) ? msg.mode : \"-\";\n    //     }\n    //     if (WNP.r.lyricsPrefetchReason) {\n    //         WNP.r.lyricsPrefetchReason.innerText = (msg && msg.reason) ? msg.reason : \"-\";\n    //     }\n    // });\n    // On device set\n    socket.on(\"device-set\", function(msg) {\n        console.log(\"IO: device-set\", msg);\n        WNP.r.tickDeviceSetDown.classList.add(\"tickAnimate\");\n        // Device switch? Fetch settings and device info again.\n        WNP.r.tickServerSettingsUp.classList.add(\"tickAnimate\");\n        socket.emit(\"server-settings\");\n        WNP.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"devices-get\");\n        WNP.r.tickVolumeGetUp.classList.add(\"tickAnimate\");\n        socket.emit(\"device-api\", \"getPlayerStatus\");\n        WNP.r.tickPresetsListUp.classList.add(\"tickAnimate\");\n        socket.emit(\"device-api\", \"getPresetInfo\");\n    });\n    // On device refresh\n    socket.on(\"devices-refresh\", function(msg) {\n        console.log(\"IO: devices-refresh\", msg);\n        WNP.r.tickDevicesRefreshDown.classList.add(\"tickAnimate\");\n        WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">Waiting for devices...</em></li>\";\n    });\n    // On device action (i.e. for play, pause, next, previous)\n    socket.on(\"device-action\", function(msg, param) {\n        // Actions do not return a message.\n        // so we don't need to do anything here.\n        // Maybe later we can use this to show a notification or similar.\n        console.log(\"WNP\", \"Action:\", msg);\n    });\n    // On device API response\n    socket.on(\"device-api\", function(msg, param) {\n        console.log(\"IO: device-api\", msg, param);\n        switch(msg){\n            case \"getPresetInfo\":\n                // Preset info response\n                WNP.r.tickPresetsListDown.classList.add(\"tickAnimate\");\n                WNP.r.sPresetsList.innerHTML = param ? JSON.stringify(param) : \"\";\n                var sCurrentTitle = WNP.r.mediaTitle.innerText;\n                var sCurrentSubtitle = WNP.r.mediaSubTitle.innerText;\n                // Update preset buttons\n                if (WNP.r.oPresetsGroup) {\n                    WNP.r.oPresetsGroup.innerHTML = \"\";\n                    if (param && param.preset_list && param.preset_list.length > 0) param.preset_list.forEach((preset)=>{\n                        var btn = document.createElement(\"button\");\n                        btn.type = \"button\";\n                        btn.classList = \"btn btn-secondary\";\n                        btn.innerText = preset.number;\n                        btn.title = preset.name;\n                        if (preset.name === sCurrentTitle || preset.name === sCurrentSubtitle) btn.classList.add(\"active\");\n                        btn.addEventListener(\"click\", function() {\n                            // Load preset\n                            socket.emit(\"device-api\", \"MCUKeyShortClick:\" + preset.number);\n                            // Highlight button\n                            Array.from(WNP.r.oPresetsGroup.children).forEach((b)=>{\n                                b.classList.remove(\"active\");\n                            });\n                            btn.classList.add(\"active\");\n                        });\n                        WNP.r.oPresetsGroup.appendChild(btn);\n                    });\n                    else {\n                        var p = document.createElement(\"p\");\n                        p.classList = \"form-text text-white\";\n                        p.innerText = \"No presets found\";\n                        WNP.r.oPresetsGroup.appendChild(p);\n                    }\n                }\n                break;\n            case msg.startsWith(\"MCUKeyShortClick:\") ? msg : false:\n                break;\n            case \"getPlayerStatus\":\n                // Player status response\n                // Called when getting volume\n                WNP.r.tickVolumeGetDown.classList.add(\"tickAnimate\");\n                if (param && param.vol !== undefined) WNP.r.devVol.value = param.vol;\n                break;\n            case msg.startsWith(\"setPlayerCmd:vol:\") ? msg : false:\n                // Volume set response\n                WNP.r.tickVolumeSetDown.classList.add(\"tickAnimate\");\n                socket.emit(\"device-api\", \"getPlayerStatus\"); // Refresh volume UI\n                break;\n            default:\n                break;\n        }\n    });\n    // On server reboot\n    socket.on(\"server-reboot\", function(msg) {\n        // Possibly show a notification that reboot is in progress\n        console.log(\"WNP\", \"Server reboot:\", msg);\n    });\n    // On server update\n    socket.on(\"server-update\", function(msg) {\n        // Possibly show a notification that update is in progress\n        console.log(\"WNP\", \"Server update:\", msg);\n    });\n    // On server shutdown\n    socket.on(\"server-shutdown\", function(msg) {\n        // Possibly show a notification that shutdown is in progress\n        console.log(\"WNP\", \"Server shutdown:\", msg);\n    });\n};\n// =======================================================\n// Helper functions\n/**\r\n * Get player progress helper.\r\n * @param {string} relTime - Time elapsed while playing, format 00:00:00\r\n * @param {string} trackDuration - Total play time, format 00:00:00\r\n * @param {integer} timeStampDiff - Possible play time offset in seconds\r\n * @param {string} currentTransportState - The current transport state \"PLAYING\" or otherwise\r\n * @returns {object} An object with corrected played, left, total and percentage played\r\n */ WNP.getPlayerProgress = function(relTime, trackDuration, timeStampDiff, currentTransportState) {\n    var relTimeSec = this.convertToSeconds(relTime) + timeStampDiff;\n    var trackDurationSec = this.convertToSeconds(trackDuration);\n    if (trackDurationSec > 0 && relTimeSec < trackDurationSec) {\n        var percentPlayed = (relTimeSec / trackDurationSec * 100).toFixed(1);\n        return {\n            played: WNP.convertToMinutes(relTimeSec),\n            left: WNP.convertToMinutes(trackDurationSec - relTimeSec),\n            total: WNP.convertToMinutes(trackDurationSec),\n            percent: percentPlayed\n        };\n    } else if (trackDurationSec == 0 && currentTransportState == \"PLAYING\") return {\n        played: \"Live\",\n        left: \"\",\n        total: \"\",\n        percent: 100\n    };\n    else return {\n        played: \"Paused\",\n        left: \"\",\n        total: \"\",\n        percent: 0\n    };\n};\n/**\r\n * Convert time format '00:00:00' to total number of seconds.\r\n * @param {string} sDuration - Time, format 00:00:00.\r\n * @returns {integer} The number of seconds that the string represents.\r\n */ WNP.convertToSeconds = function(sDuration) {\n    const timeSections = sDuration.split(\":\");\n    let totalSeconds = 0;\n    for(let i = 0; i < timeSections.length; i++){\n        var nFactor = timeSections.length - 1 - i; // Count backwards\n        var nMultiplier = Math.pow(60, nFactor); // 60^n\n        totalSeconds += nMultiplier * parseInt(timeSections[i]); // Calculate the seconds\n    }\n    return totalSeconds;\n};\n/**\r\n * Convert number of seconds to '00:00' string format. \r\n * Sorry for those hour+ long songs...\r\n * @param {integer} seconds - Number of seconds total.\r\n * @returns {string} The string representation of seconds in minutes, format 00:00.\r\n */ WNP.convertToMinutes = function(seconds) {\n    var tempDate = new Date(0);\n    tempDate.setSeconds(seconds);\n    var result = tempDate.toISOString().substring(14, 19);\n    return result;\n};\n/**\r\n * Check if the album art is a valid URI. Returns the URI if valid, otherwise a random URI.\r\n * This function creates a virtual image element to check if the album art URI is valid.\r\n * @param {string} sAlbumArtUri - The URI of the album art.\r\n * @param {integer} nTimestamp - The time in milliseconds, used as cache buster.\r\n * @returns {string} The URI of the album art.\r\n */ WNP.checkAlbumArtURI = function(sAlbumArtUri, nTimestamp) {\n    // Create a virtual image element to check the album art URI behind the scenes\n    var img = new Image();\n    // On successful load\n    img.onload = function() {\n        console.log(\"WNP\", \"Album art loaded successfully.\", \"Size: \" + this.width + \"x\" + this.height + \"px\");\n        WNP.r.sAlbumArtUriStatus.classList = \"bi bi-check-circle-fill\";\n        WNP.r.sAlbumArtUriStatus.title = \"Able to load album art\";\n    };\n    // On error loading the image\n    img.onerror = function() {\n        console.error(\"WNP\", \"Failed to load album art:\", sAlbumArtUri);\n        WNP.r.sAlbumArtUriStatus.classList = \"bi bi-x-circle-fill\";\n        WNP.r.sAlbumArtUriStatus.title = \"Unable to load album art\";\n    };\n    // If the URI starts with https, the self signed certificate may not trusted by the browser.\n    // Hence we always try and load the image through a reverse proxy, ignoring the certificate.\n    if (sAlbumArtUri && sAlbumArtUri.startsWith(\"https\")) {\n        var sAlbumArtProxyUri = \"\";\n        if (WNP.s.locPort != \"80\") sAlbumArtProxyUri = \"http://\" + WNP.s.locHostname + \":\" + WNP.s.locPort + \"/proxy-art?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n        else sAlbumArtProxyUri = \"http://\" + WNP.s.locHostname + \"/proxy-art?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n        img.src = sAlbumArtProxyUri; // Test loading the image through the proxy\n        return sAlbumArtProxyUri;\n    } else if (sAlbumArtUri && sAlbumArtUri.startsWith(\"http\")) {\n        img.src = sAlbumArtUri; // Test loading the image directly\n        return sAlbumArtUri;\n    } else {\n        // Looks like an invalid/un_known album art, use the fallback.\n        WNP.r.sAlbumArtUriStatus.classList = \"bi bi-exclamation-circle-fill\";\n        WNP.r.sAlbumArtUriStatus.title = \"Falling back to random album art\";\n        return WNP.s.rndAlbumArtUri;\n    }\n};\n/**\r\n * Come up with a random album art URI (locally from the img folder).\r\n * @param {string} prefix - The prefix for the album art URI, i.e. 'fake-album-'\r\n * @returns {string} An URI for album art\r\n */ WNP.rndAlbumArt = function(prefix) {\n    return \"./img/\" + prefix + this.rndNumber(1, 16) + \".jpg\";\n};\n/**\r\n * Get a random number between min and max, including min and max.\r\n * @param {integer} min - Minimum number to pick, keep it lower than max.\r\n * @param {integer} max - Maximum number to pick.\r\n * @returns {integer} The random number\r\n */ WNP.rndNumber = function(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n/**\r\n * Get an identifier for the current play medium combined with the tracksource.\r\n * TODO: Verify all/most sources...\r\n * @param {string} playMedium - The PlayMedium as indicated by the device. Values: SONGLIST-NETWORK, RADIO-NETWORK, STATION-NETWORK, CAST, AIRPLAY, SPOTIFY, UNKOWN\r\n * @param {string} trackSource - The stream source as indicated by the device. Values: Prime, Qobuz, SPOTIFY, newTuneIn, iHeartRadio, Deezer, UPnPServer, Tidal, vTuner\r\n * @returns {string} The uri to the source identifier (image url)\r\n */ WNP.getSourceIdent = function(playMedium, trackSource) {\n    var sIdentUri = \"\";\n    switch(playMedium.toLowerCase()){\n        case \"airplay\":\n            sIdentUri = \"./img/sources/airplay2.png\";\n            break;\n        case \"third-dlna\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"cast\":\n            sIdentUri = \"./img/sources/chromecast2.png\";\n            break;\n        case \"radio-network\":\n            sIdentUri = \"./img/sources/radio.png\";\n            break;\n        case \"songlist-network\":\n            sIdentUri = \"./img/sources/ethernet2.png\";\n            break;\n        case \"spotify\":\n            sIdentUri = \"./img/sources/spotify.png\";\n            break;\n        case \"squeezelite\":\n            sIdentUri = \"./img/sources/music-assistant2.png\";\n            break;\n        case \"none\":\n            sIdentUri = \"./img/sources/none2.png\";\n            break;\n        case \"bluetooth\":\n            sIdentUri = \"./img/sources/bluetooth2.png\";\n            break;\n        case \"hdmi\":\n            sIdentUri = \"./img/sources/hdmi2.png\";\n            break;\n        case \"line-in\":\n            sIdentUri = \"./img/sources/line-in2.png\";\n            break;\n        case \"optical\":\n            sIdentUri = \"./img/sources/spdif2.png\";\n            break;\n    }\n    switch(trackSource.toLowerCase()){\n        case \"deezer\":\n        case \"deezer2\":\n            sIdentUri = \"./img/sources/deezer.png\";\n            break;\n        case \"iheartradio\":\n            sIdentUri = \"./img/sources/iheart.png\";\n            break;\n        case \"newtunein\":\n            sIdentUri = \"./img/sources/newtunein.png\";\n            break;\n        case \"plex\":\n            sIdentUri = \"./img/sources/plex.png\";\n            break;\n        case \"prime\":\n            sIdentUri = \"./img/sources/amazon-music2.png\";\n            break;\n        case \"qobuz\":\n            sIdentUri = \"./img/sources/qobuz2.png\";\n            break;\n        case \"tidal\":\n            sIdentUri = \"./img/sources/tidal2.png\";\n            break;\n        case \"upnpserver\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"vtuner\":\n            sIdentUri = \"./img/sources/vtuner2.png\";\n            break;\n    }\n    return sIdentUri;\n};\n/**\r\n * Get an identifier for the current audio/song quality.\r\n * TODO: Verify all/most sources...\r\n * Found so far:\r\n * \r\n * CD Quality: 44.1 KHz/16 bit. Bitrate 1,411 kbps. For mp3 bitrate can vary, but also be 320/192/160/128/... kbps.\r\n * Hi-Res quality: 96 kHz/24 bit and up. Bitrate 9,216 kbps.\r\n * \r\n * Spotify Lossless: bitrate 700 kbps, 44.1 kHz/24 bit\r\n * Spotify and Pandora usual bitrate 160 kbps, premium is 320 kbps\r\n * Tidal has CD quality, and FLAC, MQA, Master, ...\r\n * Qobuz apparently really has hi-res?\r\n * Amazon Music (Unlimited) does Atmos?\r\n * Apple Music -> Airplay 2, does hi-res?\r\n * YouTube Music -> Cast, does what?\r\n * \r\n * TIDAL -\r\n * Sample High: \"song:quality\":\"2\",\"song:actualQuality\":\"LOSSLESS\"\r\n * Sample MQA: \"song:quality\":\"3\",\"song:actualQuality\":\"HI_RES\"\r\n * Sample FLAC: \"song:quality\":\"4\",\"song:actualQuality\":\"HI_RES_LOSSLESS\"\r\n * \r\n * @param {integer} songQuality - A number identifying the quality, as indicated by the streaming service(?).\r\n * @param {string} songActualQuality - An indicator for the actual quality, as indicated by the streaming service(?).\r\n * @param {integer} songBitrate - The current bitrate in kilobit per second.\r\n * @param {integer} songBitDepth - The current sample depth in bits.\r\n * @param {integer} songSampleRate - The current sample rate in Hz.\r\n * @returns {string} The identifier for the audio quality, just a string.\r\n */ WNP.getQualityIdent = function(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate) {\n    // console.log(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n    var sIdent = \"\";\n    if (songBitrate >= 700 && songBitDepth == 24 && songSampleRate == 44100) sIdent = \"Lossless\";\n    if (songBitrate > 1000 && songBitDepth == 16 && songSampleRate == 44100) sIdent = \"CD\";\n    else if (songBitrate > 7000 && songBitDepth >= 24 && songSampleRate >= 96000) sIdent = \"Hi-Res\";\n    // Based of Tidal/Amazon Music Unlimited/Deezer/Qobuz\n    switch(songQuality + \":\" + songActualQuality){\n        case \"2:LOSSLESS\":\n        case \":LOSSLESS\":\n            sIdent = \"HIGH\";\n            break;\n        case \"3:HI_RES\":\n            sIdent = \"MQA\";\n            break;\n        case \"4:HI_RES_LOSSLESS\":\n        case \":HI_RES_LOSSLESS\":\n        case \"0:LOSSLESS\":\n            sIdent = \"FLAC\";\n            break;\n        case \":UHD\":\n            sIdent = \"ULTRA HD\";\n            break;\n        case \":HD\":\n            sIdent = \"HD\"; // Amazon Music\n            break;\n        case \"3:7\":\n        case \"4:27\":\n            sIdent = \"Hi-Res\"; // Qobuz\n            break;\n        case \"2:6\":\n            sIdent = \"CD\"; // Qobuz\n            break;\n    }\n    return sIdent;\n};\n/**\r\n * Format bytes into human-readable units.\r\n * @param {number} bytes - byte value.\r\n * @returns {string} formatted value.\r\n */ WNP.formatBytes = function(bytes) {\n    if (typeof bytes !== \"number\" || Number.isNaN(bytes)) return \"-\";\n    if (bytes === 0) return \"0 B\";\n    const units = [\n        \"B\",\n        \"KB\",\n        \"MB\",\n        \"GB\"\n    ];\n    const exponent = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);\n    const value = bytes / Math.pow(1024, exponent);\n    return `${value.toFixed(value >= 10 || exponent === 0 ? 0 : 1)} ${units[exponent]}`;\n};\n/**\r\n * Update the Lyrics cache settings\r\n * @param {void}\r\n * @returns {void}\r\n */ WNP.updateLyricsCacheSettings = function() {\n    const cacheSettings = WNP.d.serverSettings?.features?.lyrics?.cache || {};\n    if (WNP.r.lyricsCacheEnabled) WNP.r.lyricsCacheEnabled.innerText = typeof cacheSettings.enabled === \"boolean\" ? cacheSettings.enabled ? \"true\" : \"false\" : \"-\";\n    if (WNP.r.lyricsCachePrefetchMode) WNP.r.lyricsCachePrefetchMode.innerText = cacheSettings.prefetch || \"-\";\n    if (WNP.r.lyricsCachePrefetchConcurrency) WNP.r.lyricsCachePrefetchConcurrency.innerText = typeof cacheSettings.maxPrefetchConcurrency === \"number\" ? cacheSettings.maxPrefetchConcurrency : \"-\";\n};\n// =======================================================\n// Start WiiM Now Playing app debugger\nWNP.Init();\n\n\n//# sourceMappingURL=debug.d17928de.js.map\n","// =======================================================\r\n// WiiM Now Playing\r\n// Debugging script for the WiiM Now Playing server\r\n\r\n// Namespacing\r\nwindow.WNP = window.WNP || {};\r\n\r\n// Default settings\r\nWNP.s = {\r\n    // Host runs on default port 80, but in cases where another port is chosen adapt\r\n    locHostname: location.hostname,\r\n    locPort: (location.port && location.port != \"80\" && location.port != \"1234\") ? location.port : \"80\",\r\n    rndAlbumArtUri: \"./img/fake-album-1.jpg\",\r\n    // Device selection\r\n    aDeviceUI: [\"btnRefresh\", \"selDeviceChoices\", \"devName\", \"mediaTitle\", \"mediaSubTitle\", \"mediaArtist\", \"mediaAlbum\", \"mediaBitRate\", \"mediaBitDepth\", \"mediaSampleRate\", \"mediaQualityIdent\", \"devVol\", \"mediaSource\"],\r\n    // Server actions to be used in the app\r\n    aServerUI: [\"btnReboot\", \"btnUpdate\", \"btnShutdown\", \"btnReloadUI\", \"sServerUrlHostname\", \"sServerUrlIP\", \"sServerVersion\", \"sClientVersion\", \"chkLyricsEnabled\"],\r\n    // Ticks to be used in the app (debug)\r\n    aTicksUI: [\"tickDevicesGetUp\", \"tickDevicesRefreshUp\", \"tickServerSettingsUp\", \"tickStateUp\", \"tickStateDown\", \"tickMetadataUp\", \"tickMetadataDown\", \"tickLyricsUp\", \"tickLyricsDown\", \"tickDeviceSetUp\", \"tickDeviceSetDown\", \"tickServerSettingsDown\", \"tickDevicesGetDown\", \"tickDevicesRefreshDown\", \"tickVolumeGetUp\", \"tickVolumeGetDown\", \"tickVolumeSetUp\", \"tickVolumeSetDown\", \"tickPresetsListUp\", \"tickPresetsListDown\"],\r\n    // Debug UI elements\r\n    // aDebugUI: [\"state\", \"metadata\", \"lyrics\", \"lyricsStatus\", \"lyricsProvider\", \"lyricsTrackKey\", \"lyricsCacheEnabled\", \"lyricsCacheStatus\", \"lyricsCacheSize\", \"lyricsCacheMax\", \"lyricsCachePrefetchMode\", \"lyricsCachePrefetchConcurrency\", \"lyricsPrefetch\", \"lyricsPrefetchStatus\", \"lyricsPrefetchTrackKey\", \"lyricsPrefetchMode\", \"lyricsPrefetchReason\", \"sPresetsList\", \"sServerSettings\", \"sManufacturer\", \"sModelName\", \"sLocation\", \"sTimeStampDiff\", \"sAlbumArtUri\", \"sAlbumArtUriRaw\", \"sAlbumArtUriStatus\", \"oPresetsGroup\", \"btnDevices\", \"btnGetVolume\", \"btnSetVolume\", \"mediaLoopMode\", \"sTransportState\", \"sPlayMedium\", \"sPlayerProgress\"]\r\n    aDebugUI: [\"state\", \"metadata\", \"lyrics\", \"lyricsStatus\", \"lyricsTrackKey\", \"sPresetsList\", \"sServerSettings\", \"sManufacturer\", \"sModelName\", \"sLocation\", \"sTimeStampDiff\", \"sAlbumArtUri\", \"sAlbumArtUriRaw\", \"sAlbumArtUriStatus\", \"oPresetsGroup\", \"btnDevices\", \"btnGetVolume\", \"btnSetVolume\", \"mediaLoopMode\", \"sTransportState\", \"sPlayMedium\", \"sPlayerProgress\"]\r\n};\r\n\r\n// Data placeholders.\r\nWNP.d = {\r\n    serverSettings: null, // Server settings, used to store the server settings\r\n    deviceList: null, // Device list, used to store the devices found through SSDP\r\n    prevTransportState: null, // Previous transport state, used to detect changes in the transport state\r\n    prevPlayMedium: null, // Previous play medium, used to detect changes in the play medium\r\n    prevSourceIdent: null, // Previous source ident, used to detect changes in the source\r\n    prevTrackInfo: null // Previous track info, used to detect changes in the metadata\r\n};\r\n\r\n// Reference placeholders.\r\n// These are set in the init function\r\n// and are used to reference the UI elements in the app.\r\nWNP.r = {};\r\n\r\n/**\r\n * Initialisation of app.\r\n * @returns {undefined}\r\n */\r\nWNP.Init = function () {\r\n    console.log(\"WNP\", \"Initialising...\");\r\n\r\n    // Init Socket.IO, connect to port where server resides\r\n    console.log(\"WNP\", \"Listening on \" + this.s.locHostname + \":\" + this.s.locPort)\r\n    window.socket = io.connect(\":\" + this.s.locPort);\r\n\r\n    // Set references to the UI elements\r\n    this.setUIReferences();\r\n\r\n    // Set tick handlers\r\n    this.setTickHandlers();\r\n\r\n    // Set Socket.IO definitions\r\n    this.setSocketDefinitions();\r\n\r\n    // Set UI event listeners\r\n    this.setUIListeners();\r\n\r\n    // Initial calls, wait a bit for socket to start\r\n    setTimeout(() => {\r\n        // Get server settings\r\n        this.r.tickServerSettingsUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"server-settings\");\r\n        // Get devices\r\n        this.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"devices-get\");\r\n        // // Get volume\r\n        // this.r.tickVolumeGetUp.classList.add(\"tickAnimate\");\r\n        // socket.emit(\"device-api\", \"getPlayerStatus\");\r\n        // Get presets\r\n        this.r.tickPresetsListUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"device-api\", \"getPresetInfo\");\r\n    }, 500);\r\n\r\n    // Create random album intervals, every 3 minutes\r\n    WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\r\n    var rndAlbumInterval = setInterval(function () {\r\n        WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\r\n    }, 3 * 60 * 1000);\r\n\r\n};\r\n\r\n/**\r\n * Reference to the UI elements of the app.\r\n * @returns {undefined}\r\n */\r\nWNP.setUIReferences = function () {\r\n    console.log(\"WNP\", \"Set UI references...\")\r\n\r\n    function addElementToRef(id) {\r\n        const element = document.getElementById(id);\r\n        if (element) {\r\n            WNP.r[id] = element;\r\n        } else {\r\n            console.warn(\"WNP\", `Element with ID '${id}' not found in current HTML.`);\r\n        }\r\n    }\r\n\r\n    // Set references to the UI elements\r\n    this.s.aDeviceUI.forEach((id) => { addElementToRef(id); });\r\n    this.s.aServerUI.forEach((id) => { addElementToRef(id); });\r\n    this.s.aTicksUI.forEach((id) => { addElementToRef(id); });\r\n    this.s.aDebugUI.forEach((id) => { addElementToRef(id); });\r\n\r\n};\r\n\r\n/**\r\n * Set the tick event handlers for the app.\r\n * @returns {undefined}\r\n */\r\nWNP.setTickHandlers = function () {\r\n\r\n    function removeTickAnimate(e) {\r\n        e.target.classList.remove(\"tickAnimate\");\r\n    }\r\n\r\n    // Set the tick handlers for the app\r\n    this.s.aTicksUI.forEach((tick) => {\r\n        if (this.r[tick]) {\r\n            this.r[tick].addEventListener(\"animationend\", removeTickAnimate);\r\n        } else {\r\n            console.warn(\"WNP\", `Element with ID '${tick}' not found.`);\r\n        }\r\n    });\r\n\r\n};\r\n\r\n/**\r\n * Setting the listeners on the UI elements of the app.\r\n * @returns {undefined}\r\n */\r\nWNP.setUIListeners = function () {\r\n    console.log(\"WNP\", \"Set UI Listeners...\")\r\n\r\n    // ------------------------------------------------\r\n    // Player buttons\r\n\r\n    // (no player buttons in debug mode)\r\n\r\n    // ------------------------------------------------\r\n    // Settings buttons\r\n\r\n    // Device selection dropdown\r\n    this.r.selDeviceChoices.addEventListener(\"change\", function () {\r\n        WNP.r.tickDeviceSetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"device-set\", this.value);\r\n    });\r\n\r\n    // Devices get button\r\n    this.r.btnDevices.addEventListener(\"click\", function () {\r\n        WNP.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"devices-get\");\r\n    });\r\n\r\n    // Refresh devices button\r\n    this.r.btnRefresh.addEventListener(\"click\", function () {\r\n        WNP.r.tickDevicesRefreshUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"devices-refresh\");\r\n        // Wait for discovery to finish\r\n        setTimeout(() => {\r\n            WNP.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\r\n            socket.emit(\"devices-get\");\r\n            WNP.r.tickServerSettingsUp.classList.add(\"tickAnimate\");\r\n            socket.emit(\"server-settings\");\r\n            WNP.r.tickPresetsListUp.classList.add(\"tickAnimate\");\r\n            socket.emit(\"device-api\", \"getPresetInfo\");\r\n        }, 5000);\r\n    });\r\n\r\n    // Get volume button\r\n    this.r.btnGetVolume.addEventListener(\"click\", function () {\r\n        WNP.r.tickVolumeGetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"device-api\", \"getPlayerStatus\");\r\n    });\r\n\r\n    // Set volume button\r\n    this.r.btnSetVolume.addEventListener(\"click\", function () {\r\n        var volume = parseInt(WNP.r.devVol.value);\r\n        if (isNaN(volume) || volume < 0 || volume > 100) {\r\n            alert(\"Please enter a valid volume between 0 and 100.\");\r\n            return;\r\n        }\r\n        WNP.r.tickVolumeSetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"device-api\", \"setPlayerCmd:vol:\" + volume);\r\n    });\r\n\r\n    // Reboot button\r\n    this.r.btnReboot.addEventListener(\"click\", function () {\r\n        socket.emit(\"server-reboot\");\r\n    });\r\n\r\n    // Update button\r\n    this.r.btnUpdate.addEventListener(\"click\", function () {\r\n        socket.emit(\"server-update\");\r\n    });\r\n\r\n    // Shutdown button\r\n    this.r.btnShutdown.addEventListener(\"click\", function () {\r\n        socket.emit(\"server-shutdown\");\r\n    });\r\n\r\n    // Reload UI button\r\n    this.r.btnReloadUI.addEventListener(\"click\", function () {\r\n        location.reload();\r\n    });\r\n\r\n    // Lyrics toggle\r\n    this.r.chkLyricsEnabled.addEventListener(\"change\", function () {\r\n        socket.emit(\"server-settings-update\", {\r\n            features: {\r\n                lyrics: {\r\n                    enabled: this.checked\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n};\r\n\r\n/**\r\n * Set the socket definitions to listen for specific websocket traffic and handle accordingly.\r\n * @returns {undefined}\r\n */\r\nWNP.setSocketDefinitions = function () {\r\n    console.log(\"WNP\", \"Setting Socket definitions...\")\r\n\r\n    // On server settings\r\n    socket.on(\"server-settings\", function (msg) {\r\n        console.log(\"IO: server-settings\", msg);\r\n        WNP.r.tickServerSettingsDown.classList.add(\"tickAnimate\");\r\n\r\n        // Store server settings\r\n        WNP.d.serverSettings = msg;\r\n        WNP.r.sServerSettings.innerHTML = JSON.stringify(msg);\r\n\r\n        // RPi has bash, so possibly able to reboot/shutdown.\r\n        if (msg && msg.os && msg.os.userInfo && msg.os.userInfo.shell === \"/bin/bash\") {\r\n            WNP.r.btnReboot.disabled = false;\r\n            WNP.r.btnUpdate.disabled = false;\r\n            WNP.r.btnShutdown.disabled = false;\r\n        };\r\n\r\n        // Set device name\r\n        WNP.r.devName.innerText = (msg && msg.selectedDevice && msg.selectedDevice.friendlyName) ? msg.selectedDevice.friendlyName : \"-\";\r\n        WNP.r.sManufacturer.innerText = (msg && msg.selectedDevice && msg.selectedDevice.manufacturer) ? msg.selectedDevice.manufacturer : \"-\";\r\n        WNP.r.sModelName.innerText = (msg && msg.selectedDevice && msg.selectedDevice.modelName) ? msg.selectedDevice.modelName : \"-\";\r\n        WNP.r.sLocation.innerHTML = (msg && msg.selectedDevice && msg.selectedDevice.location) ? \"<a href=\\\"\" + msg.selectedDevice.location + \"\\\">\" + msg.selectedDevice.location + \"</a>\" : \"-\";\r\n\r\n        // Set the server local url\r\n        if (msg && msg.os && msg.os.hostname) {\r\n            var sUrl = \"http://\" + msg.os.hostname.toLowerCase() + \".local\";\r\n            sUrl += (location && location.port && location.port != 80) ? \":\" + location.port + \"/\" : \"/\";\r\n            WNP.r.sServerUrlHostname.innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\r\n        }\r\n        else {\r\n            WNP.r.sServerUrlHostname.innerText = \"-\";\r\n        }\r\n        // Set the server ip address\r\n        if (msg && msg.selectedDevice && msg.selectedDevice.location && msg.os && msg.os.networkInterfaces) {\r\n            // Grab the ip address pattern of the selected device\r\n            // Assumption is that the wiim-now-playing server is on the same ip range as the client..\r\n            var sLocationIp = msg.selectedDevice.location.split(\"/\")[2]; // Extract ip address from location\r\n            var aIpAddress = sLocationIp.split(\".\"); // Split ip address in parts\r\n            aIpAddress.pop(); // Remove the last part\r\n            var sIpPattern = aIpAddress.join(\".\"); // Construct ip address pattern\r\n            // Search for server ip address(es) in this range...\r\n            Object.keys(msg.os.networkInterfaces).forEach(function (key, index) {\r\n                var sIpFound = msg.os.networkInterfaces[key].find(addr => addr.address.startsWith(sIpPattern))\r\n                if (sIpFound) {\r\n                    // Construct ip address and optional port\r\n                    var sUrl = \"http://\" + sIpFound.address;\r\n                    sUrl += (location && location.port && location.port != 80) ? \":\" + location.port + \"/\" : \"/\";\r\n                    WNP.r.sServerUrlIP.innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            WNP.r.sServerUrlIP.innerText = \"-\";\r\n        }\r\n\r\n        // Set the server version\r\n        WNP.r.sServerVersion.innerText = (msg && msg.version && msg.version.server) ? msg.version.server : \"-\";\r\n        // Set the client version\r\n        WNP.r.sClientVersion.innerText = (msg && msg.version && msg.version.client) ? msg.version.client : \"-\";\r\n\r\n        // Lyrics enabled/disabled\r\n        if (WNP.r.chkLyricsEnabled) {\r\n            WNP.r.chkLyricsEnabled.checked = Boolean(msg && msg.features && msg.features.lyrics && msg.features.lyrics.enabled);\r\n        }\r\n\r\n        WNP.updateLyricsCacheSettings();\r\n\r\n    });\r\n\r\n    // On devices get\r\n    socket.on(\"devices-get\", function (msg) {\r\n        console.log(\"IO: devices-get\", msg);\r\n        WNP.r.tickDevicesGetDown.classList.add(\"tickAnimate\");\r\n\r\n        // Store and sort device list\r\n        WNP.d.deviceList = msg;\r\n        WNP.d.deviceList.sort((a, b) => { return (a.friendlyName < b.friendlyName) ? -1 : 1 });\r\n\r\n        // Clear choices\r\n        WNP.r.selDeviceChoices.innerHTML = \"<option value=\\\"\\\">Select a device...</em></li>\";\r\n\r\n        // Add WiiM devices\r\n        var devicesWiiM = WNP.d.deviceList.filter((d) => { return d.manufacturer.startsWith(\"Linkplay\") });\r\n        if (devicesWiiM.length > 0) {\r\n\r\n            // Device select options\r\n            var optGroup = document.createElement(\"optgroup\");\r\n            optGroup.label = \"WiiM devices\";\r\n            devicesWiiM.forEach((device) => {\r\n                var opt = document.createElement(\"option\");\r\n                opt.value = device.location;\r\n                opt.innerText = device.friendlyName;\r\n                opt.title = \"By \" + device.manufacturer;\r\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) {\r\n                    opt.setAttribute(\"selected\", \"selected\");\r\n                };\r\n                optGroup.appendChild(opt);\r\n            })\r\n            WNP.r.selDeviceChoices.appendChild(optGroup);\r\n        };\r\n\r\n        // Other devices\r\n        // Possibly removing this section in future releases.\r\n        var devicesOther = WNP.d.deviceList.filter((d) => { return !d.manufacturer.startsWith(\"Linkplay\") });\r\n        if (devicesOther.length > 0) {\r\n\r\n            // Device select dropdown options\r\n            var optGroup = document.createElement(\"optgroup\");\r\n            optGroup.label = \"Other devices\";\r\n            devicesOther.forEach((device) => {\r\n                var opt = document.createElement(\"option\");\r\n                opt.value = device.location;\r\n                opt.innerText = device.friendlyName;\r\n                opt.title = \"By \" + device.manufacturer;\r\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) {\r\n                    opt.setAttribute(\"selected\", \"selected\");\r\n                };\r\n                optGroup.appendChild(opt);\r\n            })\r\n            WNP.r.selDeviceChoices.appendChild(optGroup);\r\n\r\n        };\r\n\r\n        // No devices found\r\n        if (devicesWiiM.length == 0 && devicesOther.length == 0) {\r\n            WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">No devices found!</em></li>\";\r\n        };\r\n\r\n    });\r\n\r\n    // On state\r\n    socket.on(\"state\", function (msg) {\r\n        if (!msg) { return false; }\r\n\r\n        WNP.r.tickStateDown.classList.add(\"tickAnimate\");\r\n        WNP.r.state.innerHTML = JSON.stringify(msg);\r\n\r\n        // Get player progress data from the state message.\r\n        var timeStampDiff = 0;\r\n        if (msg.CurrentTransportState === \"PLAYING\") {\r\n            timeStampDiff = (msg.stateTimeStamp && msg.metadataTimeStamp) ? Math.round((msg.stateTimeStamp - msg.metadataTimeStamp) / 1000) : 0;\r\n        }\r\n        var relTime = (msg.RelTime) ? msg.RelTime : \"00:00:00\";\r\n        var trackDuration = (msg.TrackDuration) ? msg.TrackDuration : \"00:00:00\";\r\n        WNP.r.sTimeStampDiff.innerHTML = timeStampDiff + \"s\";\r\n\r\n        // Get current player progress and set UI elements accordingly.\r\n        var oPlayerProgress = WNP.getPlayerProgress(relTime, trackDuration, timeStampDiff, msg.CurrentTransportState);\r\n        WNP.r.sPlayerProgress.innerText = JSON.stringify(oPlayerProgress);\r\n\r\n        // Device transport state or play medium changed...?\r\n        if (WNP.d.prevTransportState !== msg.CurrentTransportState || WNP.d.prevPlayMedium !== msg.PlayMedium) {\r\n            WNP.r.sTransportState.innerText = msg.CurrentTransportState;\r\n            WNP.r.sPlayMedium.innerText = msg.PlayMedium;\r\n            WNP.d.prevTransportState = msg.CurrentTransportState; // Remember the last transport state\r\n            WNP.d.prevPlayMedium = msg.PlayMedium; // Remember the last PlayMedium\r\n        }\r\n\r\n    });\r\n\r\n    // On metadata\r\n    socket.on(\"metadata\", function (msg) {\r\n        if (!msg) { return false; }\r\n\r\n        WNP.r.tickMetadataDown.classList.add(\"tickAnimate\");\r\n        WNP.r.metadata.innerHTML = JSON.stringify(msg);\r\n\r\n        // Source detection\r\n        var playMedium = (msg.PlayMedium) ? msg.PlayMedium : \"\";\r\n        var trackSource = (msg.TrackSource) ? msg.TrackSource : \"\";\r\n        var sourceIdent = WNP.getSourceIdent(playMedium, trackSource);\r\n        // Did the source ident change...?\r\n        if (sourceIdent !== WNP.d.prevSourceIdent) {\r\n            if (sourceIdent !== \"\") {\r\n                mediaSource.innerText = playMedium + \": \" + trackSource + \" (\" + sourceIdent + \")\";\r\n            }\r\n            else {\r\n                mediaSource.innerText = playMedium + \": \" + trackSource;\r\n            }\r\n            WNP.d.prevSourceIdent = sourceIdent; // Remember the last Source Ident\r\n        }\r\n\r\n        // Song Title, Subtitle, Artist, Album\r\n        WNP.r.mediaTitle.innerText = (msg.trackMetaData && msg.trackMetaData[\"dc:title\"]) ? msg.trackMetaData[\"dc:title\"] : \"\";\r\n        WNP.r.mediaSubTitle.innerText = (msg.trackMetaData && msg.trackMetaData[\"dc:subtitle\"]) ? msg.trackMetaData[\"dc:subtitle\"] : \"\";\r\n        WNP.r.mediaArtist.innerText = (msg.trackMetaData && msg.trackMetaData[\"upnp:artist\"]) ? msg.trackMetaData[\"upnp:artist\"] : \"\";\r\n        WNP.r.mediaAlbum.innerText = (msg.trackMetaData && msg.trackMetaData[\"upnp:album\"]) ? msg.trackMetaData[\"upnp:album\"] : \"\";\r\n\r\n        // Audio quality\r\n        var songBitrate = (msg.trackMetaData && msg.trackMetaData[\"song:bitrate\"]) ? msg.trackMetaData[\"song:bitrate\"] : \"\";\r\n        var songBitDepth = (msg.trackMetaData && msg.trackMetaData[\"song:format_s\"]) ? msg.trackMetaData[\"song:format_s\"] : \"\";\r\n        var songSampleRate = (msg.trackMetaData && msg.trackMetaData[\"song:rate_hz\"]) ? msg.trackMetaData[\"song:rate_hz\"] : \"\";\r\n        WNP.r.mediaBitRate.innerText = (songBitrate > 0) ? ((songBitrate > 1000) ? (songBitrate / 1000).toFixed(2) + \" mbps (\" + songBitrate + \")\" : songBitrate + \" kbps (\" + songBitrate + \")\") : \"\";\r\n        WNP.r.mediaBitDepth.innerText = (songBitDepth > 0) ? ((songBitDepth > 24) ? \"24 bit (\" + songBitDepth + \")\" : songBitDepth + \" bit (\" + songBitDepth + \")\") : \"\";\r\n        WNP.r.mediaSampleRate.innerText = (songSampleRate > 0) ? (songSampleRate / 1000).toFixed(1) + \" kHz (\" + songSampleRate + \")\" : \"\";\r\n\r\n        // Audio quality ident badge (HD/Hi-res/CD/...)\r\n        var songQuality = (msg.trackMetaData && msg.trackMetaData[\"song:quality\"]) ? msg.trackMetaData[\"song:quality\"] : \"\";\r\n        var songActualQuality = (msg.trackMetaData && msg.trackMetaData[\"song:actualQuality\"]) ? msg.trackMetaData[\"song:actualQuality\"] : \"\";\r\n        var qualiIdent = WNP.getQualityIdent(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\r\n        if (qualiIdent !== \"\") {\r\n            WNP.r.mediaQualityIdent.innerText = qualiIdent + \" (\" + songQuality + \", \" + songActualQuality + \")\";\r\n        }\r\n        else {\r\n            WNP.r.mediaQualityIdent.innerText = songQuality + \", \" + songActualQuality;\r\n        }\r\n\r\n        // Pre-process Album Art uri, if any is available from the metadata.\r\n        var albumArtUriRaw = (msg.trackMetaData && msg.trackMetaData[\"upnp:albumArtURI\"]) ? msg.trackMetaData[\"upnp:albumArtURI\"] : \"\";\r\n        var albumArtUri = WNP.checkAlbumArtURI(albumArtUriRaw, msg.metadataTimeStamp);\r\n\r\n        // Set Album Art, only if the track changed and the URI changed\r\n        var trackChanged = false;\r\n        var currentTrackInfo = WNP.r.mediaTitle.innerText + \"|\" + WNP.r.mediaSubTitle.innerText + \"|\" + WNP.r.mediaArtist.innerText + \"|\" + WNP.r.mediaAlbum.innerText;\r\n        var currentAlbumArt = WNP.r.sAlbumArtUri.innerText;\r\n        if (WNP.d.prevTrackInfo !== currentTrackInfo) {\r\n            trackChanged = true;\r\n            WNP.d.prevTrackInfo = currentTrackInfo; // Remember the last track info\r\n            console.log(\"WNP\", \"Track changed:\", currentTrackInfo);\r\n        }\r\n        if (trackChanged && currentAlbumArt != albumArtUri) {\r\n            WNP.r.sAlbumArtUriRaw.innerText = albumArtUriRaw;\r\n            WNP.r.sAlbumArtUri.innerText = albumArtUri;\r\n        }\r\n\r\n        // Device volume\r\n        WNP.r.devVol.value = (msg.CurrentVolume) ? msg.CurrentVolume : \"-\"; // Set the volume on the UI\r\n\r\n        // Loop mode status\r\n        if (msg.LoopMode) {\r\n            switch (msg.LoopMode) {\r\n                case \"5\": // repeat-1 | shuffle\r\n                    WNP.r.mediaLoopMode.innerText = \"Shuffle enabled, Repeat enabled - loop once\";\r\n                    break;\r\n                case \"3\": // no repeat | shuffle\r\n                    WNP.r.mediaLoopMode.innerText = \"Shuffle enabled, Repeat disabled\";\r\n                    break;\r\n                case \"2\": // repeat | shuffle\r\n                    WNP.r.mediaLoopMode.innerText = \"Shuffle enabled, Repeat enabled - loop\";\r\n                    break;\r\n                case \"1\": // repeat-1 | no shuffle\r\n                    WNP.r.mediaLoopMode.innerText = \"Shuffle disabled, Repeat enabled - loop once\";\r\n                    break;\r\n                case \"0\": // repeat | no shuffle\r\n                    WNP.r.mediaLoopMode.innerText = \"Shuffle disabled, Repeat enabled - loop\";\r\n                    break;\r\n                default: // no repeat | no shuffle #4\r\n                    WNP.r.mediaLoopMode.innerText = \"Shuffle disabled, Repeat disabled\";\r\n            }\r\n        }\r\n        else { // Unknown, so set default\r\n            WNP.r.mediaLoopMode.innerText = \"Unknown\";\r\n        }\r\n\r\n    });\r\n\r\n    // On lyrics\r\n    socket.on(\"lyrics\", function (msg) {\r\n        console.log(\"IO: lyrics\", msg);\r\n        WNP.r.tickLyricsDown.classList.add(\"tickAnimate\");\r\n        WNP.r.lyrics.innerHTML = JSON.stringify(msg);\r\n\r\n        WNP.r.lyricsStatus.innerText = (msg && msg.status) ? msg.status : \"-\";\r\n        // WNP.r.lyricsProvider.innerText = (msg && msg.provider) ? msg.provider : \"-\";\r\n        WNP.r.lyricsTrackKey.innerText = (msg && msg.trackKey) ? msg.trackKey : \"-\";\r\n\r\n        // const diagnostics = msg?.diagnostics || {};\r\n        // if (WNP.r.lyricsCacheStatus) {\r\n        //     WNP.r.lyricsCacheStatus.innerText = diagnostics.cacheStatus || \"-\";\r\n        // }\r\n        // if (WNP.r.lyricsCacheSize) {\r\n        //     WNP.r.lyricsCacheSize.innerText = WNP.formatBytes(diagnostics.cacheSizeBytes);\r\n        // }\r\n        // if (WNP.r.lyricsCacheMax) {\r\n        //     WNP.r.lyricsCacheMax.innerText = WNP.formatBytes(diagnostics.cacheMaxBytes);\r\n        // }\r\n        WNP.updateLyricsCacheSettings();\r\n    });\r\n\r\n    // socket.on(\"lyrics-prefetch\", function (msg) {\r\n    //     console.log(\"IO: lyrics-prefetch\", msg);\r\n    //     if (WNP.r.lyricsPrefetch) {\r\n    //         WNP.r.lyricsPrefetch.innerHTML = JSON.stringify(msg);\r\n    //     }\r\n    //     if (WNP.r.lyricsPrefetchStatus) {\r\n    //         WNP.r.lyricsPrefetchStatus.innerText = (msg && msg.status) ? msg.status : \"-\";\r\n    //     }\r\n    //     if (WNP.r.lyricsPrefetchTrackKey) {\r\n    //         WNP.r.lyricsPrefetchTrackKey.innerText = (msg && msg.trackKey) ? msg.trackKey : \"-\";\r\n    //     }\r\n    //     if (WNP.r.lyricsPrefetchMode) {\r\n    //         WNP.r.lyricsPrefetchMode.innerText = (msg && msg.mode) ? msg.mode : \"-\";\r\n    //     }\r\n    //     if (WNP.r.lyricsPrefetchReason) {\r\n    //         WNP.r.lyricsPrefetchReason.innerText = (msg && msg.reason) ? msg.reason : \"-\";\r\n    //     }\r\n    // });\r\n\r\n    // On device set\r\n    socket.on(\"device-set\", function (msg) {\r\n        console.log(\"IO: device-set\", msg);\r\n        WNP.r.tickDeviceSetDown.classList.add(\"tickAnimate\");\r\n        // Device switch? Fetch settings and device info again.\r\n        WNP.r.tickServerSettingsUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"server-settings\");\r\n        WNP.r.tickDevicesGetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"devices-get\");\r\n        WNP.r.tickVolumeGetUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"device-api\", \"getPlayerStatus\");\r\n        WNP.r.tickPresetsListUp.classList.add(\"tickAnimate\");\r\n        socket.emit(\"device-api\", \"getPresetInfo\");\r\n    });\r\n\r\n    // On device refresh\r\n    socket.on(\"devices-refresh\", function (msg) {\r\n        console.log(\"IO: devices-refresh\", msg);\r\n        WNP.r.tickDevicesRefreshDown.classList.add(\"tickAnimate\");\r\n        WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">Waiting for devices...</em></li>\";\r\n    });\r\n\r\n    // On device action (i.e. for play, pause, next, previous)\r\n    socket.on(\"device-action\", function (msg, param) {\r\n        // Actions do not return a message.\r\n        // so we don't need to do anything here.\r\n        // Maybe later we can use this to show a notification or similar.\r\n        console.log(\"WNP\", \"Action:\", msg);\r\n    });\r\n\r\n    // On device API response\r\n    socket.on(\"device-api\", function (msg, param) {\r\n        console.log(\"IO: device-api\", msg, param);\r\n        switch (msg) {\r\n            case \"getPresetInfo\":\r\n                // Preset info response\r\n                WNP.r.tickPresetsListDown.classList.add(\"tickAnimate\");\r\n                WNP.r.sPresetsList.innerHTML = param ? JSON.stringify(param) : \"\";\r\n                var sCurrentTitle = WNP.r.mediaTitle.innerText;\r\n                var sCurrentSubtitle = WNP.r.mediaSubTitle.innerText;\r\n                // Update preset buttons\r\n                if (WNP.r.oPresetsGroup) {\r\n                    WNP.r.oPresetsGroup.innerHTML = \"\";\r\n                    if (param && param.preset_list && param.preset_list.length > 0) {\r\n                        param.preset_list.forEach((preset) => {\r\n                            var btn = document.createElement(\"button\");\r\n                            btn.type = \"button\";\r\n                            btn.classList = \"btn btn-secondary\";\r\n                            btn.innerText = preset.number;\r\n                            btn.title = preset.name;\r\n                            if (preset.name === sCurrentTitle || preset.name === sCurrentSubtitle) {\r\n                                btn.classList.add(\"active\");\r\n                            }\r\n                            btn.addEventListener(\"click\", function () {\r\n                                // Load preset\r\n                                socket.emit(\"device-api\", \"MCUKeyShortClick:\" + preset.number);\r\n                                // Highlight button\r\n                                Array.from(WNP.r.oPresetsGroup.children).forEach((b) => { b.classList.remove(\"active\"); });\r\n                                btn.classList.add(\"active\");\r\n                            });\r\n                            WNP.r.oPresetsGroup.appendChild(btn);\r\n                        });\r\n                    } else {\r\n                        var p = document.createElement(\"p\");\r\n                        p.classList = \"form-text text-white\";\r\n                        p.innerText = \"No presets found\";\r\n                        WNP.r.oPresetsGroup.appendChild(p);\r\n                    }\r\n                }\r\n                break;\r\n            case msg.startsWith(\"MCUKeyShortClick:\") ? msg : false:\r\n                // Preset set response, no further action needed\r\n                break;\r\n            case \"getPlayerStatus\":\r\n                // Player status response\r\n                // Called when getting volume\r\n                WNP.r.tickVolumeGetDown.classList.add(\"tickAnimate\");\r\n                if (param && param.vol !== undefined) {\r\n                    WNP.r.devVol.value = param.vol;\r\n                }\r\n                break;\r\n            case msg.startsWith(\"setPlayerCmd:vol:\") ? msg : false:\r\n                // Volume set response\r\n                WNP.r.tickVolumeSetDown.classList.add(\"tickAnimate\");\r\n                socket.emit(\"device-api\", \"getPlayerStatus\"); // Refresh volume UI\r\n                break;\r\n            default:\r\n                // No action\r\n                break;\r\n        }\r\n    });\r\n\r\n    // On server reboot\r\n    socket.on(\"server-reboot\", function (msg) {\r\n        // Possibly show a notification that reboot is in progress\r\n        console.log(\"WNP\", \"Server reboot:\", msg);\r\n    });\r\n\r\n    // On server update\r\n    socket.on(\"server-update\", function (msg) {\r\n        // Possibly show a notification that update is in progress\r\n        console.log(\"WNP\", \"Server update:\", msg);\r\n    });\r\n\r\n    // On server shutdown\r\n    socket.on(\"server-shutdown\", function (msg) {\r\n        // Possibly show a notification that shutdown is in progress\r\n        console.log(\"WNP\", \"Server shutdown:\", msg);\r\n    });\r\n\r\n};\r\n\r\n// =======================================================\r\n// Helper functions\r\n\r\n/**\r\n * Get player progress helper.\r\n * @param {string} relTime - Time elapsed while playing, format 00:00:00\r\n * @param {string} trackDuration - Total play time, format 00:00:00\r\n * @param {integer} timeStampDiff - Possible play time offset in seconds\r\n * @param {string} currentTransportState - The current transport state \"PLAYING\" or otherwise\r\n * @returns {object} An object with corrected played, left, total and percentage played\r\n */\r\nWNP.getPlayerProgress = function (relTime, trackDuration, timeStampDiff, currentTransportState) {\r\n    var relTimeSec = this.convertToSeconds(relTime) + timeStampDiff;\r\n    var trackDurationSec = this.convertToSeconds(trackDuration);\r\n    if (trackDurationSec > 0 && relTimeSec < trackDurationSec) {\r\n        var percentPlayed = ((relTimeSec / trackDurationSec) * 100).toFixed(1);\r\n        return {\r\n            played: WNP.convertToMinutes(relTimeSec),\r\n            left: WNP.convertToMinutes(trackDurationSec - relTimeSec),\r\n            total: WNP.convertToMinutes(trackDurationSec),\r\n            percent: percentPlayed\r\n        };\r\n    }\r\n    else if (trackDurationSec == 0 && currentTransportState == \"PLAYING\") {\r\n        return {\r\n            played: \"Live\",\r\n            left: \"\",\r\n            total: \"\",\r\n            percent: 100\r\n        };\r\n    }\r\n    else {\r\n        return {\r\n            played: \"Paused\",\r\n            left: \"\",\r\n            total: \"\",\r\n            percent: 0\r\n        };\r\n    };\r\n};\r\n\r\n/**\r\n * Convert time format '00:00:00' to total number of seconds.\r\n * @param {string} sDuration - Time, format 00:00:00.\r\n * @returns {integer} The number of seconds that the string represents.\r\n */\r\nWNP.convertToSeconds = function (sDuration) {\r\n    const timeSections = sDuration.split(\":\");\r\n    let totalSeconds = 0;\r\n    for (let i = 0; i < timeSections.length; i++) {\r\n        var nFactor = timeSections.length - 1 - i; // Count backwards\r\n        var nMultiplier = Math.pow(60, nFactor); // 60^n\r\n        totalSeconds += nMultiplier * parseInt(timeSections[i]); // Calculate the seconds\r\n    }\r\n    return totalSeconds\r\n};\r\n\r\n/**\r\n * Convert number of seconds to '00:00' string format. \r\n * Sorry for those hour+ long songs...\r\n * @param {integer} seconds - Number of seconds total.\r\n * @returns {string} The string representation of seconds in minutes, format 00:00.\r\n */\r\nWNP.convertToMinutes = function (seconds) {\r\n    var tempDate = new Date(0);\r\n    tempDate.setSeconds(seconds);\r\n    var result = tempDate.toISOString().substring(14, 19);\r\n    return result;\r\n};\r\n\r\n/**\r\n * Check if the album art is a valid URI. Returns the URI if valid, otherwise a random URI.\r\n * This function creates a virtual image element to check if the album art URI is valid.\r\n * @param {string} sAlbumArtUri - The URI of the album art.\r\n * @param {integer} nTimestamp - The time in milliseconds, used as cache buster.\r\n * @returns {string} The URI of the album art.\r\n */\r\nWNP.checkAlbumArtURI = function (sAlbumArtUri, nTimestamp) {\r\n\r\n    // Create a virtual image element to check the album art URI behind the scenes\r\n    var img = new Image();\r\n    // On successful load\r\n    img.onload = function () {\r\n        console.log(\"WNP\", \"Album art loaded successfully.\", \"Size: \" + this.width + \"x\" + this.height + \"px\");\r\n        WNP.r.sAlbumArtUriStatus.classList = \"bi bi-check-circle-fill\";\r\n        WNP.r.sAlbumArtUriStatus.title = \"Able to load album art\";\r\n    };\r\n    // On error loading the image\r\n    img.onerror = function () {\r\n        console.error(\"WNP\", \"Failed to load album art:\", sAlbumArtUri);\r\n        WNP.r.sAlbumArtUriStatus.classList = \"bi bi-x-circle-fill\";\r\n        WNP.r.sAlbumArtUriStatus.title = \"Unable to load album art\";\r\n    };\r\n\r\n    // If the URI starts with https, the self signed certificate may not trusted by the browser.\r\n    // Hence we always try and load the image through a reverse proxy, ignoring the certificate.\r\n    if (sAlbumArtUri && sAlbumArtUri.startsWith(\"https\")) {\r\n        var sAlbumArtProxyUri = \"\";\r\n        if (WNP.s.locPort != \"80\") { // If the server is not running on port 80, we need to add the port to the URI\r\n            sAlbumArtProxyUri = \"http://\" + WNP.s.locHostname + \":\" + WNP.s.locPort + \"/proxy-art?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\r\n        } else {\r\n            sAlbumArtProxyUri = \"http://\" + WNP.s.locHostname + \"/proxy-art?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\r\n        }\r\n        img.src = sAlbumArtProxyUri; // Test loading the image through the proxy\r\n        return sAlbumArtProxyUri;\r\n    } else if (sAlbumArtUri && sAlbumArtUri.startsWith(\"http\")) {\r\n        img.src = sAlbumArtUri; // Test loading the image directly\r\n        return sAlbumArtUri;\r\n    } else {\r\n        // Looks like an invalid/un_known album art, use the fallback.\r\n        WNP.r.sAlbumArtUriStatus.classList = \"bi bi-exclamation-circle-fill\";\r\n        WNP.r.sAlbumArtUriStatus.title = \"Falling back to random album art\";\r\n        return WNP.s.rndAlbumArtUri;\r\n    }\r\n};\r\n\r\n/**\r\n * Come up with a random album art URI (locally from the img folder).\r\n * @param {string} prefix - The prefix for the album art URI, i.e. 'fake-album-'\r\n * @returns {string} An URI for album art\r\n */\r\nWNP.rndAlbumArt = function (prefix) {\r\n    return \"./img/\" + prefix + this.rndNumber(1, 16) + \".jpg\";\r\n};\r\n\r\n/**\r\n * Get a random number between min and max, including min and max.\r\n * @param {integer} min - Minimum number to pick, keep it lower than max.\r\n * @param {integer} max - Maximum number to pick.\r\n * @returns {integer} The random number\r\n */\r\nWNP.rndNumber = function (min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n};\r\n\r\n/**\r\n * Get an identifier for the current play medium combined with the tracksource.\r\n * TODO: Verify all/most sources...\r\n * @param {string} playMedium - The PlayMedium as indicated by the device. Values: SONGLIST-NETWORK, RADIO-NETWORK, STATION-NETWORK, CAST, AIRPLAY, SPOTIFY, UNKOWN\r\n * @param {string} trackSource - The stream source as indicated by the device. Values: Prime, Qobuz, SPOTIFY, newTuneIn, iHeartRadio, Deezer, UPnPServer, Tidal, vTuner\r\n * @returns {string} The uri to the source identifier (image url)\r\n */\r\nWNP.getSourceIdent = function (playMedium, trackSource) {\r\n\r\n    var sIdentUri = \"\";\r\n\r\n    switch (playMedium.toLowerCase()) {\r\n        case \"airplay\":\r\n            sIdentUri = \"./img/sources/airplay2.png\";\r\n            break;\r\n        case \"third-dlna\":\r\n            sIdentUri = \"./img/sources/dlna2.png\";\r\n            break;\r\n        case \"cast\":\r\n            sIdentUri = \"./img/sources/chromecast2.png\";\r\n            break;\r\n        case \"radio-network\":\r\n            sIdentUri = \"./img/sources/radio.png\";\r\n            break;\r\n        case \"songlist-network\":\r\n            sIdentUri = \"./img/sources/ethernet2.png\";\r\n            break;\r\n        case \"spotify\":\r\n            sIdentUri = \"./img/sources/spotify.png\";\r\n            break;\r\n        case \"squeezelite\":\r\n            sIdentUri = \"./img/sources/music-assistant2.png\";\r\n            break;\r\n        case \"none\":\r\n            sIdentUri = \"./img/sources/none2.png\";\r\n            break;\r\n        case \"bluetooth\":\r\n            sIdentUri = \"./img/sources/bluetooth2.png\";\r\n            break;\r\n        case \"hdmi\":\r\n            sIdentUri = \"./img/sources/hdmi2.png\";\r\n            break;\r\n        case \"line-in\":\r\n            sIdentUri = \"./img/sources/line-in2.png\";\r\n            break;\r\n        case \"optical\":\r\n            sIdentUri = \"./img/sources/spdif2.png\";\r\n            break;\r\n    };\r\n\r\n    switch (trackSource.toLowerCase()) {\r\n        case \"deezer\":\r\n        case \"deezer2\":\r\n            sIdentUri = \"./img/sources/deezer.png\";\r\n            break;\r\n        case \"iheartradio\":\r\n            sIdentUri = \"./img/sources/iheart.png\";\r\n            break;\r\n        case \"newtunein\":\r\n            sIdentUri = \"./img/sources/newtunein.png\";\r\n            break;\r\n        case \"plex\":\r\n            sIdentUri = \"./img/sources/plex.png\";\r\n            break;\r\n        case \"prime\":\r\n            sIdentUri = \"./img/sources/amazon-music2.png\";\r\n            break;\r\n        case \"qobuz\":\r\n            sIdentUri = \"./img/sources/qobuz2.png\";\r\n            break;\r\n        case \"tidal\":\r\n            sIdentUri = \"./img/sources/tidal2.png\";\r\n            break;\r\n        case \"upnpserver\":\r\n            sIdentUri = \"./img/sources/dlna2.png\";\r\n            break;\r\n        case \"vtuner\":\r\n            sIdentUri = \"./img/sources/vtuner2.png\";\r\n            break;\r\n    };\r\n\r\n    return sIdentUri;\r\n\r\n};\r\n\r\n/**\r\n * Get an identifier for the current audio/song quality.\r\n * TODO: Verify all/most sources...\r\n * Found so far:\r\n * \r\n * CD Quality: 44.1 KHz/16 bit. Bitrate 1,411 kbps. For mp3 bitrate can vary, but also be 320/192/160/128/... kbps.\r\n * Hi-Res quality: 96 kHz/24 bit and up. Bitrate 9,216 kbps.\r\n * \r\n * Spotify Lossless: bitrate 700 kbps, 44.1 kHz/24 bit\r\n * Spotify and Pandora usual bitrate 160 kbps, premium is 320 kbps\r\n * Tidal has CD quality, and FLAC, MQA, Master, ...\r\n * Qobuz apparently really has hi-res?\r\n * Amazon Music (Unlimited) does Atmos?\r\n * Apple Music -> Airplay 2, does hi-res?\r\n * YouTube Music -> Cast, does what?\r\n * \r\n * TIDAL -\r\n * Sample High: \"song:quality\":\"2\",\"song:actualQuality\":\"LOSSLESS\"\r\n * Sample MQA: \"song:quality\":\"3\",\"song:actualQuality\":\"HI_RES\"\r\n * Sample FLAC: \"song:quality\":\"4\",\"song:actualQuality\":\"HI_RES_LOSSLESS\"\r\n * \r\n * @param {integer} songQuality - A number identifying the quality, as indicated by the streaming service(?).\r\n * @param {string} songActualQuality - An indicator for the actual quality, as indicated by the streaming service(?).\r\n * @param {integer} songBitrate - The current bitrate in kilobit per second.\r\n * @param {integer} songBitDepth - The current sample depth in bits.\r\n * @param {integer} songSampleRate - The current sample rate in Hz.\r\n * @returns {string} The identifier for the audio quality, just a string.\r\n */\r\nWNP.getQualityIdent = function (songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate) {\r\n    // console.log(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\r\n\r\n    var sIdent = \"\";\r\n\r\n    if (songBitrate >= 700 && songBitDepth == 24 && songSampleRate == 44100) {\r\n        sIdent = \"Lossless\";\r\n    }\r\n    if (songBitrate > 1000 && songBitDepth == 16 && songSampleRate == 44100) {\r\n        sIdent = \"CD\";\r\n    }\r\n    else if (songBitrate > 7000 && songBitDepth >= 24 && songSampleRate >= 96000) {\r\n        sIdent = \"Hi-Res\";\r\n    }\r\n\r\n    // Based of Tidal/Amazon Music Unlimited/Deezer/Qobuz\r\n    switch (songQuality + \":\" + songActualQuality) {\r\n        case \"2:LOSSLESS\": // Tidal\r\n        case \":LOSSLESS\": // Tidal\r\n            sIdent = \"HIGH\";\r\n            break;\r\n        case \"3:HI_RES\": // Tidal\r\n            sIdent = \"MQA\";\r\n            break;\r\n        case \"4:HI_RES_LOSSLESS\": // Tidal\r\n        case \":HI_RES_LOSSLESS\": // Tidal\r\n        case \"0:LOSSLESS\": // Deezer\r\n            sIdent = \"FLAC\";\r\n            break;\r\n        case \":UHD\": // Amazon Music\r\n            sIdent = \"ULTRA HD\";\r\n            break;\r\n        case \":HD\":\r\n            sIdent = \"HD\"; // Amazon Music\r\n            break;\r\n        case \"3:7\":\r\n        case \"4:27\":\r\n            sIdent = \"Hi-Res\"; // Qobuz\r\n            break;\r\n        case \"2:6\":\r\n            sIdent = \"CD\"; // Qobuz\r\n            break;\r\n    };\r\n\r\n    return sIdent;\r\n\r\n};\r\n\r\n/**\r\n * Format bytes into human-readable units.\r\n * @param {number} bytes - byte value.\r\n * @returns {string} formatted value.\r\n */\r\nWNP.formatBytes = function (bytes) {\r\n    if (typeof bytes !== \"number\" || Number.isNaN(bytes)) {\r\n        return \"-\";\r\n    }\r\n    if (bytes === 0) {\r\n        return \"0 B\";\r\n    }\r\n    const units = [\"B\", \"KB\", \"MB\", \"GB\"];\r\n    const exponent = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);\r\n    const value = bytes / Math.pow(1024, exponent);\r\n    return `${value.toFixed(value >= 10 || exponent === 0 ? 0 : 1)} ${units[exponent]}`;\r\n};\r\n\r\n/**\r\n * Update the Lyrics cache settings\r\n * @param {void}\r\n * @returns {void}\r\n */\r\nWNP.updateLyricsCacheSettings = function () {\r\n    const cacheSettings = WNP.d.serverSettings?.features?.lyrics?.cache || {};\r\n    if (WNP.r.lyricsCacheEnabled) {\r\n        WNP.r.lyricsCacheEnabled.innerText = (typeof cacheSettings.enabled === \"boolean\")\r\n            ? (cacheSettings.enabled ? \"true\" : \"false\")\r\n            : \"-\";\r\n    }\r\n    if (WNP.r.lyricsCachePrefetchMode) {\r\n        WNP.r.lyricsCachePrefetchMode.innerText = cacheSettings.prefetch || \"-\";\r\n    }\r\n    if (WNP.r.lyricsCachePrefetchConcurrency) {\r\n        WNP.r.lyricsCachePrefetchConcurrency.innerText = (typeof cacheSettings.maxPrefetchConcurrency === \"number\")\r\n            ? cacheSettings.maxPrefetchConcurrency\r\n            : \"-\";\r\n    }\r\n};\r\n\r\n// =======================================================\r\n// Start WiiM Now Playing app debugger\r\nWNP.Init();\r\n"],"names":["window","WNP","s","locHostname","location","hostname","locPort","port","rndAlbumArtUri","aDeviceUI","aServerUI","aTicksUI","aDebugUI","d","serverSettings","deviceList","prevTransportState","prevPlayMedium","prevSourceIdent","prevTrackInfo","r","Init","console","log","socket","io","connect","setUIReferences","setTickHandlers","setSocketDefinitions","setUIListeners","setTimeout","tickServerSettingsUp","classList","add","emit","tickDevicesGetUp","tickPresetsListUp","rndAlbumArt","setInterval","addElementToRef","id","element","document","getElementById","warn","forEach","removeTickAnimate","e","target","remove","tick","addEventListener","selDeviceChoices","tickDeviceSetUp","value","btnDevices","btnRefresh","tickDevicesRefreshUp","btnGetVolume","tickVolumeGetUp","btnSetVolume","volume","parseInt","devVol","isNaN","alert","tickVolumeSetUp","btnReboot","btnUpdate","btnShutdown","btnReloadUI","reload","chkLyricsEnabled","features","lyrics","enabled","checked","on","msg","tickServerSettingsDown","sServerSettings","innerHTML","JSON","stringify","os","userInfo","shell","disabled","devName","innerText","selectedDevice","friendlyName","sManufacturer","manufacturer","sModelName","modelName","sLocation","sUrl","toLowerCase","sServerUrlHostname","networkInterfaces","aIpAddress","sLocationIp","split","pop","sIpPattern","join","Object","keys","key","index","sIpFound","find","addr","address","startsWith","sServerUrlIP","sServerVersion","version","server","sClientVersion","client","Boolean","updateLyricsCacheSettings","tickDevicesGetDown","sort","a","b","devicesWiiM","filter","length","optGroup","createElement","label","device","opt","title","setAttribute","appendChild","devicesOther","tickStateDown","state","timeStampDiff","CurrentTransportState","stateTimeStamp","metadataTimeStamp","Math","round","relTime","RelTime","trackDuration","TrackDuration","sTimeStampDiff","oPlayerProgress","getPlayerProgress","sPlayerProgress","PlayMedium","sTransportState","sPlayMedium","tickMetadataDown","metadata","playMedium","trackSource","TrackSource","sourceIdent","getSourceIdent","mediaSource","mediaTitle","trackMetaData","mediaSubTitle","mediaArtist","mediaAlbum","songBitrate","songBitDepth","songSampleRate","mediaBitRate","toFixed","mediaBitDepth","mediaSampleRate","songQuality","songActualQuality","qualiIdent","getQualityIdent","mediaQualityIdent","albumArtUriRaw","albumArtUri","checkAlbumArtURI","trackChanged","currentTrackInfo","currentAlbumArt","sAlbumArtUri","sAlbumArtUriRaw","CurrentVolume","LoopMode","mediaLoopMode","tickLyricsDown","lyricsStatus","status","lyricsTrackKey","trackKey","tickDeviceSetDown","tickDevicesRefreshDown","param","tickPresetsListDown","sPresetsList","sCurrentTitle","sCurrentSubtitle","oPresetsGroup","preset_list","preset","btn","type","number","name","Array","from","children","p","tickVolumeGetDown","undefined","vol","tickVolumeSetDown","currentTransportState","relTimeSec","convertToSeconds","trackDurationSec","percentPlayed","played","convertToMinutes","left","total","percent","sDuration","timeSections","totalSeconds","i","nMultiplier","pow","seconds","tempDate","Date","setSeconds","toISOString","substring","nTimestamp","img","Image","onload","width","height","sAlbumArtUriStatus","onerror","error","sAlbumArtProxyUri","src","encodeURIComponent","prefix","rndNumber","min","max","floor","random","sIdentUri","sIdent","formatBytes","bytes","Number","units","exponent","cacheSettings","cache","lyricsCacheEnabled","lyricsCachePrefetchMode","prefetch","lyricsCachePrefetchConcurrency","maxPrefetchConcurrency"],"version":3,"file":"debug.d17928de.js.map"}