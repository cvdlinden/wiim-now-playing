window.WNP=window.WNP||{},WNP.s={locHostname:location.hostname,locPort:location.port&&"80"!=location.port&&"1234"!=location.port?location.port:"80",rndAlbumArtUri:"./img/fake-album-1.jpg",aDeviceUI:["btnRefresh","selDeviceChoices","devName","mediaTitle","mediaSubTitle","mediaArtist","mediaAlbum","mediaBitRate","mediaBitDepth","mediaSampleRate","mediaQualityIdent","devVol","mediaSource"],aServerUI:["btnReboot","btnUpdate","btnShutdown","btnReloadUI","sServerUrlHostname","sServerUrlIP","sServerVersion","sClientVersion"],aTicksUI:["tickDevicesGetUp","tickDevicesRefreshUp","tickServerSettingsUp","tickStateUp","tickStateDown","tickMetadataUp","tickMetadataDown","tickDeviceSetUp","tickDeviceSetDown","tickServerSettingsDown","tickDevicesGetDown","tickDevicesRefreshDown","tickVolumeGetUp","tickVolumeGetDown","tickVolumeSetUp","tickVolumeSetDown","tickPresetsListUp","tickPresetsListDown"],aDebugUI:["state","metadata","sPresetsList","sServerSettings","sManufacturer","sModelName","sLocation","sTimeStampDiff","sAlbumArtUri","sAlbumArtUriRaw","sAlbumArtUriStatus","oPresetsGroup","btnDevices","btnGetVolume","btnSetVolume","mediaLoopMode"]},WNP.d={serverSettings:null,deviceList:null,prevTransportState:null,prevPlayMedium:null,prevSourceIdent:null,prevTrackInfo:null},WNP.r={},WNP.Init=function(){console.log("WNP","Initialising..."),console.log("WNP","Listening on "+this.s.locHostname+":"+this.s.locPort),window.socket=io.connect(":"+this.s.locPort),this.setUIReferences(),this.setTickHandlers(),this.setSocketDefinitions(),this.setUIListeners(),setTimeout(()=>{this.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),this.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),this.r.tickPresetsListUp.classList.add("tickAnimate"),socket.emit("device-api","getPresetInfo")},500),WNP.s.rndAlbumArtUri=WNP.rndAlbumArt("fake-album-"),setInterval(function(){WNP.s.rndAlbumArtUri=WNP.rndAlbumArt("fake-album-")},18e4)},WNP.setUIReferences=function(){function e(e){let t=document.getElementById(e);t?WNP.r[e]=t:console.warn("WNP",`Element with ID '${e}' not found.`)}console.log("WNP","Set UI references..."),this.s.aDeviceUI.forEach(t=>{e(t)}),this.s.aServerUI.forEach(t=>{e(t)}),this.s.aTicksUI.forEach(t=>{e(t)}),this.s.aDebugUI.forEach(t=>{e(t)})},WNP.setTickHandlers=function(){function e(e){e.target.classList.remove("tickAnimate")}this.s.aTicksUI.forEach(t=>{this.r[t]?this.r[t].addEventListener("animationend",e):console.warn("WNP",`Element with ID '${t}' not found.`)})},WNP.setUIListeners=function(){console.log("WNP","Set UI Listeners..."),this.r.selDeviceChoices.addEventListener("change",function(){WNP.r.tickDeviceSetUp.classList.add("tickAnimate"),socket.emit("device-set",this.value)}),this.r.btnDevices.addEventListener("click",function(){WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get")}),this.r.btnRefresh.addEventListener("click",function(){WNP.r.tickDevicesRefreshUp.classList.add("tickAnimate"),socket.emit("devices-refresh"),setTimeout(()=>{WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),WNP.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),WNP.r.tickPresetsListUp.classList.add("tickAnimate"),socket.emit("device-api","getPresetInfo")},5e3)}),this.r.btnGetVolume.addEventListener("click",function(){WNP.r.tickVolumeGetUp.classList.add("tickAnimate"),socket.emit("device-api","getPlayerStatus")}),this.r.btnSetVolume.addEventListener("click",function(){var e=parseInt(WNP.r.devVol.value);if(isNaN(e)||e<0||e>100)return void alert("Please enter a valid volume between 0 and 100.");WNP.r.tickVolumeSetUp.classList.add("tickAnimate"),socket.emit("device-api","setPlayerCmd:vol:"+e)}),this.r.btnReboot.addEventListener("click",function(){socket.emit("server-reboot")}),this.r.btnUpdate.addEventListener("click",function(){socket.emit("server-update")}),this.r.btnShutdown.addEventListener("click",function(){socket.emit("server-shutdown")}),this.r.btnReloadUI.addEventListener("click",function(){location.reload()})},WNP.setSocketDefinitions=function(){console.log("WNP","Setting Socket definitions..."),socket.on("server-settings",function(e){if(console.log("IO: server-settings",e),WNP.r.tickServerSettingsDown.classList.add("tickAnimate"),WNP.d.serverSettings=e,WNP.r.sServerSettings.innerHTML=JSON.stringify(e),e&&e.os&&e.os.userInfo&&"/bin/bash"===e.os.userInfo.shell&&(WNP.r.btnReboot.disabled=!1,WNP.r.btnUpdate.disabled=!1,WNP.r.btnShutdown.disabled=!1),WNP.r.devName.innerText=e&&e.selectedDevice&&e.selectedDevice.friendlyName?e.selectedDevice.friendlyName:"-",WNP.r.sManufacturer.innerText=e&&e.selectedDevice&&e.selectedDevice.manufacturer?e.selectedDevice.manufacturer:"-",WNP.r.sModelName.innerText=e&&e.selectedDevice&&e.selectedDevice.modelName?e.selectedDevice.modelName:"-",WNP.r.sLocation.innerHTML=e&&e.selectedDevice&&e.selectedDevice.location?'<a href="'+e.selectedDevice.location+'">'+e.selectedDevice.location+"</a>":"-",e&&e.os&&e.os.hostname){var t="http://"+e.os.hostname.toLowerCase()+".local";t+=location&&location.port&&80!=location.port?":"+location.port+"/":"/",WNP.r.sServerUrlHostname.innerHTML='<a href="'+t+'">'+t+"</a>"}else WNP.r.sServerUrlHostname.innerText="-";if(e&&e.selectedDevice&&e.selectedDevice.location&&e.os&&e.os.networkInterfaces){var i=e.selectedDevice.location.split("/")[2].split(".");i.pop();var a=i.join(".");Object.keys(e.os.networkInterfaces).forEach(function(t,i){var s=e.os.networkInterfaces[t].find(e=>e.address.startsWith(a));if(s){var r="http://"+s.address;r+=location&&location.port&&80!=location.port?":"+location.port+"/":"/",WNP.r.sServerUrlIP.innerHTML='<a href="'+r+'">'+r+"</a>"}})}else WNP.r.sServerUrlIP.innerText="-";WNP.r.sServerVersion.innerText=e&&e.version&&e.version.server?e.version.server:"-",WNP.r.sClientVersion.innerText=e&&e.version&&e.version.client?e.version.client:"-"}),socket.on("devices-get",function(e){console.log("IO: devices-get",e),WNP.r.tickDevicesGetDown.classList.add("tickAnimate"),WNP.d.deviceList=e,WNP.d.deviceList.sort((e,t)=>e.friendlyName<t.friendlyName?-1:1),WNP.r.selDeviceChoices.innerHTML='<option value="">Select a device...</em></li>';var t=WNP.d.deviceList.filter(e=>e.manufacturer.startsWith("Linkplay"));if(t.length>0){var i=document.createElement("optgroup");i.label="WiiM devices",t.forEach(e=>{var t=document.createElement("option");t.value=e.location,t.innerText=e.friendlyName,t.title="By "+e.manufacturer,WNP.d.serverSettings&&WNP.d.serverSettings.selectedDevice&&WNP.d.serverSettings.selectedDevice.location===e.location&&t.setAttribute("selected","selected"),i.appendChild(t)}),WNP.r.selDeviceChoices.appendChild(i)}var a=WNP.d.deviceList.filter(e=>!e.manufacturer.startsWith("Linkplay"));if(a.length>0){var i=document.createElement("optgroup");i.label="Other devices",a.forEach(e=>{var t=document.createElement("option");t.value=e.location,t.innerText=e.friendlyName,t.title="By "+e.manufacturer,WNP.d.serverSettings&&WNP.d.serverSettings.selectedDevice&&WNP.d.serverSettings.selectedDevice.location===e.location&&t.setAttribute("selected","selected"),i.appendChild(t)}),WNP.r.selDeviceChoices.appendChild(i)}0==t.length&&0==a.length&&(WNP.r.selDeviceChoices.innerHTML='<option disabled="disabled">No devices found!</em></li>')}),socket.on("state",function(e){if(!e)return!1;if(WNP.r.tickStateDown.classList.add("tickAnimate"),WNP.r.state.innerHTML=JSON.stringify(e),e&&e.stateTimeStamp&&e.metadataTimeStamp){var t=e.stateTimeStamp&&e.metadataTimeStamp?Math.round((e.stateTimeStamp-e.metadataTimeStamp)/1e3):0;WNP.r.sTimeStampDiff.innerHTML=t+"s"}else WNP.r.sTimeStampDiff.innerHTML=""}),socket.on("metadata",function(e){if(!e)return!1;WNP.r.tickMetadataDown.classList.add("tickAnimate"),WNP.r.metadata.innerHTML=JSON.stringify(e);var t=e.PlayMedium?e.PlayMedium:"",i=e.TrackSource?e.TrackSource:"",a=WNP.getSourceIdent(t,i);a!==WNP.d.prevSourceIdent&&(""!==a?mediaSource.innerText=t+": "+i+" ("+a+")":mediaSource.innerText=t+": "+i,WNP.d.prevSourceIdent=a),WNP.r.mediaTitle.innerText=e.trackMetaData&&e.trackMetaData["dc:title"]?e.trackMetaData["dc:title"]:"",WNP.r.mediaSubTitle.innerText=e.trackMetaData&&e.trackMetaData["dc:subtitle"]?e.trackMetaData["dc:subtitle"]:"",WNP.r.mediaArtist.innerText=e.trackMetaData&&e.trackMetaData["upnp:artist"]?e.trackMetaData["upnp:artist"]:"",WNP.r.mediaAlbum.innerText=e.trackMetaData&&e.trackMetaData["upnp:album"]?e.trackMetaData["upnp:album"]:"";var s=e.trackMetaData&&e.trackMetaData["song:bitrate"]?e.trackMetaData["song:bitrate"]:"",r=e.trackMetaData&&e.trackMetaData["song:format_s"]?e.trackMetaData["song:format_s"]:"",n=e.trackMetaData&&e.trackMetaData["song:rate_hz"]?e.trackMetaData["song:rate_hz"]:"";WNP.r.mediaBitRate.innerText=s>0?s>1e3?(s/1e3).toFixed(2)+" mbps ("+s+")":s+" kbps ("+s+")":"",WNP.r.mediaBitDepth.innerText=r>0?r>24?"24 bit ("+r+")":r+" bit ("+r+")":"",WNP.r.mediaSampleRate.innerText=n>0?(n/1e3).toFixed(1)+" kHz ("+n+")":"";var c=e.trackMetaData&&e.trackMetaData["song:quality"]?e.trackMetaData["song:quality"]:"",o=e.trackMetaData&&e.trackMetaData["song:actualQuality"]?e.trackMetaData["song:actualQuality"]:"",l=WNP.getQualityIdent(c,o,s,r,n);""!==l?WNP.r.mediaQualityIdent.innerText=l+" ("+c+", "+o+")":WNP.r.mediaQualityIdent.innerText=c+", "+o;var d=e.trackMetaData&&e.trackMetaData["upnp:albumArtURI"]?e.trackMetaData["upnp:albumArtURI"]:"",m=WNP.checkAlbumArtURI(d,e.metadataTimeStamp),u=!1,k=WNP.r.mediaTitle.innerText+"|"+WNP.r.mediaSubTitle.innerText+"|"+WNP.r.mediaArtist.innerText+"|"+WNP.r.mediaAlbum.innerText,v=WNP.r.sAlbumArtUri.innerText;if(WNP.d.prevTrackInfo!==k&&(u=!0,WNP.d.prevTrackInfo=k,console.log("WNP","Track changed:",k)),u&&v!=m&&(WNP.r.sAlbumArtUriRaw.innerText=d,WNP.r.sAlbumArtUri.innerText=m),WNP.r.devVol.value=e.CurrentVolume?e.CurrentVolume:"-",e.LoopMode)switch(e.LoopMode){case"5":WNP.r.mediaLoopMode.innerText="Shuffle enabled, Repeat enabled - loop once";break;case"3":WNP.r.mediaLoopMode.innerText="Shuffle enabled, Repeat disabled";break;case"2":WNP.r.mediaLoopMode.innerText="Shuffle enabled, Repeat enabled - loop";break;case"1":WNP.r.mediaLoopMode.innerText="Shuffle disabled, Repeat enabled - loop once";break;case"0":WNP.r.mediaLoopMode.innerText="Shuffle disabled, Repeat enabled - loop";break;default:WNP.r.mediaLoopMode.innerText="Shuffle disabled, Repeat disabled"}else WNP.r.mediaLoopMode.innerText="Unknown"}),socket.on("device-set",function(e){console.log("IO: device-set",e),WNP.r.tickDeviceSetDown.classList.add("tickAnimate"),WNP.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),WNP.r.tickVolumeGetUp.classList.add("tickAnimate"),socket.emit("device-api","getPlayerStatus"),WNP.r.tickPresetsListUp.classList.add("tickAnimate"),socket.emit("device-api","getPresetInfo")}),socket.on("devices-refresh",function(e){console.log("IO: devices-refresh",e),WNP.r.tickDevicesRefreshDown.classList.add("tickAnimate"),WNP.r.selDeviceChoices.innerHTML='<option disabled="disabled">Waiting for devices...</em></li>'}),socket.on("device-action",function(e,t){console.log("WNP","Action:",e)}),socket.on("device-api",function(e,t){switch(console.log("IO: device-api",e,t),e){case"getPresetInfo":WNP.r.tickPresetsListDown.classList.add("tickAnimate"),WNP.r.sPresetsList.innerHTML=t?JSON.stringify(t):"";var i=WNP.r.mediaTitle.innerText,a=WNP.r.mediaSubTitle.innerText;if(WNP.r.oPresetsGroup)if(WNP.r.oPresetsGroup.innerHTML="",t&&t.preset_list&&t.preset_list.length>0)t.preset_list.forEach(e=>{var t=document.createElement("button");t.type="button",t.classList="btn btn-secondary",t.innerText=e.number,t.title=e.name,(e.name===i||e.name===a)&&t.classList.add("active"),t.addEventListener("click",function(){socket.emit("device-api","MCUKeyShortClick:"+e.number),Array.from(WNP.r.oPresetsGroup.children).forEach(e=>{e.classList.remove("active")}),t.classList.add("active")}),WNP.r.oPresetsGroup.appendChild(t)});else{var s=document.createElement("p");s.classList="form-text text-white",s.innerText="No presets found",WNP.r.oPresetsGroup.appendChild(s)}break;case!!e.startsWith("MCUKeyShortClick:")&&e:break;case"getPlayerStatus":WNP.r.tickVolumeGetDown.classList.add("tickAnimate"),t&&void 0!==t.vol&&(WNP.r.devVol.value=t.vol);break;case!!e.startsWith("setPlayerCmd:vol:")&&e:WNP.r.tickVolumeSetDown.classList.add("tickAnimate"),socket.emit("device-api","getPlayerStatus")}})},WNP.checkAlbumArtURI=function(e,t){var i=new Image;if(i.onload=function(){console.log("WNP","Album art loaded successfully.","Size: "+this.width+"x"+this.height+"px"),WNP.r.sAlbumArtUriStatus.classList="bi bi-check-circle-fill",WNP.r.sAlbumArtUriStatus.title="Able to load album art"},i.onerror=function(){console.error("WNP","Failed to load album art:",e),WNP.r.sAlbumArtUriStatus.classList="bi bi-x-circle-fill",WNP.r.sAlbumArtUriStatus.title="Unable to load album art"},e&&e.startsWith("https")){var a="";return i.src=a="80"!=WNP.s.locPort?"http://"+WNP.s.locHostname+":"+WNP.s.locPort+"/proxy-art?url="+encodeURIComponent(e)+"&ts="+t:"http://"+WNP.s.locHostname+"/proxy-art?url="+encodeURIComponent(e)+"&ts="+t,a}return e&&e.startsWith("http")?(i.src=e,e):(WNP.r.sAlbumArtUriStatus.classList="bi bi-exclamation-circle-fill",WNP.r.sAlbumArtUriStatus.title="Falling back to random album art",WNP.s.rndAlbumArtUri)},WNP.rndAlbumArt=function(e){return"./img/"+e+this.rndNumber(1,16)+".jpg"},WNP.rndNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},WNP.getSourceIdent=function(e,t){var i="";switch(e.toLowerCase()){case"airplay":i="./img/sources/airplay2.png";break;case"third-dlna":i="./img/sources/dlna2.png";break;case"cast":i="./img/sources/chromecast2.png";break;case"radio-network":i="./img/sources/radio.png";break;case"songlist-network":i="./img/sources/ethernet2.png";break;case"spotify":i="./img/sources/spotify.png";break;case"squeezelite":i="./img/sources/music-assistant2.png";break;case"none":i="./img/sources/none2.png";break;case"bluetooth":i="./img/sources/bluetooth2.png";break;case"hdmi":i="./img/sources/hdmi2.png";break;case"line-in":i="./img/sources/line-in2.png";break;case"optical":i="./img/sources/spdif2.png"}switch(t.toLowerCase()){case"deezer":case"deezer2":i="./img/sources/deezer.png";break;case"iheartradio":i="./img/sources/iheart.png";break;case"newtunein":i="./img/sources/newtunein.png";break;case"plex":i="./img/sources/plex.png";break;case"prime":i="./img/sources/amazon-music2.png";break;case"qobuz":i="./img/sources/qobuz2.png";break;case"tidal":i="./img/sources/tidal2.png";break;case"upnpserver":i="./img/sources/dlna2.png";break;case"vtuner":i="./img/sources/vtuner2.png"}return i},WNP.getQualityIdent=function(e,t,i,a,s){var r="";switch(i>=700&&24==a&&44100==s&&(r="Lossless"),i>1e3&&16==a&&44100==s?r="CD":i>7e3&&a>=24&&s>=96e3&&(r="Hi-Res"),e+":"+t){case"2:LOSSLESS":case":LOSSLESS":r="HIGH";break;case"3:HI_RES":r="MQA";break;case"4:HI_RES_LOSSLESS":case":HI_RES_LOSSLESS":case"0:LOSSLESS":r="FLAC";break;case":UHD":r="ULTRA HD";break;case":HD":r="HD";break;case"3:7":case"4:27":r="Hi-Res";break;case"2:6":r="CD"}return r},WNP.Init();
//# sourceMappingURL=debug.b946c1b5.js.map
