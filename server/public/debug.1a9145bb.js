window.WNP=window.WNP||{},WNP.s={locHostname:location.hostname,locPort:location.port&&"80"!=location.port&&"1234"!=location.port?location.port:"80",rndAlbumArtUri:"./img/fake-album-1.jpg",aDeviceUI:["btnRefresh","selDeviceChoices","devName","mediaTitle","mediaSubTitle","mediaArtist","mediaAlbum","mediaBitRate","mediaBitDepth","mediaSampleRate","mediaQualityIdent","devVol","mediaSource"],aServerUI:["btnReboot","btnUpdate","btnShutdown","btnReloadUI","sServerUrlHostname","sServerUrlIP","sServerVersion","sClientVersion"],aTicksUI:["tickDevicesGetUp","tickDevicesRefreshUp","tickServerSettingsUp","tickStateUp","tickStateDown","tickMetadataUp","tickMetadataDown","tickLyricsUp","tickLyricsDown","tickDeviceSetUp","tickDeviceSetDown","tickServerSettingsDown","tickDevicesGetDown","tickDevicesRefreshDown","tickVolumeGetUp","tickVolumeGetDown","tickVolumeSetUp","tickVolumeSetDown","tickPresetsListUp","tickPresetsListDown"],aDebugUI:["state","metadata","lyrics","lyricsStatus","lyricsProvider","lyricsTrackKey","lyricsCacheEnabled","lyricsCacheStatus","lyricsCacheSize","lyricsCacheMax","lyricsCachePrefetchMode","lyricsCachePrefetchConcurrency","lyricsPrefetch","lyricsPrefetchStatus","lyricsPrefetchTrackKey","lyricsPrefetchMode","lyricsPrefetchReason","sPresetsList","sServerSettings","sManufacturer","sModelName","sLocation","sTimeStampDiff","sAlbumArtUri","sAlbumArtUriRaw","sAlbumArtUriStatus","oPresetsGroup","btnDevices","btnGetVolume","btnSetVolume","mediaLoopMode","sTransportState","sPlayMedium","sPlayerProgress"]},WNP.d={serverSettings:null,deviceList:null,prevTransportState:null,prevPlayMedium:null,prevSourceIdent:null,prevTrackInfo:null},WNP.r={},WNP.formatBytes=function(e){if("number"!=typeof e||Number.isNaN(e))return"-";if(0===e)return"0 B";let t=["B","KB","MB","GB"],r=Math.min(Math.floor(Math.log(e)/Math.log(1024)),t.length-1),i=e/Math.pow(1024,r);return`${i.toFixed(i>=10||0===r?0:1)} ${t[r]}`},WNP.updateLyricsCacheSettings=function(){let e=WNP.d.serverSettings?.features?.lyrics?.cache||{};WNP.r.lyricsCacheEnabled&&(WNP.r.lyricsCacheEnabled.innerText="boolean"==typeof e.enabled?e.enabled?"true":"false":"-"),WNP.r.lyricsCachePrefetchMode&&(WNP.r.lyricsCachePrefetchMode.innerText=e.prefetch||"-"),WNP.r.lyricsCachePrefetchConcurrency&&(WNP.r.lyricsCachePrefetchConcurrency.innerText="number"==typeof e.maxPrefetchConcurrency?e.maxPrefetchConcurrency:"-")},WNP.Init=function(){console.log("WNP","Initialising..."),console.log("WNP","Listening on "+this.s.locHostname+":"+this.s.locPort),window.socket=io.connect(":"+this.s.locPort),this.setUIReferences(),this.setTickHandlers(),this.setSocketDefinitions(),this.setUIListeners(),setTimeout(()=>{this.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),this.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),this.r.tickPresetsListUp.classList.add("tickAnimate"),socket.emit("device-api","getPresetInfo")},500),WNP.s.rndAlbumArtUri=WNP.rndAlbumArt("fake-album-"),setInterval(function(){WNP.s.rndAlbumArtUri=WNP.rndAlbumArt("fake-album-")},18e4)},WNP.setUIReferences=function(){function e(e){let t=document.getElementById(e);t?WNP.r[e]=t:console.warn("WNP",`Element with ID '${e}' not found in current HTML.`)}console.log("WNP","Set UI references..."),this.s.aDeviceUI.forEach(t=>{e(t)}),this.s.aServerUI.forEach(t=>{e(t)}),this.s.aTicksUI.forEach(t=>{e(t)}),this.s.aDebugUI.forEach(t=>{e(t)})},WNP.setTickHandlers=function(){function e(e){e.target.classList.remove("tickAnimate")}this.s.aTicksUI.forEach(t=>{this.r[t]?this.r[t].addEventListener("animationend",e):console.warn("WNP",`Element with ID '${t}' not found.`)})},WNP.setUIListeners=function(){console.log("WNP","Set UI Listeners..."),this.r.selDeviceChoices.addEventListener("change",function(){WNP.r.tickDeviceSetUp.classList.add("tickAnimate"),socket.emit("device-set",this.value)}),this.r.btnDevices.addEventListener("click",function(){WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get")}),this.r.btnRefresh.addEventListener("click",function(){WNP.r.tickDevicesRefreshUp.classList.add("tickAnimate"),socket.emit("devices-refresh"),setTimeout(()=>{WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),WNP.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),WNP.r.tickPresetsListUp.classList.add("tickAnimate"),socket.emit("device-api","getPresetInfo")},5e3)}),this.r.btnGetVolume.addEventListener("click",function(){WNP.r.tickVolumeGetUp.classList.add("tickAnimate"),socket.emit("device-api","getPlayerStatus")}),this.r.btnSetVolume.addEventListener("click",function(){var e=parseInt(WNP.r.devVol.value);isNaN(e)||e<0||e>100?alert("Please enter a valid volume between 0 and 100."):(WNP.r.tickVolumeSetUp.classList.add("tickAnimate"),socket.emit("device-api","setPlayerCmd:vol:"+e))}),this.r.btnReboot.addEventListener("click",function(){socket.emit("server-reboot")}),this.r.btnUpdate.addEventListener("click",function(){socket.emit("server-update")}),this.r.btnShutdown.addEventListener("click",function(){socket.emit("server-shutdown")}),this.r.btnReloadUI.addEventListener("click",function(){location.reload()})},WNP.setSocketDefinitions=function(){console.log("WNP","Setting Socket definitions..."),socket.on("server-settings",function(e){if(console.log("IO: server-settings",e),WNP.r.tickServerSettingsDown.classList.add("tickAnimate"),WNP.d.serverSettings=e,WNP.r.sServerSettings.innerHTML=JSON.stringify(e),e&&e.os&&e.os.userInfo&&"/bin/bash"===e.os.userInfo.shell&&(WNP.r.btnReboot.disabled=!1,WNP.r.btnUpdate.disabled=!1,WNP.r.btnShutdown.disabled=!1),WNP.r.devName.innerText=e&&e.selectedDevice&&e.selectedDevice.friendlyName?e.selectedDevice.friendlyName:"-",WNP.r.sManufacturer.innerText=e&&e.selectedDevice&&e.selectedDevice.manufacturer?e.selectedDevice.manufacturer:"-",WNP.r.sModelName.innerText=e&&e.selectedDevice&&e.selectedDevice.modelName?e.selectedDevice.modelName:"-",WNP.r.sLocation.innerHTML=e&&e.selectedDevice&&e.selectedDevice.location?'<a href="'+e.selectedDevice.location+'">'+e.selectedDevice.location+"</a>":"-",e&&e.os&&e.os.hostname){var t="http://"+e.os.hostname.toLowerCase()+".local";t+=location&&location.port&&80!=location.port?":"+location.port+"/":"/",WNP.r.sServerUrlHostname.innerHTML='<a href="'+t+'">'+t+"</a>"}else WNP.r.sServerUrlHostname.innerText="-";if(e&&e.selectedDevice&&e.selectedDevice.location&&e.os&&e.os.networkInterfaces){var r=e.selectedDevice.location.split("/")[2].split(".");r.pop();var i=r.join(".");Object.keys(e.os.networkInterfaces).forEach(function(t,r){var a=e.os.networkInterfaces[t].find(e=>e.address.startsWith(i));if(a){var s="http://"+a.address;s+=location&&location.port&&80!=location.port?":"+location.port+"/":"/",WNP.r.sServerUrlIP.innerHTML='<a href="'+s+'">'+s+"</a>"}})}else WNP.r.sServerUrlIP.innerText="-";WNP.r.sServerVersion.innerText=e&&e.version&&e.version.server?e.version.server:"-",WNP.r.sClientVersion.innerText=e&&e.version&&e.version.client?e.version.client:"-",WNP.updateLyricsCacheSettings()}),socket.on("devices-get",function(e){console.log("IO: devices-get",e),WNP.r.tickDevicesGetDown.classList.add("tickAnimate"),WNP.d.deviceList=e,WNP.d.deviceList.sort((e,t)=>e.friendlyName<t.friendlyName?-1:1),WNP.r.selDeviceChoices.innerHTML='<option value="">Select a device...</em></li>';var t=WNP.d.deviceList.filter(e=>e.manufacturer.startsWith("Linkplay"));if(t.length>0){var r=document.createElement("optgroup");r.label="WiiM devices",t.forEach(e=>{var t=document.createElement("option");t.value=e.location,t.innerText=e.friendlyName,t.title="By "+e.manufacturer,WNP.d.serverSettings&&WNP.d.serverSettings.selectedDevice&&WNP.d.serverSettings.selectedDevice.location===e.location&&t.setAttribute("selected","selected"),r.appendChild(t)}),WNP.r.selDeviceChoices.appendChild(r)}var i=WNP.d.deviceList.filter(e=>!e.manufacturer.startsWith("Linkplay"));if(i.length>0){var r=document.createElement("optgroup");r.label="Other devices",i.forEach(e=>{var t=document.createElement("option");t.value=e.location,t.innerText=e.friendlyName,t.title="By "+e.manufacturer,WNP.d.serverSettings&&WNP.d.serverSettings.selectedDevice&&WNP.d.serverSettings.selectedDevice.location===e.location&&t.setAttribute("selected","selected"),r.appendChild(t)}),WNP.r.selDeviceChoices.appendChild(r)}0==t.length&&0==i.length&&(WNP.r.selDeviceChoices.innerHTML='<option disabled="disabled">No devices found!</em></li>')}),socket.on("state",function(e){if(!e)return!1;WNP.r.tickStateDown.classList.add("tickAnimate"),WNP.r.state.innerHTML=JSON.stringify(e);var t=0;"PLAYING"===e.CurrentTransportState&&(t=e.stateTimeStamp&&e.metadataTimeStamp?Math.round((e.stateTimeStamp-e.metadataTimeStamp)/1e3):0);var r=e.RelTime?e.RelTime:"00:00:00",i=e.TrackDuration?e.TrackDuration:"00:00:00";WNP.r.sTimeStampDiff.innerHTML=t+"s";var a=WNP.getPlayerProgress(r,i,t,e.CurrentTransportState);WNP.r.sPlayerProgress.innerText=JSON.stringify(a),(WNP.d.prevTransportState!==e.CurrentTransportState||WNP.d.prevPlayMedium!==e.PlayMedium)&&(WNP.r.sTransportState.innerText=e.CurrentTransportState,WNP.r.sPlayMedium.innerText=e.PlayMedium,WNP.d.prevTransportState=e.CurrentTransportState,WNP.d.prevPlayMedium=e.PlayMedium)}),socket.on("metadata",function(e){if(!e)return!1;WNP.r.tickMetadataDown.classList.add("tickAnimate"),WNP.r.metadata.innerHTML=JSON.stringify(e);var t=e.PlayMedium?e.PlayMedium:"",r=e.TrackSource?e.TrackSource:"",i=WNP.getSourceIdent(t,r);i!==WNP.d.prevSourceIdent&&(""!==i?mediaSource.innerText=t+": "+r+" ("+i+")":mediaSource.innerText=t+": "+r,WNP.d.prevSourceIdent=i),WNP.r.mediaTitle.innerText=e.trackMetaData&&e.trackMetaData["dc:title"]?e.trackMetaData["dc:title"]:"",WNP.r.mediaSubTitle.innerText=e.trackMetaData&&e.trackMetaData["dc:subtitle"]?e.trackMetaData["dc:subtitle"]:"",WNP.r.mediaArtist.innerText=e.trackMetaData&&e.trackMetaData["upnp:artist"]?e.trackMetaData["upnp:artist"]:"",WNP.r.mediaAlbum.innerText=e.trackMetaData&&e.trackMetaData["upnp:album"]?e.trackMetaData["upnp:album"]:"";var a=e.trackMetaData&&e.trackMetaData["song:bitrate"]?e.trackMetaData["song:bitrate"]:"",s=e.trackMetaData&&e.trackMetaData["song:format_s"]?e.trackMetaData["song:format_s"]:"",n=e.trackMetaData&&e.trackMetaData["song:rate_hz"]?e.trackMetaData["song:rate_hz"]:"";WNP.r.mediaBitRate.innerText=a>0?a>1e3?(a/1e3).toFixed(2)+" mbps ("+a+")":a+" kbps ("+a+")":"",WNP.r.mediaBitDepth.innerText=s>0?s>24?"24 bit ("+s+")":s+" bit ("+s+")":"",WNP.r.mediaSampleRate.innerText=n>0?(n/1e3).toFixed(1)+" kHz ("+n+")":"";var c=e.trackMetaData&&e.trackMetaData["song:quality"]?e.trackMetaData["song:quality"]:"",o=e.trackMetaData&&e.trackMetaData["song:actualQuality"]?e.trackMetaData["song:actualQuality"]:"",l=WNP.getQualityIdent(c,o,a,s,n);""!==l?WNP.r.mediaQualityIdent.innerText=l+" ("+c+", "+o+")":WNP.r.mediaQualityIdent.innerText=c+", "+o;var d=e.trackMetaData&&e.trackMetaData["upnp:albumArtURI"]?e.trackMetaData["upnp:albumArtURI"]:"",u=WNP.checkAlbumArtURI(d,e.metadataTimeStamp),m=!1,P=WNP.r.mediaTitle.innerText+"|"+WNP.r.mediaSubTitle.innerText+"|"+WNP.r.mediaArtist.innerText+"|"+WNP.r.mediaAlbum.innerText,p=WNP.r.sAlbumArtUri.innerText;if(WNP.d.prevTrackInfo!==P&&(m=!0,WNP.d.prevTrackInfo=P,console.log("WNP","Track changed:",P)),m&&p!=u&&(WNP.r.sAlbumArtUriRaw.innerText=d,WNP.r.sAlbumArtUri.innerText=u),WNP.r.devVol.value=e.CurrentVolume?e.CurrentVolume:"-",e.LoopMode)switch(e.LoopMode){case"5":WNP.r.mediaLoopMode.innerText="Shuffle enabled, Repeat enabled - loop once";break;case"3":WNP.r.mediaLoopMode.innerText="Shuffle enabled, Repeat disabled";break;case"2":WNP.r.mediaLoopMode.innerText="Shuffle enabled, Repeat enabled - loop";break;case"1":WNP.r.mediaLoopMode.innerText="Shuffle disabled, Repeat enabled - loop once";break;case"0":WNP.r.mediaLoopMode.innerText="Shuffle disabled, Repeat enabled - loop";break;default:WNP.r.mediaLoopMode.innerText="Shuffle disabled, Repeat disabled"}else WNP.r.mediaLoopMode.innerText="Unknown"}),socket.on("lyrics",function(e){console.log("IO: lyrics",e),WNP.r.tickLyricsDown.classList.add("tickAnimate"),WNP.r.lyrics.innerHTML=JSON.stringify(e),WNP.r.lyricsStatus.innerText=e&&e.status?e.status:"-",WNP.r.lyricsProvider.innerText=e&&e.provider?e.provider:"-",WNP.r.lyricsTrackKey.innerText=e&&e.trackKey?e.trackKey:"-";let t=e?.diagnostics||{};WNP.r.lyricsCacheStatus&&(WNP.r.lyricsCacheStatus.innerText=t.cacheStatus||"-"),WNP.r.lyricsCacheSize&&(WNP.r.lyricsCacheSize.innerText=WNP.formatBytes(t.cacheSizeBytes)),WNP.r.lyricsCacheMax&&(WNP.r.lyricsCacheMax.innerText=WNP.formatBytes(t.cacheMaxBytes)),WNP.updateLyricsCacheSettings()}),socket.on("lyrics-prefetch",function(e){console.log("IO: lyrics-prefetch",e),WNP.r.lyricsPrefetch&&(WNP.r.lyricsPrefetch.innerHTML=JSON.stringify(e)),WNP.r.lyricsPrefetchStatus&&(WNP.r.lyricsPrefetchStatus.innerText=e&&e.status?e.status:"-"),WNP.r.lyricsPrefetchTrackKey&&(WNP.r.lyricsPrefetchTrackKey.innerText=e&&e.trackKey?e.trackKey:"-"),WNP.r.lyricsPrefetchMode&&(WNP.r.lyricsPrefetchMode.innerText=e&&e.mode?e.mode:"-"),WNP.r.lyricsPrefetchReason&&(WNP.r.lyricsPrefetchReason.innerText=e&&e.reason?e.reason:"-")}),socket.on("device-set",function(e){console.log("IO: device-set",e),WNP.r.tickDeviceSetDown.classList.add("tickAnimate"),WNP.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),WNP.r.tickVolumeGetUp.classList.add("tickAnimate"),socket.emit("device-api","getPlayerStatus"),WNP.r.tickPresetsListUp.classList.add("tickAnimate"),socket.emit("device-api","getPresetInfo")}),socket.on("devices-refresh",function(e){console.log("IO: devices-refresh",e),WNP.r.tickDevicesRefreshDown.classList.add("tickAnimate"),WNP.r.selDeviceChoices.innerHTML='<option disabled="disabled">Waiting for devices...</em></li>'}),socket.on("device-action",function(e,t){console.log("WNP","Action:",e)}),socket.on("device-api",function(e,t){switch(console.log("IO: device-api",e,t),e){case"getPresetInfo":WNP.r.tickPresetsListDown.classList.add("tickAnimate"),WNP.r.sPresetsList.innerHTML=t?JSON.stringify(t):"";var r=WNP.r.mediaTitle.innerText,i=WNP.r.mediaSubTitle.innerText;if(WNP.r.oPresetsGroup)if(WNP.r.oPresetsGroup.innerHTML="",t&&t.preset_list&&t.preset_list.length>0)t.preset_list.forEach(e=>{var t=document.createElement("button");t.type="button",t.classList="btn btn-secondary",t.innerText=e.number,t.title=e.name,(e.name===r||e.name===i)&&t.classList.add("active"),t.addEventListener("click",function(){socket.emit("device-api","MCUKeyShortClick:"+e.number),Array.from(WNP.r.oPresetsGroup.children).forEach(e=>{e.classList.remove("active")}),t.classList.add("active")}),WNP.r.oPresetsGroup.appendChild(t)});else{var a=document.createElement("p");a.classList="form-text text-white",a.innerText="No presets found",WNP.r.oPresetsGroup.appendChild(a)}break;case!!e.startsWith("MCUKeyShortClick:")&&e:break;case"getPlayerStatus":WNP.r.tickVolumeGetDown.classList.add("tickAnimate"),t&&void 0!==t.vol&&(WNP.r.devVol.value=t.vol);break;case!!e.startsWith("setPlayerCmd:vol:")&&e:WNP.r.tickVolumeSetDown.classList.add("tickAnimate"),socket.emit("device-api","getPlayerStatus")}}),socket.on("server-reboot",function(e){console.log("WNP","Server reboot:",e)}),socket.on("server-update",function(e){console.log("WNP","Server update:",e)}),socket.on("server-shutdown",function(e){console.log("WNP","Server shutdown:",e)})},WNP.getPlayerProgress=function(e,t,r,i){var a=this.convertToSeconds(e)+r,s=this.convertToSeconds(t);if(s>0&&a<s){var n=(a/s*100).toFixed(1);return{played:WNP.convertToMinutes(a),left:WNP.convertToMinutes(s-a),total:WNP.convertToMinutes(s),percent:n}}return 0==s&&"PLAYING"==i?{played:"Live",left:"",total:"",percent:100}:{played:"Paused",left:"",total:"",percent:0}},WNP.convertToSeconds=function(e){let t=e.split(":"),r=0;for(let e=0;e<t.length;e++)r+=Math.pow(60,t.length-1-e)*parseInt(t[e]);return r},WNP.convertToMinutes=function(e){var t=new Date(0);return t.setSeconds(e),t.toISOString().substring(14,19)},WNP.checkAlbumArtURI=function(e,t){var r=new Image;if(r.onload=function(){console.log("WNP","Album art loaded successfully.","Size: "+this.width+"x"+this.height+"px"),WNP.r.sAlbumArtUriStatus.classList="bi bi-check-circle-fill",WNP.r.sAlbumArtUriStatus.title="Able to load album art"},r.onerror=function(){console.error("WNP","Failed to load album art:",e),WNP.r.sAlbumArtUriStatus.classList="bi bi-x-circle-fill",WNP.r.sAlbumArtUriStatus.title="Unable to load album art"},e&&e.startsWith("https")){var i="";return r.src=i="80"!=WNP.s.locPort?"http://"+WNP.s.locHostname+":"+WNP.s.locPort+"/proxy-art?url="+encodeURIComponent(e)+"&ts="+t:"http://"+WNP.s.locHostname+"/proxy-art?url="+encodeURIComponent(e)+"&ts="+t,i}return e&&e.startsWith("http")?(r.src=e,e):(WNP.r.sAlbumArtUriStatus.classList="bi bi-exclamation-circle-fill",WNP.r.sAlbumArtUriStatus.title="Falling back to random album art",WNP.s.rndAlbumArtUri)},WNP.rndAlbumArt=function(e){return"./img/"+e+this.rndNumber(1,16)+".jpg"},WNP.rndNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},WNP.getSourceIdent=function(e,t){var r="";switch(e.toLowerCase()){case"airplay":r="./img/sources/airplay2.png";break;case"third-dlna":r="./img/sources/dlna2.png";break;case"cast":r="./img/sources/chromecast2.png";break;case"radio-network":r="./img/sources/radio.png";break;case"songlist-network":r="./img/sources/ethernet2.png";break;case"spotify":r="./img/sources/spotify.png";break;case"squeezelite":r="./img/sources/music-assistant2.png";break;case"none":r="./img/sources/none2.png";break;case"bluetooth":r="./img/sources/bluetooth2.png";break;case"hdmi":r="./img/sources/hdmi2.png";break;case"line-in":r="./img/sources/line-in2.png";break;case"optical":r="./img/sources/spdif2.png"}switch(t.toLowerCase()){case"deezer":case"deezer2":r="./img/sources/deezer.png";break;case"iheartradio":r="./img/sources/iheart.png";break;case"newtunein":r="./img/sources/newtunein.png";break;case"plex":r="./img/sources/plex.png";break;case"prime":r="./img/sources/amazon-music2.png";break;case"qobuz":r="./img/sources/qobuz2.png";break;case"tidal":r="./img/sources/tidal2.png";break;case"upnpserver":r="./img/sources/dlna2.png";break;case"vtuner":r="./img/sources/vtuner2.png"}return r},WNP.getQualityIdent=function(e,t,r,i,a){var s="";switch(r>=700&&24==i&&44100==a&&(s="Lossless"),r>1e3&&16==i&&44100==a?s="CD":r>7e3&&i>=24&&a>=96e3&&(s="Hi-Res"),e+":"+t){case"2:LOSSLESS":case":LOSSLESS":s="HIGH";break;case"3:HI_RES":s="MQA";break;case"4:HI_RES_LOSSLESS":case":HI_RES_LOSSLESS":case"0:LOSSLESS":s="FLAC";break;case":UHD":s="ULTRA HD";break;case":HD":s="HD";break;case"3:7":case"4:27":s="Hi-Res";break;case"2:6":s="CD"}return s},WNP.Init();
//# sourceMappingURL=debug.1a9145bb.js.map
