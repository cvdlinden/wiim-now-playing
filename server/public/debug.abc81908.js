window.WNP=window.WNP||{},WNP.s={locHostname:location.hostname,locPort:location.port&&"80"!=location.port&&"1234"!=location.port?location.port:"80",aDeviceUI:["btnRefresh","selDeviceChoices","btnDevices"],aServerUI:["btnReboot","btnUpdate","btnShutdown","btnReloadUI"],aTicksUI:["tickDevicesGetUp","tickDevicesRefreshUp","tickServerSettingsUp","tickStateUp","tickStateDown","tickMetadataUp","tickMetadataDown","tickDeviceSetUp","tickDeviceSetDown","tickServerSettingsDown","tickDevicesGetDown","tickDevicesRefreshDown"],aDebugUI:["state","metadata","sServerSettings","sFriendlyname","sManufacturer","sModelName","sLocation","sServerUrlHostname","sServerUrlIP","sServerVersion","sClientVersion","sTimeStampDiff","sTitle","sArtist","sAlbum","sAlbumArtUri","sSubtitle"]},WNP.d={serverSettings:null,deviceList:null},WNP.r={},WNP.Init=function(){console.log("WNP DEBUG","Initialising..."),console.log("WNP DEBUG","Listening on "+this.s.locHostname+":"+this.s.locPort),window.socket=io.connect(":"+this.s.locPort),this.setUIReferences(),this.setTickHandlers(),this.setSocketDefinitions(),this.setUIListeners(),setTimeout(()=>{this.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),this.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get")},500)},WNP.setUIReferences=function(){function e(e){let t=document.getElementById(e);t?WNP.r[e]=t:console.warn("WNP DEBUG",`Element with ID '${e}' not found.`)}console.log("WNP DEBUG","Set UI references..."),this.s.aDeviceUI.forEach(t=>{e(t)}),this.s.aServerUI.forEach(t=>{e(t)}),this.s.aTicksUI.forEach(t=>{e(t)}),this.s.aDebugUI.forEach(t=>{e(t)})},WNP.setTickHandlers=function(){function e(e){e.target.classList.remove("tickAnimate")}this.s.aTicksUI.forEach(t=>{this.r[t]?this.r[t].addEventListener("animationend",e):console.warn("WNP DEBUG",`Element with ID '${t}' not found.`)})},WNP.setUIListeners=function(){console.log("WNP DEBUG","Set UI Listeners..."),this.r.btnRefresh.addEventListener("click",function(){WNP.r.tickDevicesRefreshUp.classList.add("tickAnimate"),socket.emit("devices-refresh"),setTimeout(()=>{WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get"),WNP.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings")},5e3)}),this.r.selDeviceChoices.addEventListener("change",function(){WNP.r.tickDeviceSetUp.classList.add("tickAnimate"),socket.emit("device-set",this.value)}),this.r.btnReboot.addEventListener("click",function(){socket.emit("server-reboot")}),this.r.btnUpdate.addEventListener("click",function(){socket.emit("server-update")}),this.r.btnShutdown.addEventListener("click",function(){socket.emit("server-shutdown")}),this.r.btnReloadUI.addEventListener("click",function(){location.reload()}),this.r.btnDevices.addEventListener("click",function(){WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get")})},WNP.setSocketDefinitions=function(){console.log("WNP DEBUG","Setting Socket definitions..."),socket.on("server-settings",function(e){if(console.log("IO: server-settings",e),WNP.r.tickServerSettingsDown.classList.add("tickAnimate"),WNP.d.serverSettings=e,WNP.r.sServerSettings.innerHTML=JSON.stringify(e),e&&e.os&&e.os.userInfo&&"/bin/bash"===e.os.userInfo.shell&&(WNP.r.btnReboot.disabled=!1,WNP.r.btnUpdate.disabled=!1,WNP.r.btnShutdown.disabled=!1),WNP.r.sFriendlyname.children[0].innerText=e&&e.selectedDevice&&e.selectedDevice.friendlyName?e.selectedDevice.friendlyName:"-",WNP.r.sManufacturer.children[0].innerText=e&&e.selectedDevice&&e.selectedDevice.manufacturer?e.selectedDevice.manufacturer:"-",WNP.r.sModelName.children[0].innerText=e&&e.selectedDevice&&e.selectedDevice.modelName?e.selectedDevice.modelName:"-",WNP.r.sLocation.children[0].innerHTML=e&&e.selectedDevice&&e.selectedDevice.location?'<a href="'+e.selectedDevice.location+'">'+e.selectedDevice.location+"</a>":"-",e&&e.os&&e.os.hostname){var t="http://"+e.os.hostname.toLowerCase()+".local";t+=location&&location.port&&80!=location.port?":"+location.port+"/":"/",WNP.r.sServerUrlHostname.children[0].innerHTML='<a href="'+t+'">'+t+"</a>"}else WNP.r.sServerUrlHostname.children[0].innerText="-";if(e&&e.selectedDevice&&e.selectedDevice.location&&e.os&&e.os.networkInterfaces){var i=e.selectedDevice.location.split("/")[2].split(".");i.pop();var s=i.join(".");Object.keys(e.os.networkInterfaces).forEach(function(t,i){var n=e.os.networkInterfaces[t].find(e=>e.address.startsWith(s));if(n){var r="http://"+n.address;r+=location&&location.port&&80!=location.port?":"+location.port+"/":"/",WNP.r.sServerUrlIP.children[0].innerHTML='<a href="'+r+'">'+r+"</a>"}})}else WNP.r.sServerUrlIP.children[0].innerText="-";WNP.r.sServerVersion.children[0].innerText=e&&e.version&&e.version.server?e.version.server:"-",WNP.r.sClientVersion.children[0].innerText=e&&e.version&&e.version.client?e.version.client:"-"}),socket.on("devices-get",function(e){console.log("IO: devices-get",e),WNP.r.tickDevicesGetDown.classList.add("tickAnimate"),WNP.d.deviceList=e,WNP.d.deviceList.sort((e,t)=>e.friendlyName<t.friendlyName?-1:1),WNP.r.selDeviceChoices.innerHTML='<option value="">Select a device...</em></li>';var t=WNP.d.deviceList.filter(e=>e.manufacturer.startsWith("Linkplay"));if(t.length>0){var i=document.createElement("optgroup");i.label="WiiM devices",t.forEach(e=>{var t=document.createElement("option");t.value=e.location,t.innerText=e.friendlyName,t.title="By "+e.manufacturer,WNP.d.serverSettings&&WNP.d.serverSettings.selectedDevice&&WNP.d.serverSettings.selectedDevice.location===e.location&&t.setAttribute("selected","selected"),i.appendChild(t)}),WNP.r.selDeviceChoices.appendChild(i)}var s=WNP.d.deviceList.filter(e=>!e.manufacturer.startsWith("Linkplay"));if(s.length>0){var i=document.createElement("optgroup");i.label="Other devices",s.forEach(e=>{var t=document.createElement("option");t.value=e.location,t.innerText=e.friendlyName,t.title="By "+e.manufacturer,WNP.d.serverSettings&&WNP.d.serverSettings.selectedDevice&&WNP.d.serverSettings.selectedDevice.location===e.location&&t.setAttribute("selected","selected"),i.appendChild(t)}),WNP.r.selDeviceChoices.appendChild(i)}0==t.length&&0==s.length&&(WNP.r.selDeviceChoices.innerHTML='<option disabled="disabled">No devices found!</em></li>')}),socket.on("state",function(e){if(!e)return!1;if(WNP.r.tickStateDown.classList.add("tickAnimate"),WNP.r.state.innerHTML=JSON.stringify(e),e&&e.stateTimeStamp&&e.metadataTimeStamp){var t=e.stateTimeStamp&&e.metadataTimeStamp?Math.round((e.stateTimeStamp-e.metadataTimeStamp)/1e3):0;WNP.r.sTimeStampDiff.innerHTML=t+"s"}else WNP.r.sTimeStampDiff.innerHTML=""}),socket.on("metadata",function(e){WNP.r.tickMetadataDown.classList.add("tickAnimate"),WNP.r.metadata.innerHTML=JSON.stringify(e),WNP.r.sTitle.children[0].innerText=e&&e.trackMetaData&&e.trackMetaData["dc:title"]?e.trackMetaData["dc:title"]:"-",WNP.r.sArtist.children[0].innerText=e&&e.trackMetaData&&e.trackMetaData["upnp:artist"]?e.trackMetaData["upnp:artist"]:"-",WNP.r.sAlbum.children[0].innerText=e&&e.trackMetaData&&e.trackMetaData["upnp:album"]?e.trackMetaData["upnp:album"]:"-",WNP.r.sAlbumArtUri.children[0].innerText=e&&e.trackMetaData&&e.trackMetaData["upnp:albumArtURI"]?e.trackMetaData["upnp:albumArtURI"]:"-",WNP.r.sSubtitle.children[0].innerText=e&&e.trackMetaData&&e.trackMetaData["dc:subtitle"]?e.trackMetaData["dc:subtitle"]:"-",e&&e.trackMetaData&&e.trackMetaData["upnp:albumArtURI"]?WNP.checkAlbumArtURI(e.trackMetaData["upnp:albumArtURI"]):(WNP.r.sAlbumArtUri.children[1].classList="bi bi-info-circle",WNP.r.sAlbumArtUri.children[1].title="No album art URI found")}),socket.on("device-set",function(e){console.log("IO: device-set",e),WNP.r.tickDeviceSetDown.classList.add("tickAnimate"),WNP.r.tickServerSettingsUp.classList.add("tickAnimate"),socket.emit("server-settings"),WNP.r.tickDevicesGetUp.classList.add("tickAnimate"),socket.emit("devices-get")}),socket.on("devices-refresh",function(e){console.log("IO: devices-refresh",e),WNP.r.tickDevicesRefreshDown.classList.add("tickAnimate"),WNP.r.selDeviceChoices.innerHTML='<option disabled="disabled">Waiting for devices...</em></li>'}),socket.on("devices-update-manual",function(e){console.log("IO: devices-update-manual",e),WNP.r.tickSaveDevicesDown.classList.add("tickAnimate"),socket.emit("devices-get"),bootstrap.Modal.getInstance(addDeviceModal).hide()})},WNP.checkAlbumArtURI=function(e){var t=new Image;t.onload=function(){console.log("WNP DEBUG","Album art loaded successfully.","Size: "+this.width+"x"+this.height+"px"),WNP.r.sAlbumArtUri.children[1].classList="bi bi-check-circle-fill",WNP.r.sAlbumArtUri.children[1].title="Able to load album art"},t.onerror=function(){console.error("WNP DEBUG","Failed to load album art:",e),WNP.r.sAlbumArtUri.children[1].classList="bi bi-x-circle-fill",WNP.r.sAlbumArtUri.children[1].title="Unable to load album art"},e&&e.startsWith("https")?t.src="http://"+WNP.s.locHostname+":"+WNP.s.locPort+"/proxy?url="+encodeURIComponent(e):e&&e.startsWith("http")?t.src=e:(console.warn("WNP DEBUG","Invalid URL for album art:",e),WNP.r.sAlbumArtUri.children[1].classList="bi bi-exclamation-circle-fill",WNP.r.sAlbumArtUri.children[1].title="Invalid album art URI")},WNP.Init();
//# sourceMappingURL=debug.abc81908.js.map
