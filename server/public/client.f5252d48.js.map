{"mappings":"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","sources":["<anon>","src/js/wnp.js"],"sourcesContent":["var $2adbdd4d4d2317fc$exports = {};\n// =======================================================\n// WiiM Now Playing\n// Namespacing\nwindow.WNP = window.WNP || {};\n// Default settings\nWNP.s = {\n    // Host runs on default port 80, but in cases where another port is chosen adapt\n    locHostname: location.hostname,\n    locPort: location.port && location.port != \"80\" && location.port != \"1234\" ? location.port : \"80\",\n    rndAlbumArtUri: \"./img/fake-album-1.jpg\",\n    // Device selection\n    aDeviceUI: [\n        \"btnPrev\",\n        \"btnPlay\",\n        \"btnNext\",\n        \"btnRefresh\",\n        \"selDeviceChoices\",\n        \"devName\",\n        \"mediaTitle\",\n        \"mediaSubTitle\",\n        \"mediaArtist\",\n        \"mediaAlbum\",\n        \"mediaBitRate\",\n        \"mediaBitDepth\",\n        \"mediaSampleRate\",\n        \"mediaQualityIdent\",\n        \"devVol\",\n        \"btnRepeat\",\n        \"btnShuffle\",\n        \"progressPlayed\",\n        \"progressLeft\",\n        \"progressPercent\",\n        \"mediaSource\",\n        \"albumArt\",\n        \"bgAlbumArtBlur\",\n        \"btnDevSelect\",\n        \"btnDevVolume\"\n    ],\n    // Server actions to be used in the app\n    aServerUI: [\n        \"btnReboot\",\n        \"btnUpdate\",\n        \"btnShutdown\",\n        \"btnReloadUI\",\n        \"sServerUrlHostname\",\n        \"sServerUrlIP\",\n        \"sServerVersion\",\n        \"sClientVersion\"\n    ]\n};\n// Data placeholders.\nWNP.d = {\n    serverSettings: null,\n    deviceList: null,\n    prevTransportState: null,\n    prevPlayMedium: null,\n    prevSourceIdent: null,\n    prevTrackInfo: null\n};\n// Reference placeholders.\n// These are set in the init function\n// and are used to reference the UI elements in the app.\nWNP.r = {};\n/**\r\n * Initialisation of app.\r\n * @returns {undefined}\r\n */ WNP.Init = function() {\n    console.log(\"WNP\", \"Initialising...\");\n    // Init Socket.IO, connect to port where server resides\n    console.log(\"WNP DEBUG\", \"Listening on \" + this.s.locHostname + \":\" + this.s.locPort);\n    window.socket = io.connect(\":\" + this.s.locPort);\n    // Set references to the UI elements\n    this.setUIReferences();\n    // Set Socket.IO definitions\n    this.setSocketDefinitions();\n    // Set UI event listeners\n    this.setUIListeners();\n    // Initial calls, wait a bit for socket to start\n    setTimeout(()=>{\n        socket.emit(\"server-settings\");\n        socket.emit(\"devices-get\");\n    }, 500);\n    // Create random album intervals, every 3 minutes\n    WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\n    var rndAlbumInterval = setInterval(function() {\n        WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\n    }, 180000);\n};\n/**\r\n * Reference to the UI elements of the app.\r\n * @returns {undefined}\r\n */ WNP.setUIReferences = function() {\n    console.log(\"WNP\", \"Set UI references...\");\n    function addElementToRef(id) {\n        const element = document.getElementById(id);\n        if (element) WNP.r[id] = element;\n        else console.warn(\"WNP\", `Element with ID '${id}' not found in HTML.`);\n    }\n    // Set references to the UI elements\n    this.s.aDeviceUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n    this.s.aServerUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n};\n/**\r\n * Setting the listeners on the UI elements of the app.\r\n * @returns {undefined}\r\n */ WNP.setUIListeners = function() {\n    console.log(\"WNP\", \"Set UI Listeners...\");\n    // ------------------------------------------------\n    // Player buttons\n    this.r.btnPrev.addEventListener(\"click\", function() {\n        var wnpAction = this.getAttribute(\"wnp-action\");\n        if (wnpAction) {\n            this.disabled = true;\n            socket.emit(\"device-action\", wnpAction);\n        }\n    });\n    this.r.btnPlay.addEventListener(\"click\", function() {\n        var wnpAction = this.getAttribute(\"wnp-action\");\n        if (wnpAction) {\n            this.disabled = true;\n            socket.emit(\"device-action\", wnpAction);\n        }\n    });\n    this.r.btnNext.addEventListener(\"click\", function() {\n        var wnpAction = this.getAttribute(\"wnp-action\");\n        if (wnpAction) {\n            this.disabled = true;\n            socket.emit(\"device-action\", wnpAction);\n        }\n    });\n    // ------------------------------------------------\n    // Device control buttons (only for default GUI)\n    if (this.r.btnDevSelect) this.r.btnDevSelect.addEventListener(\"click\", function() {\n        console.log(\"WNP\", \"Open device selection control\");\n    // TODO:\n    // Opens a selector for devices in a dialog/modal connected to the button.\n    // Should also be possible to click the device name itself.\n    // Should do the same as per selDeviceChoices change event.\n    });\n    if (this.r.btnDevVolume) this.r.btnDevVolume.addEventListener(\"click\", function() {\n        console.log(\"WNP\", \"Open device volume control\");\n    // TODO:\n    // Opens a volume control in a dialog/modal connected to the button.\n    // The 'Range' input type should be used for this, but rotated vertically.\n    // Changing volume should be done on input change, not on mouse up.\n    // Selecting volume should be done in steps of 5 (0, 5, 10, ..., 100).\n    // Should also make muting possible.\n    });\n    // ------------------------------------------------\n    // Settings buttons\n    this.r.btnRefresh.addEventListener(\"click\", function() {\n        socket.emit(\"devices-refresh\");\n        // Wait for discovery to finish\n        setTimeout(()=>{\n            socket.emit(\"devices-get\");\n            socket.emit(\"server-settings\");\n        }, 5000);\n    });\n    this.r.selDeviceChoices.addEventListener(\"change\", function() {\n        socket.emit(\"device-set\", this.value);\n    });\n    this.r.btnReboot.addEventListener(\"click\", function() {\n        socket.emit(\"server-reboot\");\n    });\n    this.r.btnUpdate.addEventListener(\"click\", function() {\n        socket.emit(\"server-update\");\n    });\n    this.r.btnShutdown.addEventListener(\"click\", function() {\n        socket.emit(\"server-shutdown\");\n    });\n    this.r.btnReloadUI.addEventListener(\"click\", function() {\n        location.reload();\n    });\n};\n/**\r\n * Set the socket definitions to listen for specific websocket traffic and handle accordingly.\r\n * @returns {undefined}\r\n */ WNP.setSocketDefinitions = function() {\n    console.log(\"WNP\", \"Setting Socket definitions...\");\n    // On server settings\n    socket.on(\"server-settings\", function(msg) {\n        // Store server settings\n        WNP.d.serverSettings = msg;\n        // RPi has bash, so possibly able to reboot/shutdown.\n        if (msg && msg.os && msg.os.userInfo && msg.os.userInfo.shell === \"/bin/bash\") {\n            WNP.r.btnReboot.disabled = false;\n            WNP.r.btnUpdate.disabled = false;\n            WNP.r.btnShutdown.disabled = false;\n        }\n        // Set device name\n        if (msg.selectedDevice && msg.selectedDevice.friendlyName) WNP.r.devName.innerText = msg.selectedDevice.friendlyName;\n        // Set the server url(s) under the settings modal\n        if (msg && msg.os && msg.os.hostname) {\n            var sUrl = \"http://\" + msg.os.hostname.toLowerCase() + \".local\";\n            sUrl += location && location.port && location.port != 80 ? \":\" + location.port + \"/\" : \"/\";\n            WNP.r.sServerUrlHostname.children[0].innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\n        } else WNP.r.sServerUrlHostname.children[0].innerText = \"-\";\n        if (msg && msg.selectedDevice && msg.selectedDevice.location && msg.os && msg.os.networkInterfaces) {\n            // Grab the ip address pattern of the selected device\n            // Assumption is that the wiim-now-playing server is on the same ip range as the client..\n            var sLocationIp = msg.selectedDevice.location.split(\"/\")[2]; // Extract ip address from location\n            var aIpAddress = sLocationIp.split(\".\"); // Split ip address in parts\n            aIpAddress.pop(); // Remove the last part\n            var sIpPattern = aIpAddress.join(\".\"); // Construct ip address pattern\n            // Search for server ip address(es) in this range...\n            Object.keys(msg.os.networkInterfaces).forEach(function(key, index) {\n                var sIpFound = msg.os.networkInterfaces[key].find((addr)=>addr.address.startsWith(sIpPattern));\n                if (sIpFound) {\n                    // Construct ip address and optional port\n                    var sUrl = \"http://\" + sIpFound.address;\n                    sUrl += location && location.port && location.port != 80 ? \":\" + location.port + \"/\" : \"/\";\n                    WNP.r.sServerUrlIP.children[0].innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\n                }\n            });\n        } else WNP.r.sServerUrlIP.children[0].innerText = \"-\";\n        // Set the server version\n        WNP.r.sServerVersion.innerText = msg && msg.version && msg.version.server ? msg.version.server : \"-\";\n        // Set the client version\n        WNP.r.sClientVersion.innerText = msg && msg.version && msg.version.client ? msg.version.client : \"-\";\n    });\n    // On devices get\n    socket.on(\"devices-get\", function(msg) {\n        // Store and sort device list\n        WNP.d.deviceList = msg;\n        WNP.d.deviceList.sort((a, b)=>{\n            return a.friendlyName < b.friendlyName ? -1 : 1;\n        });\n        // Clear choices\n        WNP.r.selDeviceChoices.innerHTML = \"<option value=\\\"\\\">Select a device...</em></li>\";\n        // Add WiiM devices\n        var devicesWiiM = WNP.d.deviceList.filter((d)=>{\n            return d.manufacturer.startsWith(\"Linkplay\");\n        });\n        if (devicesWiiM.length > 0) {\n            var optGroup = document.createElement(\"optgroup\");\n            optGroup.label = \"WiiM devices\";\n            devicesWiiM.forEach((device)=>{\n                var opt = document.createElement(\"option\");\n                opt.value = device.location;\n                opt.innerText = device.friendlyName;\n                opt.title = \"By \" + device.manufacturer;\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) opt.setAttribute(\"selected\", \"selected\");\n                optGroup.appendChild(opt);\n            });\n            WNP.r.selDeviceChoices.appendChild(optGroup);\n        }\n        // Other devices\n        var devicesOther = WNP.d.deviceList.filter((d)=>{\n            return !d.manufacturer.startsWith(\"Linkplay\");\n        });\n        if (devicesOther.length > 0) {\n            var optGroup = document.createElement(\"optgroup\");\n            optGroup.label = \"Other devices\";\n            devicesOther.forEach((device)=>{\n                var opt = document.createElement(\"option\");\n                opt.value = device.location;\n                opt.innerText = device.friendlyName;\n                opt.title = \"By \" + device.manufacturer;\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) opt.setAttribute(\"selected\", \"selected\");\n                optGroup.appendChild(opt);\n            });\n            WNP.r.selDeviceChoices.appendChild(optGroup);\n        }\n        if (devicesWiiM.length == 0 && devicesOther.length == 0) WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">No devices found!</em></li>\";\n    });\n    // On state\n    socket.on(\"state\", function(msg) {\n        if (!msg) return false;\n        // console.log(msg);\n        // Get player progress data from the state message.\n        var timeStampDiff = 0;\n        if (msg.CurrentTransportState === \"PLAYING\") timeStampDiff = msg.stateTimeStamp && msg.metadataTimeStamp ? Math.round((msg.stateTimeStamp - msg.metadataTimeStamp) / 1000) : 0;\n        var relTime = msg.RelTime ? msg.RelTime : \"00:00:00\";\n        var trackDuration = msg.TrackDuration ? msg.TrackDuration : \"00:00:00\";\n        // Get current player progress and set UI elements accordingly.\n        var playerProgress = WNP.getPlayerProgress(relTime, trackDuration, timeStampDiff, msg.CurrentTransportState);\n        progressPlayed.children[0].innerText = playerProgress.played;\n        progressLeft.children[0].innerText = playerProgress.left != \"\" ? \"-\" + playerProgress.left : \"\";\n        progressPercent.setAttribute(\"aria-valuenow\", playerProgress.percent);\n        progressPercent.children[0].setAttribute(\"style\", \"width:\" + playerProgress.percent + \"%\");\n        // Device transport state or play medium changed...?\n        if (WNP.d.prevTransportState !== msg.CurrentTransportState || WNP.d.prevPlayMedium !== msg.PlayMedium) {\n            if (msg.CurrentTransportState === \"TRANSITIONING\") {\n                WNP.r.btnPlay.children[0].className = \"bi bi-circle-fill\";\n                WNP.r.btnPlay.disabled = true;\n            }\n            if (msg.CurrentTransportState === \"PLAYING\") {\n                // Radio live streams are preferrentialy stopped as pausing keeps cache for minutes/hours(?).\n                // Stop > Play resets the stream to 'now'. Pause works like 'live tv time shift'.\n                if (msg.PlayMedium && msg.PlayMedium === \"RADIO-NETWORK\") {\n                    WNP.r.btnPlay.children[0].className = \"bi bi-stop-circle-fill\";\n                    WNP.r.btnPlay.setAttribute(\"wnp-action\", \"Stop\");\n                } else {\n                    WNP.r.btnPlay.children[0].className = \"bi bi-pause-circle-fill\";\n                    WNP.r.btnPlay.setAttribute(\"wnp-action\", \"Pause\");\n                }\n                WNP.r.btnPlay.disabled = false;\n            } else if (msg.CurrentTransportState === \"PAUSED_PLAYBACK\" || msg.CurrentTransportState === \"STOPPED\") {\n                WNP.r.btnPlay.children[0].className = \"bi bi-play-circle-fill\";\n                WNP.r.btnPlay.setAttribute(\"wnp-action\", \"Play\");\n                WNP.r.btnPlay.disabled = false;\n            }\n            WNP.d.prevTransportState = msg.CurrentTransportState; // Remember the last transport state\n            WNP.d.prevPlayMedium = msg.PlayMedium; // Remember the last PlayMedium\n        }\n        // If internet radio, there is no skipping... just start and stop!\n        if (msg.PlayMedium && msg.PlayMedium === \"RADIO-NETWORK\") {\n            WNP.r.btnPrev.disabled = true;\n            WNP.r.btnNext.disabled = true;\n        } else {\n            WNP.r.btnPrev.disabled = false;\n            WNP.r.btnNext.disabled = false;\n        }\n    });\n    // On metadata\n    socket.on(\"metadata\", function(msg) {\n        if (!msg) return false;\n        // Source detection\n        var playMedium = msg.PlayMedium ? msg.PlayMedium : \"\";\n        var trackSource = msg.TrackSource ? msg.TrackSource : \"\";\n        var sourceIdent = WNP.getSourceIdent(playMedium, trackSource);\n        // Did the source ident change...?\n        if (sourceIdent !== WNP.d.prevSourceIdent) {\n            if (sourceIdent !== \"\") {\n                var identImg = document.createElement(\"img\");\n                identImg.src = sourceIdent;\n                identImg.alt = playMedium + \": \" + trackSource;\n                identImg.title = playMedium + \": \" + trackSource;\n                mediaSource.innerHTML = identImg.outerHTML;\n            } else mediaSource.innerText = playMedium + \": \" + trackSource;\n            WNP.d.prevSourceIdent = sourceIdent; // Remember the last Source Ident\n        }\n        // Song Title, Subtitle, Artist, Album\n        WNP.r.mediaTitle.innerText = msg.trackMetaData && msg.trackMetaData[\"dc:title\"] ? msg.trackMetaData[\"dc:title\"] : \"\";\n        WNP.r.mediaSubTitle.innerText = msg.trackMetaData && msg.trackMetaData[\"dc:subtitle\"] ? msg.trackMetaData[\"dc:subtitle\"] : \"\";\n        WNP.r.mediaArtist.innerText = msg.trackMetaData && msg.trackMetaData[\"upnp:artist\"] ? msg.trackMetaData[\"upnp:artist\"] : \"\";\n        WNP.r.mediaAlbum.innerText = msg.trackMetaData && msg.trackMetaData[\"upnp:album\"] ? msg.trackMetaData[\"upnp:album\"] : \"\";\n        if (playMedium === \"SONGLIST-NETWORK\" && !trackSource && msg.CurrentTransportState === \"STOPPED\") WNP.r.mediaTitle.innerText = \"No Music Selected\";\n        var trackChanged = false;\n        var currentTrackInfo = WNP.r.mediaTitle.innerText + \"|\" + WNP.r.mediaSubTitle.innerText + \"|\" + WNP.r.mediaArtist.innerText + \"|\" + WNP.r.mediaAlbum.innerText;\n        if (WNP.d.prevTrackInfo !== currentTrackInfo) {\n            trackChanged = true;\n            WNP.d.prevTrackInfo = currentTrackInfo; // Remember the last track info\n            console.log(\"WNP\", \"Track changed:\", currentTrackInfo);\n        }\n        // Audio quality\n        var songBitrate = msg.trackMetaData && msg.trackMetaData[\"song:bitrate\"] ? msg.trackMetaData[\"song:bitrate\"] : \"\";\n        var songBitDepth = msg.trackMetaData && msg.trackMetaData[\"song:format_s\"] ? msg.trackMetaData[\"song:format_s\"] : \"\";\n        var songSampleRate = msg.trackMetaData && msg.trackMetaData[\"song:rate_hz\"] ? msg.trackMetaData[\"song:rate_hz\"] : \"\";\n        WNP.r.mediaBitRate.innerText = songBitrate > 0 ? songBitrate > 1000 ? (songBitrate / 1000).toFixed(2) + \" mbps, \" : songBitrate + \" kbps, \" : \"\";\n        WNP.r.mediaBitDepth.innerText = songBitDepth > 0 ? songBitDepth > 24 ? \"24 bit/\" : songBitDepth + \" bit/\" : \"\"; // TODO: 32 bits is suspect according to the WiiM app?\n        WNP.r.mediaSampleRate.innerText = songSampleRate > 0 ? (songSampleRate / 1000).toFixed(1) + \" kHz\" : \"\";\n        if (!songBitrate && !songBitDepth && !songSampleRate) WNP.r.mediaQualityIdent.style.display = \"none\";\n        else WNP.r.mediaQualityIdent.style.display = \"inline-block\";\n        // Audio quality ident badge (HD/Hi-res/CD/...)\n        var songQuality = msg.trackMetaData && msg.trackMetaData[\"song:quality\"] ? msg.trackMetaData[\"song:quality\"] : \"\";\n        var songActualQuality = msg.trackMetaData && msg.trackMetaData[\"song:actualQuality\"] ? msg.trackMetaData[\"song:actualQuality\"] : \"\";\n        var qualiIdent = WNP.getQualityIdent(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n        if (qualiIdent !== \"\") {\n            WNP.r.mediaQualityIdent.innerText = qualiIdent;\n            WNP.r.mediaQualityIdent.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\n        } else {\n            var identId = document.createElement(\"i\");\n            identId.className = \"bi bi-soundwave text-secondary\";\n            identId.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\n            WNP.r.mediaQualityIdent.innerHTML = identId.outerHTML;\n        }\n        // Pre-process Album Art uri, if any is available from the metadata.\n        var albumArtUri = WNP.checkAlbumArtURI(msg.trackMetaData && msg.trackMetaData[\"upnp:albumArtURI\"] ? msg.trackMetaData[\"upnp:albumArtURI\"] : \"\", msg.metadataTimeStamp);\n        // Set Album Art, only if the track changed and the URI changed\n        if (trackChanged && WNP.r.albumArt.src != albumArtUri) WNP.setAlbumArt(albumArtUri);\n        // Device volume\n        WNP.r.devVol.innerText = msg.CurrentVolume ? msg.CurrentVolume : \"-\";\n        // Loop mode status\n        if (msg.LoopMode) switch(msg.LoopMode){\n            case \"5\":\n                WNP.r.btnRepeat.className = \"btn btn-outline-success\";\n                WNP.r.btnRepeat.children[0].className = \"bi bi-repeat-1\";\n                WNP.r.btnShuffle.className = \"btn btn-outline-success\";\n                break;\n            case \"3\":\n                WNP.r.btnRepeat.className = \"btn btn-outline-light\";\n                WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\n                WNP.r.btnShuffle.className = \"btn btn-outline-success\";\n                break;\n            case \"2\":\n                WNP.r.btnRepeat.className = \"btn btn-outline-success\";\n                WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\n                WNP.r.btnShuffle.className = \"btn btn-outline-success\";\n                break;\n            case \"1\":\n                WNP.r.btnRepeat.className = \"btn btn-outline-success\";\n                WNP.r.btnRepeat.children[0].className = \"bi bi-repeat-1\";\n                WNP.r.btnShuffle.className = \"btn btn-outline-light\";\n                break;\n            case \"0\":\n                WNP.r.btnRepeat.className = \"btn btn-outline-success\";\n                WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\n                WNP.r.btnShuffle.className = \"btn btn-outline-light\";\n                break;\n            default:\n                WNP.r.btnRepeat.className = \"btn btn-outline-light\";\n                WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\n                WNP.r.btnShuffle.className = \"btn btn-outline-light\";\n        }\n        else {\n            WNP.r.btnRepeat.className = \"btn btn-outline-light\";\n            WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\n            WNP.r.btnShuffle.className = \"btn btn-outline-light\";\n        }\n    });\n    // On device set\n    socket.on(\"device-set\", function(msg) {\n        // Device switch? Fetch settings and device info again.\n        socket.emit(\"server-settings\");\n        socket.emit(\"devices-get\");\n    });\n    // On device refresh\n    socket.on(\"devices-refresh\", function(msg) {\n        WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">Waiting for devices...</em></li>\";\n    });\n};\n// =======================================================\n// Helper functions\n/**\r\n * Get player progress helper.\r\n * @param {string} relTime - Time elapsed while playing, format 00:00:00\r\n * @param {string} trackDuration - Total play time, format 00:00:00\r\n * @param {integer} timeStampDiff - Possible play time offset in seconds\r\n * @param {string} currentTransportState - The current transport state \"PLAYING\" or otherwise\r\n * @returns {object} An object with corrected played, left, total and percentage played\r\n */ WNP.getPlayerProgress = function(relTime, trackDuration, timeStampDiff, currentTransportState) {\n    var relTimeSec = this.convertToSeconds(relTime) + timeStampDiff;\n    var trackDurationSec = this.convertToSeconds(trackDuration);\n    if (trackDurationSec > 0 && relTimeSec < trackDurationSec) {\n        // var percentPlayed = Math.floor((relTimeSec / trackDurationSec) * 100);\n        var percentPlayed = (relTimeSec / trackDurationSec * 100).toFixed(1);\n        return {\n            played: WNP.convertToMinutes(relTimeSec),\n            left: WNP.convertToMinutes(trackDurationSec - relTimeSec),\n            total: WNP.convertToMinutes(trackDurationSec),\n            percent: percentPlayed\n        };\n    } else if (trackDurationSec == 0 && currentTransportState == \"PLAYING\") return {\n        played: \"Live\",\n        left: \"\",\n        total: \"\",\n        percent: 100\n    };\n    else return {\n        played: \"Paused\",\n        left: \"\",\n        total: \"\",\n        percent: 0\n    };\n};\n/**\r\n * Convert time format '00:00:00' to total number of seconds.\r\n * @param {string} sDuration - Time, format 00:00:00.\r\n * @returns {integer} The number of seconds that the string represents.\r\n */ WNP.convertToSeconds = function(sDuration) {\n    const timeSections = sDuration.split(\":\");\n    let totalSeconds = 0;\n    for(let i = 0; i < timeSections.length; i++){\n        var nFactor = timeSections.length - 1 - i; // Count backwards\n        var nMultiplier = Math.pow(60, nFactor); // 60^n\n        totalSeconds += nMultiplier * parseInt(timeSections[i]); // Calculate the seconds\n    }\n    return totalSeconds;\n};\n/**\r\n * Convert number of seconds to '00:00' string format. \r\n * Sorry for those hour+ long songs...\r\n * @param {integer} seconds - Number of seconds total.\r\n * @returns {string} The string representation of seconds in minutes, format 00:00.\r\n */ WNP.convertToMinutes = function(seconds) {\n    var tempDate = new Date(0);\n    tempDate.setSeconds(seconds);\n    var result = tempDate.toISOString().substring(14, 19);\n    return result;\n};\n/**\r\n * Check if the album art is a valid URI. Returns the URI if valid, otherwise a random URI.\r\n * Error handling is handled by the onerror event on the image itself.\r\n * @param {string} sAlbumArtUri - The URI of the album art.\r\n * @param {integer} nTimestamp - The time in milliseconds, used as cache buster.\r\n * @returns {string} The URI of the album art.\r\n */ WNP.checkAlbumArtURI = function(sAlbumArtUri, nTimestamp) {\n    // If the URI starts with https, the self signed certificate may not trusted by the browser.\n    // Hence we always try and load the image through a reverse proxy, ignoring the certificate.\n    if (sAlbumArtUri && sAlbumArtUri.startsWith(\"https\")) {\n        if (WNP.s.locPort != \"80\") return \"http://\" + WNP.s.locHostname + \":\" + WNP.s.locPort + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n        else return \"http://\" + WNP.s.locHostname + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n    } else if (sAlbumArtUri && sAlbumArtUri.startsWith(\"http\")) return sAlbumArtUri;\n    else // If not, use the random album art URI\n    return WNP.s.rndAlbumArtUri;\n};\n/**\r\n * Sets the album art. Both on the foreground and background.\r\n * @param {integer} imgUri - The URI of the album art.\r\n * @returns {undefined}\r\n */ WNP.setAlbumArt = function(imgUri) {\n    console.log(\"WNP\", \"Set Album Art\", imgUri);\n    this.r.albumArt.src = imgUri;\n    this.r.bgAlbumArtBlur.style.backgroundImage = \"url('\" + imgUri + \"')\";\n};\n/**\r\n * Come up with a random album art URI (locally from the img folder).\r\n * @param {string} prefix - The prefix for the album art URI, i.e. 'fake-album-'\r\n * @returns {string} An URI for album art\r\n */ WNP.rndAlbumArt = function(prefix) {\n    return \"./img/\" + prefix + this.rndNumber(1, 16) + \".jpg\";\n};\n/**\r\n * Get a random number between min and max, including min and max.\r\n * @param {integer} min - Minimum number to pick, keep it lower than max.\r\n * @param {integer} max - Maximum number to pick.\r\n * @returns {integer} The random number\r\n */ WNP.rndNumber = function(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n/**\r\n * Get an identifier for the current play medium combined with the tracksource.\r\n * TODO: Verify all/most sources...\r\n * @param {string} playMedium - The PlayMedium as indicated by the device. Values: SONGLIST-NETWORK, RADIO-NETWORK, STATION-NETWORK, CAST, AIRPLAY, SPOTIFY, UNKOWN\r\n * @param {string} trackSource - The stream source as indicated by the device. Values: Prime, Qobuz, SPOTIFY, newTuneIn, iHeartRadio, Deezer, UPnPServer, Tidal, vTuner\r\n * @returns {string} The uri to the source identifier (image url)\r\n */ WNP.getSourceIdent = function(playMedium, trackSource) {\n    var sIdentUri = \"\";\n    switch(playMedium.toLowerCase()){\n        case \"airplay\":\n            sIdentUri = \"./img/sources/airplay2.png\";\n            break;\n        case \"third-dlna\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"cast\":\n            sIdentUri = \"./img/sources/chromecast2.png\";\n            break;\n        case \"radio-network\":\n            sIdentUri = \"./img/sources/radio.png\";\n            break;\n        case \"songlist-network\":\n            sIdentUri = \"./img/sources/ethernet2.png\";\n            break;\n        case \"spotify\":\n            sIdentUri = \"./img/sources/spotify.png\";\n            break;\n        case \"squeezelite\":\n            sIdentUri = \"./img/sources/music-assistant2.png\";\n            break;\n        case \"none\":\n            sIdentUri = \"./img/sources/none2.png\";\n            break;\n        case \"bluetooth\":\n            sIdentUri = \"./img/sources/bluetooth2.png\";\n            break;\n        case \"hdmi\":\n            sIdentUri = \"./img/sources/hdmi2.png\";\n            break;\n        case \"line-in\":\n            sIdentUri = \"./img/sources/line-in2.png\";\n            break;\n        case \"optical\":\n            sIdentUri = \"./img/sources/spdif2.png\";\n            break;\n    }\n    switch(trackSource.toLowerCase()){\n        case \"deezer\":\n        case \"deezer2\":\n            sIdentUri = \"./img/sources/deezer.png\";\n            break;\n        case \"iheartradio\":\n            sIdentUri = \"./img/sources/iheart.png\";\n            break;\n        case \"newtunein\":\n            sIdentUri = \"./img/sources/newtunein.png\";\n            break;\n        case \"plex\":\n            sIdentUri = \"./img/sources/plex.png\";\n            break;\n        case \"prime\":\n            sIdentUri = \"./img/sources/amazon-music2.png\";\n            break;\n        case \"qobuz\":\n            sIdentUri = \"./img/sources/qobuz2.png\";\n            break;\n        case \"tidal\":\n            sIdentUri = \"./img/sources/tidal2.png\";\n            break;\n        case \"upnpserver\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"vtuner\":\n            sIdentUri = \"./img/sources/vtuner2.png\";\n            break;\n    }\n    return sIdentUri;\n};\n/**\r\n * Get an identifier for the current audio/song quality.\r\n * TODO: Verify all/most sources...\r\n * Found so far:\r\n * \r\n * CD Quality: 44.1 KHz/16 bit. Bitrate 1,411 kbps. For mp3 bitrate can vary, but also be 320/192/160/128/... kbps.\r\n * Hi-Res quality: 96 kHz/24 bit and up. Bitrate 9,216 kbps.\r\n * \r\n * Spotify and Pandora usual bitrate 160 kbps, premium is 320 kbps\r\n * Tidal has CD quality, and FLAC, MQA, Master, ...\r\n * Qobuz apparently really has hi-res?\r\n * Amazon Music (Unlimited) does Atmos?\r\n * Apple Music -> Airplay 2, does hi-res?\r\n * YouTube Music -> Cast, does what?\r\n * \r\n * TIDAL -\r\n * Sample High: \"song:quality\":\"2\",\"song:actualQuality\":\"LOSSLESS\"\r\n * Sample MQA: \"song:quality\":\"3\",\"song:actualQuality\":\"HI_RES\"\r\n * Sample FLAC: \"song:quality\":\"4\",\"song:actualQuality\":\"HI_RES_LOSSLESS\"\r\n * \r\n * @param {integer} songQuality - A number identifying the quality, as indicated by the streaming service(?).\r\n * @param {string} songActualQuality - An indicator for the actual quality, as indicated by the streaming service(?).\r\n * @param {integer} songBitrate - The current bitrate in kilobit per second.\r\n * @param {integer} songBitDepth - The current sample depth in bits.\r\n * @param {integer} songSampleRate - The current sample rate in Hz.\r\n * @returns {string} The identifier for the audio quality, just a string.\r\n */ WNP.getQualityIdent = function(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate) {\n    // console.log(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n    var sIdent = \"\";\n    if (songBitrate > 1000 && songBitDepth === 16 && songSampleRate === 44100) sIdent = \"CD\";\n    else if (songBitrate > 7000 && songBitDepth >= 24 && songSampleRate >= 96000) sIdent = \"Hi-Res\";\n    // Based of Tidal/Amazon Music Unlimited/Deezer/Qobuz\n    switch(songQuality + \":\" + songActualQuality){\n        case \"2:LOSSLESS\":\n        case \":LOSSLESS\":\n            sIdent = \"HIGH\";\n            break;\n        case \"3:HI_RES\":\n            sIdent = \"MQA\";\n            break;\n        case \"4:HI_RES_LOSSLESS\":\n        case \":HI_RES_LOSSLESS\":\n        case \"0:LOSSLESS\":\n            sIdent = \"FLAC\";\n            break;\n        case \":UHD\":\n            sIdent = \"ULTRA HD\";\n            break;\n        case \":HD\":\n            sIdent = \"HD\"; // Amazon Music\n            break;\n        case \"3:7\":\n        case \"4:27\":\n            sIdent = \"Hi-Res\"; // Qobuz\n            break;\n        case \"2:6\":\n            sIdent = \"CD\"; // Qobuz\n            break;\n    }\n    return sIdent;\n};\n// =======================================================\n// Start WiiM Now Playing app\nWNP.Init();\n\n\n//# sourceMappingURL=client.f5252d48.js.map\n","// =======================================================\r\n// WiiM Now Playing\r\n\r\n// Namespacing\r\nwindow.WNP = window.WNP || {};\r\n\r\n// Default settings\r\nWNP.s = {\r\n    // Host runs on default port 80, but in cases where another port is chosen adapt\r\n    locHostname: location.hostname,\r\n    locPort: (location.port && location.port != \"80\" && location.port != \"1234\") ? location.port : \"80\",\r\n    rndAlbumArtUri: \"./img/fake-album-1.jpg\",\r\n    // Device selection\r\n    aDeviceUI: [\"btnPrev\", \"btnPlay\", \"btnNext\", \"btnRefresh\", \"selDeviceChoices\", \"devName\", \"mediaTitle\", \"mediaSubTitle\", \"mediaArtist\", \"mediaAlbum\", \"mediaBitRate\", \"mediaBitDepth\", \"mediaSampleRate\", \"mediaQualityIdent\", \"devVol\", \"btnRepeat\", \"btnShuffle\", \"progressPlayed\", \"progressLeft\", \"progressPercent\", \"mediaSource\", \"albumArt\", \"bgAlbumArtBlur\", \"btnDevSelect\", \"btnDevVolume\"],\r\n    // Server actions to be used in the app\r\n    aServerUI: [\"btnReboot\", \"btnUpdate\", \"btnShutdown\", \"btnReloadUI\", \"sServerUrlHostname\", \"sServerUrlIP\", \"sServerVersion\", \"sClientVersion\"],\r\n};\r\n\r\n// Data placeholders.\r\nWNP.d = {\r\n    serverSettings: null, // Server settings, used to store the server settings\r\n    deviceList: null, // Device list, used to store the devices found through SSDP\r\n    prevTransportState: null, // Previous transport state, used to detect changes in the transport state\r\n    prevPlayMedium: null, // Previous play medium, used to detect changes in the play medium\r\n    prevSourceIdent: null, // Previous source ident, used to detect changes in the source\r\n    prevTrackInfo: null, // Previous track info, used to detect changes in the metadata\r\n};\r\n\r\n// Reference placeholders.\r\n// These are set in the init function\r\n// and are used to reference the UI elements in the app.\r\nWNP.r = {};\r\n\r\n/**\r\n * Initialisation of app.\r\n * @returns {undefined}\r\n */\r\nWNP.Init = function () {\r\n    console.log(\"WNP\", \"Initialising...\");\r\n\r\n    // Init Socket.IO, connect to port where server resides\r\n    console.log(\"WNP DEBUG\", \"Listening on \" + this.s.locHostname + \":\" + this.s.locPort)\r\n    window.socket = io.connect(\":\" + this.s.locPort);\r\n\r\n    // Set references to the UI elements\r\n    this.setUIReferences();\r\n\r\n    // Set Socket.IO definitions\r\n    this.setSocketDefinitions();\r\n\r\n    // Set UI event listeners\r\n    this.setUIListeners();\r\n\r\n    // Initial calls, wait a bit for socket to start\r\n    setTimeout(() => {\r\n        socket.emit(\"server-settings\");\r\n        socket.emit(\"devices-get\");\r\n    }, 500);\r\n\r\n    // Create random album intervals, every 3 minutes\r\n    WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\r\n    var rndAlbumInterval = setInterval(function () {\r\n        WNP.s.rndAlbumArtUri = WNP.rndAlbumArt(\"fake-album-\");\r\n    }, 3 * 60 * 1000);\r\n\r\n};\r\n\r\n/**\r\n * Reference to the UI elements of the app.\r\n * @returns {undefined}\r\n */\r\nWNP.setUIReferences = function () {\r\n    console.log(\"WNP\", \"Set UI references...\")\r\n\r\n    function addElementToRef(id) {\r\n        const element = document.getElementById(id);\r\n        if (element) {\r\n            WNP.r[id] = element;\r\n        } else {\r\n            console.warn(\"WNP\", `Element with ID '${id}' not found in HTML.`);\r\n        }\r\n    }\r\n\r\n    // Set references to the UI elements\r\n    this.s.aDeviceUI.forEach((id) => { addElementToRef(id); });\r\n    this.s.aServerUI.forEach((id) => { addElementToRef(id); });\r\n\r\n};\r\n\r\n/**\r\n * Setting the listeners on the UI elements of the app.\r\n * @returns {undefined}\r\n */\r\nWNP.setUIListeners = function () {\r\n    console.log(\"WNP\", \"Set UI Listeners...\")\r\n\r\n    // ------------------------------------------------\r\n    // Player buttons\r\n\r\n    this.r.btnPrev.addEventListener(\"click\", function () {\r\n        var wnpAction = this.getAttribute(\"wnp-action\");\r\n        if (wnpAction) {\r\n            this.disabled = true;\r\n            socket.emit(\"device-action\", wnpAction);\r\n        }\r\n    });\r\n\r\n    this.r.btnPlay.addEventListener(\"click\", function () {\r\n        var wnpAction = this.getAttribute(\"wnp-action\");\r\n        if (wnpAction) {\r\n            this.disabled = true;\r\n            socket.emit(\"device-action\", wnpAction);\r\n        }\r\n    });\r\n\r\n    this.r.btnNext.addEventListener(\"click\", function () {\r\n        var wnpAction = this.getAttribute(\"wnp-action\");\r\n        if (wnpAction) {\r\n            this.disabled = true;\r\n            socket.emit(\"device-action\", wnpAction);\r\n        }\r\n    });\r\n\r\n    // ------------------------------------------------\r\n    // Device control buttons (only for default GUI)\r\n\r\n    if (this.r.btnDevSelect) {\r\n        this.r.btnDevSelect.addEventListener(\"click\", function () {\r\n            console.log(\"WNP\", \"Open device selection control\");\r\n            // TODO:\r\n            // Opens a selector for devices in a dialog/modal connected to the button.\r\n            // Should also be possible to click the device name itself.\r\n            // Should do the same as per selDeviceChoices change event.\r\n        });\r\n    }\r\n\r\n    if (this.r.btnDevVolume) {\r\n        this.r.btnDevVolume.addEventListener(\"click\", function () {\r\n            console.log(\"WNP\", \"Open device volume control\");\r\n            // TODO:\r\n            // Opens a volume control in a dialog/modal connected to the button.\r\n            // The 'Range' input type should be used for this, but rotated vertically.\r\n            // Changing volume should be done on input change, not on mouse up.\r\n            // Selecting volume should be done in steps of 5 (0, 5, 10, ..., 100).\r\n            // Should also make muting possible.\r\n        });\r\n    }\r\n\r\n    // ------------------------------------------------\r\n    // Settings buttons\r\n\r\n    this.r.btnRefresh.addEventListener(\"click\", function () {\r\n        socket.emit(\"devices-refresh\");\r\n        // Wait for discovery to finish\r\n        setTimeout(() => {\r\n            socket.emit(\"devices-get\");\r\n            socket.emit(\"server-settings\");\r\n        }, 5000);\r\n    });\r\n\r\n    this.r.selDeviceChoices.addEventListener(\"change\", function () {\r\n        socket.emit(\"device-set\", this.value);\r\n    });\r\n\r\n    this.r.btnReboot.addEventListener(\"click\", function () {\r\n        socket.emit(\"server-reboot\");\r\n    });\r\n\r\n    this.r.btnUpdate.addEventListener(\"click\", function () {\r\n        socket.emit(\"server-update\");\r\n    });\r\n\r\n    this.r.btnShutdown.addEventListener(\"click\", function () {\r\n        socket.emit(\"server-shutdown\");\r\n    });\r\n\r\n    this.r.btnReloadUI.addEventListener(\"click\", function () {\r\n        location.reload();\r\n    });\r\n\r\n};\r\n\r\n/**\r\n * Set the socket definitions to listen for specific websocket traffic and handle accordingly.\r\n * @returns {undefined}\r\n */\r\nWNP.setSocketDefinitions = function () {\r\n    console.log(\"WNP\", \"Setting Socket definitions...\")\r\n\r\n    // On server settings\r\n    socket.on(\"server-settings\", function (msg) {\r\n\r\n        // Store server settings\r\n        WNP.d.serverSettings = msg;\r\n\r\n        // RPi has bash, so possibly able to reboot/shutdown.\r\n        if (msg && msg.os && msg.os.userInfo && msg.os.userInfo.shell === \"/bin/bash\") {\r\n            WNP.r.btnReboot.disabled = false;\r\n            WNP.r.btnUpdate.disabled = false;\r\n            WNP.r.btnShutdown.disabled = false;\r\n        };\r\n\r\n        // Set device name\r\n        if (msg.selectedDevice && msg.selectedDevice.friendlyName) {\r\n            WNP.r.devName.innerText = msg.selectedDevice.friendlyName;\r\n        };\r\n\r\n        // Set the server url(s) under the settings modal\r\n        if (msg && msg.os && msg.os.hostname) {\r\n            var sUrl = \"http://\" + msg.os.hostname.toLowerCase() + \".local\";\r\n            sUrl += (location && location.port && location.port != 80) ? \":\" + location.port + \"/\" : \"/\";\r\n            WNP.r.sServerUrlHostname.children[0].innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\r\n        }\r\n        else {\r\n            WNP.r.sServerUrlHostname.children[0].innerText = \"-\";\r\n        }\r\n        if (msg && msg.selectedDevice && msg.selectedDevice.location && msg.os && msg.os.networkInterfaces) {\r\n            // Grab the ip address pattern of the selected device\r\n            // Assumption is that the wiim-now-playing server is on the same ip range as the client..\r\n            var sLocationIp = msg.selectedDevice.location.split(\"/\")[2]; // Extract ip address from location\r\n            var aIpAddress = sLocationIp.split(\".\"); // Split ip address in parts\r\n            aIpAddress.pop(); // Remove the last part\r\n            var sIpPattern = aIpAddress.join(\".\"); // Construct ip address pattern\r\n            // Search for server ip address(es) in this range...\r\n            Object.keys(msg.os.networkInterfaces).forEach(function (key, index) {\r\n                var sIpFound = msg.os.networkInterfaces[key].find(addr => addr.address.startsWith(sIpPattern))\r\n                if (sIpFound) {\r\n                    // Construct ip address and optional port\r\n                    var sUrl = \"http://\" + sIpFound.address;\r\n                    sUrl += (location && location.port && location.port != 80) ? \":\" + location.port + \"/\" : \"/\";\r\n                    WNP.r.sServerUrlIP.children[0].innerHTML = \"<a href=\\\"\" + sUrl + \"\\\">\" + sUrl + \"</a>\";\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            WNP.r.sServerUrlIP.children[0].innerText = \"-\";\r\n        }\r\n\r\n        // Set the server version\r\n        WNP.r.sServerVersion.innerText = (msg && msg.version && msg.version.server) ? msg.version.server : \"-\";\r\n        // Set the client version\r\n        WNP.r.sClientVersion.innerText = (msg && msg.version && msg.version.client) ? msg.version.client : \"-\";\r\n\r\n\r\n    });\r\n\r\n    // On devices get\r\n    socket.on(\"devices-get\", function (msg) {\r\n\r\n        // Store and sort device list\r\n        WNP.d.deviceList = msg;\r\n        WNP.d.deviceList.sort((a, b) => { return (a.friendlyName < b.friendlyName) ? -1 : 1 });\r\n\r\n        // Clear choices\r\n        WNP.r.selDeviceChoices.innerHTML = \"<option value=\\\"\\\">Select a device...</em></li>\";\r\n\r\n        // Add WiiM devices\r\n        var devicesWiiM = WNP.d.deviceList.filter((d) => { return d.manufacturer.startsWith(\"Linkplay\") });\r\n        if (devicesWiiM.length > 0) {\r\n            var optGroup = document.createElement(\"optgroup\");\r\n            optGroup.label = \"WiiM devices\";\r\n            devicesWiiM.forEach((device) => {\r\n                var opt = document.createElement(\"option\");\r\n                opt.value = device.location;\r\n                opt.innerText = device.friendlyName;\r\n                opt.title = \"By \" + device.manufacturer;\r\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) {\r\n                    opt.setAttribute(\"selected\", \"selected\");\r\n                };\r\n                optGroup.appendChild(opt);\r\n            })\r\n            WNP.r.selDeviceChoices.appendChild(optGroup);\r\n        };\r\n\r\n        // Other devices\r\n        var devicesOther = WNP.d.deviceList.filter((d) => { return !d.manufacturer.startsWith(\"Linkplay\") });\r\n        if (devicesOther.length > 0) {\r\n            var optGroup = document.createElement(\"optgroup\");\r\n            optGroup.label = \"Other devices\";\r\n            devicesOther.forEach((device) => {\r\n                var opt = document.createElement(\"option\");\r\n                opt.value = device.location;\r\n                opt.innerText = device.friendlyName;\r\n                opt.title = \"By \" + device.manufacturer;\r\n                if (WNP.d.serverSettings && WNP.d.serverSettings.selectedDevice && WNP.d.serverSettings.selectedDevice.location === device.location) {\r\n                    opt.setAttribute(\"selected\", \"selected\");\r\n                };\r\n                optGroup.appendChild(opt);\r\n            })\r\n            WNP.r.selDeviceChoices.appendChild(optGroup);\r\n\r\n        };\r\n\r\n        if (devicesWiiM.length == 0 && devicesOther.length == 0) {\r\n            WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">No devices found!</em></li>\";\r\n        };\r\n\r\n    });\r\n\r\n    // On state\r\n    socket.on(\"state\", function (msg) {\r\n        if (!msg) { return false; }\r\n        // console.log(msg);\r\n\r\n        // Get player progress data from the state message.\r\n        var timeStampDiff = 0;\r\n        if (msg.CurrentTransportState === \"PLAYING\") {\r\n            timeStampDiff = (msg.stateTimeStamp && msg.metadataTimeStamp) ? Math.round((msg.stateTimeStamp - msg.metadataTimeStamp) / 1000) : 0;\r\n        }\r\n        var relTime = (msg.RelTime) ? msg.RelTime : \"00:00:00\";\r\n        var trackDuration = (msg.TrackDuration) ? msg.TrackDuration : \"00:00:00\";\r\n\r\n        // Get current player progress and set UI elements accordingly.\r\n        var playerProgress = WNP.getPlayerProgress(relTime, trackDuration, timeStampDiff, msg.CurrentTransportState);\r\n        progressPlayed.children[0].innerText = playerProgress.played;\r\n        progressLeft.children[0].innerText = (playerProgress.left != \"\") ? \"-\" + playerProgress.left : \"\";\r\n        progressPercent.setAttribute(\"aria-valuenow\", playerProgress.percent)\r\n        progressPercent.children[0].setAttribute(\"style\", \"width:\" + playerProgress.percent + \"%\");\r\n\r\n        // Device transport state or play medium changed...?\r\n        if (WNP.d.prevTransportState !== msg.CurrentTransportState || WNP.d.prevPlayMedium !== msg.PlayMedium) {\r\n            if (msg.CurrentTransportState === \"TRANSITIONING\") {\r\n                WNP.r.btnPlay.children[0].className = \"bi bi-circle-fill\";\r\n                WNP.r.btnPlay.disabled = true;\r\n            };\r\n            if (msg.CurrentTransportState === \"PLAYING\") {\r\n                // Radio live streams are preferrentialy stopped as pausing keeps cache for minutes/hours(?).\r\n                // Stop > Play resets the stream to 'now'. Pause works like 'live tv time shift'.\r\n                if (msg.PlayMedium && msg.PlayMedium === \"RADIO-NETWORK\") {\r\n                    WNP.r.btnPlay.children[0].className = \"bi bi-stop-circle-fill\";\r\n                    WNP.r.btnPlay.setAttribute(\"wnp-action\", \"Stop\");\r\n                }\r\n                else {\r\n                    WNP.r.btnPlay.children[0].className = \"bi bi-pause-circle-fill\";\r\n                    WNP.r.btnPlay.setAttribute(\"wnp-action\", \"Pause\");\r\n                }\r\n                WNP.r.btnPlay.disabled = false;\r\n            }\r\n            else if (msg.CurrentTransportState === \"PAUSED_PLAYBACK\" || msg.CurrentTransportState === \"STOPPED\") {\r\n                WNP.r.btnPlay.children[0].className = \"bi bi-play-circle-fill\";\r\n                WNP.r.btnPlay.setAttribute(\"wnp-action\", \"Play\");\r\n                WNP.r.btnPlay.disabled = false;\r\n            };\r\n            WNP.d.prevTransportState = msg.CurrentTransportState; // Remember the last transport state\r\n            WNP.d.prevPlayMedium = msg.PlayMedium; // Remember the last PlayMedium\r\n        }\r\n\r\n        // If internet radio, there is no skipping... just start and stop!\r\n        if (msg.PlayMedium && msg.PlayMedium === \"RADIO-NETWORK\") {\r\n            WNP.r.btnPrev.disabled = true;\r\n            WNP.r.btnNext.disabled = true;\r\n        }\r\n        else {\r\n            WNP.r.btnPrev.disabled = false;\r\n            WNP.r.btnNext.disabled = false;\r\n        }\r\n\r\n    });\r\n\r\n    // On metadata\r\n    socket.on(\"metadata\", function (msg) {\r\n        if (!msg) { return false; }\r\n\r\n        // Source detection\r\n        var playMedium = (msg.PlayMedium) ? msg.PlayMedium : \"\";\r\n        var trackSource = (msg.TrackSource) ? msg.TrackSource : \"\";\r\n        var sourceIdent = WNP.getSourceIdent(playMedium, trackSource);\r\n        // Did the source ident change...?\r\n        if (sourceIdent !== WNP.d.prevSourceIdent) {\r\n            if (sourceIdent !== \"\") {\r\n                var identImg = document.createElement(\"img\");\r\n                identImg.src = sourceIdent;\r\n                identImg.alt = playMedium + \": \" + trackSource;\r\n                identImg.title = playMedium + \": \" + trackSource;\r\n                mediaSource.innerHTML = identImg.outerHTML;\r\n            }\r\n            else {\r\n                mediaSource.innerText = playMedium + \": \" + trackSource;\r\n            }\r\n            WNP.d.prevSourceIdent = sourceIdent; // Remember the last Source Ident\r\n        }\r\n\r\n        // Song Title, Subtitle, Artist, Album\r\n        WNP.r.mediaTitle.innerText = (msg.trackMetaData && msg.trackMetaData[\"dc:title\"]) ? msg.trackMetaData[\"dc:title\"] : \"\";\r\n        WNP.r.mediaSubTitle.innerText = (msg.trackMetaData && msg.trackMetaData[\"dc:subtitle\"]) ? msg.trackMetaData[\"dc:subtitle\"] : \"\";\r\n        WNP.r.mediaArtist.innerText = (msg.trackMetaData && msg.trackMetaData[\"upnp:artist\"]) ? msg.trackMetaData[\"upnp:artist\"] : \"\";\r\n        WNP.r.mediaAlbum.innerText = (msg.trackMetaData && msg.trackMetaData[\"upnp:album\"]) ? msg.trackMetaData[\"upnp:album\"] : \"\";\r\n        if (playMedium === \"SONGLIST-NETWORK\" && !trackSource && msg.CurrentTransportState === \"STOPPED\") {\r\n            WNP.r.mediaTitle.innerText = \"No Music Selected\";\r\n        }\r\n        var trackChanged = false;\r\n        var currentTrackInfo = WNP.r.mediaTitle.innerText + \"|\" + WNP.r.mediaSubTitle.innerText + \"|\" + WNP.r.mediaArtist.innerText + \"|\" + WNP.r.mediaAlbum.innerText;\r\n        if (WNP.d.prevTrackInfo !== currentTrackInfo) {\r\n            trackChanged = true;\r\n            WNP.d.prevTrackInfo = currentTrackInfo; // Remember the last track info\r\n            console.log(\"WNP\", \"Track changed:\", currentTrackInfo);\r\n        }\r\n\r\n        // Audio quality\r\n        var songBitrate = (msg.trackMetaData && msg.trackMetaData[\"song:bitrate\"]) ? msg.trackMetaData[\"song:bitrate\"] : \"\";\r\n        var songBitDepth = (msg.trackMetaData && msg.trackMetaData[\"song:format_s\"]) ? msg.trackMetaData[\"song:format_s\"] : \"\";\r\n        var songSampleRate = (msg.trackMetaData && msg.trackMetaData[\"song:rate_hz\"]) ? msg.trackMetaData[\"song:rate_hz\"] : \"\";\r\n        WNP.r.mediaBitRate.innerText = (songBitrate > 0) ? ((songBitrate > 1000) ? (songBitrate / 1000).toFixed(2) + \" mbps, \" : songBitrate + \" kbps, \") : \"\";\r\n        WNP.r.mediaBitDepth.innerText = (songBitDepth > 0) ? ((songBitDepth > 24) ? \"24 bit/\" : songBitDepth + \" bit/\") : \"\"; // TODO: 32 bits is suspect according to the WiiM app?\r\n        WNP.r.mediaSampleRate.innerText = (songSampleRate > 0) ? (songSampleRate / 1000).toFixed(1) + \" kHz\" : \"\";\r\n        if (!songBitrate && !songBitDepth && !songSampleRate) {\r\n            WNP.r.mediaQualityIdent.style.display = \"none\";\r\n        }\r\n        else {\r\n            WNP.r.mediaQualityIdent.style.display = \"inline-block\";\r\n        }\r\n\r\n        // Audio quality ident badge (HD/Hi-res/CD/...)\r\n        var songQuality = (msg.trackMetaData && msg.trackMetaData[\"song:quality\"]) ? msg.trackMetaData[\"song:quality\"] : \"\";\r\n        var songActualQuality = (msg.trackMetaData && msg.trackMetaData[\"song:actualQuality\"]) ? msg.trackMetaData[\"song:actualQuality\"] : \"\";\r\n        var qualiIdent = WNP.getQualityIdent(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\r\n        if (qualiIdent !== \"\") {\r\n            WNP.r.mediaQualityIdent.innerText = qualiIdent;\r\n            WNP.r.mediaQualityIdent.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\r\n        }\r\n        else {\r\n            var identId = document.createElement(\"i\");\r\n            identId.className = \"bi bi-soundwave text-secondary\";\r\n            identId.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\r\n            WNP.r.mediaQualityIdent.innerHTML = identId.outerHTML;\r\n        }\r\n\r\n        // Pre-process Album Art uri, if any is available from the metadata.\r\n        var albumArtUri = WNP.checkAlbumArtURI((msg.trackMetaData && msg.trackMetaData[\"upnp:albumArtURI\"]) ? msg.trackMetaData[\"upnp:albumArtURI\"] : \"\", msg.metadataTimeStamp);\r\n\r\n        // Set Album Art, only if the track changed and the URI changed\r\n        if (trackChanged && WNP.r.albumArt.src != albumArtUri) {\r\n            WNP.setAlbumArt(albumArtUri);\r\n        }\r\n\r\n        // Device volume\r\n        WNP.r.devVol.innerText = (msg.CurrentVolume) ? msg.CurrentVolume : \"-\";\r\n\r\n        // Loop mode status\r\n        if (msg.LoopMode) {\r\n            switch (msg.LoopMode) {\r\n                case \"5\": // repeat-1 | shuffle\r\n                    WNP.r.btnRepeat.className = \"btn btn-outline-success\";\r\n                    WNP.r.btnRepeat.children[0].className = \"bi bi-repeat-1\";\r\n                    WNP.r.btnShuffle.className = \"btn btn-outline-success\";\r\n                    break;\r\n                case \"3\": // no repeat | shuffle\r\n                    WNP.r.btnRepeat.className = \"btn btn-outline-light\";\r\n                    WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\r\n                    WNP.r.btnShuffle.className = \"btn btn-outline-success\";\r\n                    break;\r\n                case \"2\": // repeat | shuffle\r\n                    WNP.r.btnRepeat.className = \"btn btn-outline-success\";\r\n                    WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\r\n                    WNP.r.btnShuffle.className = \"btn btn-outline-success\";\r\n                    break;\r\n                case \"1\": // repeat-1 | no shuffle\r\n                    WNP.r.btnRepeat.className = \"btn btn-outline-success\";\r\n                    WNP.r.btnRepeat.children[0].className = \"bi bi-repeat-1\";\r\n                    WNP.r.btnShuffle.className = \"btn btn-outline-light\";\r\n                    // change repeat icon\r\n                    break;\r\n                case \"0\": // repeat | no shuffle\r\n                    WNP.r.btnRepeat.className = \"btn btn-outline-success\";\r\n                    WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\r\n                    WNP.r.btnShuffle.className = \"btn btn-outline-light\";\r\n                    break;\r\n                default: // no repeat | no shuffle #4\r\n                    WNP.r.btnRepeat.className = \"btn btn-outline-light\";\r\n                    WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\r\n                    WNP.r.btnShuffle.className = \"btn btn-outline-light\";\r\n            }\r\n        }\r\n        else { // Unknown, so set default\r\n            WNP.r.btnRepeat.className = \"btn btn-outline-light\";\r\n            WNP.r.btnRepeat.children[0].className = \"bi bi-repeat\";\r\n            WNP.r.btnShuffle.className = \"btn btn-outline-light\";\r\n        }\r\n\r\n    });\r\n\r\n    // On device set\r\n    socket.on(\"device-set\", function (msg) {\r\n        // Device switch? Fetch settings and device info again.\r\n        socket.emit(\"server-settings\");\r\n        socket.emit(\"devices-get\");\r\n    });\r\n\r\n    // On device refresh\r\n    socket.on(\"devices-refresh\", function (msg) {\r\n        WNP.r.selDeviceChoices.innerHTML = \"<option disabled=\\\"disabled\\\">Waiting for devices...</em></li>\";\r\n    });\r\n\r\n};\r\n\r\n// =======================================================\r\n// Helper functions\r\n\r\n/**\r\n * Get player progress helper.\r\n * @param {string} relTime - Time elapsed while playing, format 00:00:00\r\n * @param {string} trackDuration - Total play time, format 00:00:00\r\n * @param {integer} timeStampDiff - Possible play time offset in seconds\r\n * @param {string} currentTransportState - The current transport state \"PLAYING\" or otherwise\r\n * @returns {object} An object with corrected played, left, total and percentage played\r\n */\r\nWNP.getPlayerProgress = function (relTime, trackDuration, timeStampDiff, currentTransportState) {\r\n    var relTimeSec = this.convertToSeconds(relTime) + timeStampDiff;\r\n    var trackDurationSec = this.convertToSeconds(trackDuration);\r\n    if (trackDurationSec > 0 && relTimeSec < trackDurationSec) {\r\n        // var percentPlayed = Math.floor((relTimeSec / trackDurationSec) * 100);\r\n        var percentPlayed = ((relTimeSec / trackDurationSec) * 100).toFixed(1);\r\n        return {\r\n            played: WNP.convertToMinutes(relTimeSec),\r\n            left: WNP.convertToMinutes(trackDurationSec - relTimeSec),\r\n            total: WNP.convertToMinutes(trackDurationSec),\r\n            percent: percentPlayed\r\n        };\r\n    }\r\n    else if (trackDurationSec == 0 && currentTransportState == \"PLAYING\") {\r\n        return {\r\n            played: \"Live\",\r\n            left: \"\",\r\n            total: \"\",\r\n            percent: 100\r\n        };\r\n    }\r\n    else {\r\n        return {\r\n            played: \"Paused\",\r\n            left: \"\",\r\n            total: \"\",\r\n            percent: 0\r\n        };\r\n    };\r\n};\r\n\r\n/**\r\n * Convert time format '00:00:00' to total number of seconds.\r\n * @param {string} sDuration - Time, format 00:00:00.\r\n * @returns {integer} The number of seconds that the string represents.\r\n */\r\nWNP.convertToSeconds = function (sDuration) {\r\n    const timeSections = sDuration.split(\":\");\r\n    let totalSeconds = 0;\r\n    for (let i = 0; i < timeSections.length; i++) {\r\n        var nFactor = timeSections.length - 1 - i; // Count backwards\r\n        var nMultiplier = Math.pow(60, nFactor); // 60^n\r\n        totalSeconds += nMultiplier * parseInt(timeSections[i]); // Calculate the seconds\r\n    }\r\n    return totalSeconds\r\n};\r\n\r\n/**\r\n * Convert number of seconds to '00:00' string format. \r\n * Sorry for those hour+ long songs...\r\n * @param {integer} seconds - Number of seconds total.\r\n * @returns {string} The string representation of seconds in minutes, format 00:00.\r\n */\r\nWNP.convertToMinutes = function (seconds) {\r\n    var tempDate = new Date(0);\r\n    tempDate.setSeconds(seconds);\r\n    var result = tempDate.toISOString().substring(14, 19);\r\n    return result;\r\n};\r\n\r\n/**\r\n * Check if the album art is a valid URI. Returns the URI if valid, otherwise a random URI.\r\n * Error handling is handled by the onerror event on the image itself.\r\n * @param {string} sAlbumArtUri - The URI of the album art.\r\n * @param {integer} nTimestamp - The time in milliseconds, used as cache buster.\r\n * @returns {string} The URI of the album art.\r\n */\r\nWNP.checkAlbumArtURI = function (sAlbumArtUri, nTimestamp) {\r\n    // If the URI starts with https, the self signed certificate may not trusted by the browser.\r\n    // Hence we always try and load the image through a reverse proxy, ignoring the certificate.\r\n    if (sAlbumArtUri && sAlbumArtUri.startsWith(\"https\")) {\r\n        if (WNP.s.locPort != \"80\") { // If the server is not running on port 80, we need to add the port to the URI\r\n            return \"http://\" + WNP.s.locHostname + \":\" + WNP.s.locPort + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\r\n        } else {\r\n            return \"http://\" + WNP.s.locHostname + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\r\n        }\r\n    } else if (sAlbumArtUri && sAlbumArtUri.startsWith(\"http\")) {\r\n        return sAlbumArtUri;\r\n    } else {\r\n        // If not, use the random album art URI\r\n        return WNP.s.rndAlbumArtUri;\r\n    }\r\n};\r\n\r\n/**\r\n * Sets the album art. Both on the foreground and background.\r\n * @param {integer} imgUri - The URI of the album art.\r\n * @returns {undefined}\r\n */\r\nWNP.setAlbumArt = function (imgUri) {\r\n    console.log(\"WNP\", \"Set Album Art\", imgUri);\r\n    this.r.albumArt.src = imgUri;\r\n    this.r.bgAlbumArtBlur.style.backgroundImage = \"url('\" + imgUri + \"')\";\r\n};\r\n\r\n/**\r\n * Come up with a random album art URI (locally from the img folder).\r\n * @param {string} prefix - The prefix for the album art URI, i.e. 'fake-album-'\r\n * @returns {string} An URI for album art\r\n */\r\nWNP.rndAlbumArt = function (prefix) {\r\n    return \"./img/\" + prefix + this.rndNumber(1, 16) + \".jpg\";\r\n};\r\n\r\n/**\r\n * Get a random number between min and max, including min and max.\r\n * @param {integer} min - Minimum number to pick, keep it lower than max.\r\n * @param {integer} max - Maximum number to pick.\r\n * @returns {integer} The random number\r\n */\r\nWNP.rndNumber = function (min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n};\r\n\r\n/**\r\n * Get an identifier for the current play medium combined with the tracksource.\r\n * TODO: Verify all/most sources...\r\n * @param {string} playMedium - The PlayMedium as indicated by the device. Values: SONGLIST-NETWORK, RADIO-NETWORK, STATION-NETWORK, CAST, AIRPLAY, SPOTIFY, UNKOWN\r\n * @param {string} trackSource - The stream source as indicated by the device. Values: Prime, Qobuz, SPOTIFY, newTuneIn, iHeartRadio, Deezer, UPnPServer, Tidal, vTuner\r\n * @returns {string} The uri to the source identifier (image url)\r\n */\r\nWNP.getSourceIdent = function (playMedium, trackSource) {\r\n\r\n    var sIdentUri = \"\";\r\n\r\n    switch (playMedium.toLowerCase()) {\r\n        case \"airplay\":\r\n            sIdentUri = \"./img/sources/airplay2.png\";\r\n            break;\r\n        case \"third-dlna\":\r\n            sIdentUri = \"./img/sources/dlna2.png\";\r\n            break;\r\n        case \"cast\":\r\n            sIdentUri = \"./img/sources/chromecast2.png\";\r\n            break;\r\n        case \"radio-network\":\r\n            sIdentUri = \"./img/sources/radio.png\";\r\n            break;\r\n        case \"songlist-network\":\r\n            sIdentUri = \"./img/sources/ethernet2.png\";\r\n            break;\r\n        case \"spotify\":\r\n            sIdentUri = \"./img/sources/spotify.png\";\r\n            break;\r\n        case \"squeezelite\":\r\n            sIdentUri = \"./img/sources/music-assistant2.png\";\r\n            break;\r\n        case \"none\":\r\n            sIdentUri = \"./img/sources/none2.png\";\r\n            break;\r\n        case \"bluetooth\":\r\n            sIdentUri = \"./img/sources/bluetooth2.png\";\r\n            break;\r\n        case \"hdmi\":\r\n            sIdentUri = \"./img/sources/hdmi2.png\";\r\n            break;\r\n        case \"line-in\":\r\n            sIdentUri = \"./img/sources/line-in2.png\";\r\n            break;\r\n        case \"optical\":\r\n            sIdentUri = \"./img/sources/spdif2.png\";\r\n            break;\r\n    };\r\n\r\n    switch (trackSource.toLowerCase()) {\r\n        case \"deezer\":\r\n        case \"deezer2\":\r\n            sIdentUri = \"./img/sources/deezer.png\";\r\n            break;\r\n        case \"iheartradio\":\r\n            sIdentUri = \"./img/sources/iheart.png\";\r\n            break;\r\n        case \"newtunein\":\r\n            sIdentUri = \"./img/sources/newtunein.png\";\r\n            break;\r\n        case \"plex\":\r\n            sIdentUri = \"./img/sources/plex.png\";\r\n            break;\r\n        case \"prime\":\r\n            sIdentUri = \"./img/sources/amazon-music2.png\";\r\n            break;\r\n        case \"qobuz\":\r\n            sIdentUri = \"./img/sources/qobuz2.png\";\r\n            break;\r\n        case \"tidal\":\r\n            sIdentUri = \"./img/sources/tidal2.png\";\r\n            break;\r\n        case \"upnpserver\":\r\n            sIdentUri = \"./img/sources/dlna2.png\";\r\n            break;\r\n        case \"vtuner\":\r\n            sIdentUri = \"./img/sources/vtuner2.png\";\r\n            break;\r\n    };\r\n\r\n    return sIdentUri;\r\n\r\n};\r\n\r\n/**\r\n * Get an identifier for the current audio/song quality.\r\n * TODO: Verify all/most sources...\r\n * Found so far:\r\n * \r\n * CD Quality: 44.1 KHz/16 bit. Bitrate 1,411 kbps. For mp3 bitrate can vary, but also be 320/192/160/128/... kbps.\r\n * Hi-Res quality: 96 kHz/24 bit and up. Bitrate 9,216 kbps.\r\n * \r\n * Spotify and Pandora usual bitrate 160 kbps, premium is 320 kbps\r\n * Tidal has CD quality, and FLAC, MQA, Master, ...\r\n * Qobuz apparently really has hi-res?\r\n * Amazon Music (Unlimited) does Atmos?\r\n * Apple Music -> Airplay 2, does hi-res?\r\n * YouTube Music -> Cast, does what?\r\n * \r\n * TIDAL -\r\n * Sample High: \"song:quality\":\"2\",\"song:actualQuality\":\"LOSSLESS\"\r\n * Sample MQA: \"song:quality\":\"3\",\"song:actualQuality\":\"HI_RES\"\r\n * Sample FLAC: \"song:quality\":\"4\",\"song:actualQuality\":\"HI_RES_LOSSLESS\"\r\n * \r\n * @param {integer} songQuality - A number identifying the quality, as indicated by the streaming service(?).\r\n * @param {string} songActualQuality - An indicator for the actual quality, as indicated by the streaming service(?).\r\n * @param {integer} songBitrate - The current bitrate in kilobit per second.\r\n * @param {integer} songBitDepth - The current sample depth in bits.\r\n * @param {integer} songSampleRate - The current sample rate in Hz.\r\n * @returns {string} The identifier for the audio quality, just a string.\r\n */\r\nWNP.getQualityIdent = function (songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate) {\r\n    // console.log(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\r\n\r\n    var sIdent = \"\";\r\n\r\n    if (songBitrate > 1000 && songBitDepth === 16 && songSampleRate === 44100) {\r\n        sIdent = \"CD\";\r\n    }\r\n    else if (songBitrate > 7000 && songBitDepth >= 24 && songSampleRate >= 96000) {\r\n        sIdent = \"Hi-Res\";\r\n    }\r\n\r\n    // Based of Tidal/Amazon Music Unlimited/Deezer/Qobuz\r\n    switch (songQuality + \":\" + songActualQuality) {\r\n        case \"2:LOSSLESS\": // Tidal\r\n        case \":LOSSLESS\": // Tidal\r\n            sIdent = \"HIGH\";\r\n            break;\r\n        case \"3:HI_RES\": // Tidal\r\n            sIdent = \"MQA\";\r\n            break;\r\n        case \"4:HI_RES_LOSSLESS\": // Tidal\r\n        case \":HI_RES_LOSSLESS\": // Tidal\r\n        case \"0:LOSSLESS\": // Deezer\r\n            sIdent = \"FLAC\";\r\n            break;\r\n        case \":UHD\": // Amazon Music\r\n            sIdent = \"ULTRA HD\";\r\n            break;\r\n        case \":HD\":\r\n            sIdent = \"HD\"; // Amazon Music\r\n            break;\r\n        case \"3:7\":\r\n        case \"4:27\":\r\n            sIdent = \"Hi-Res\"; // Qobuz\r\n            break;\r\n        case \"2:6\":\r\n            sIdent = \"CD\"; // Qobuz\r\n            break;\r\n    };\r\n\r\n    return sIdent;\r\n\r\n};\r\n\r\n// =======================================================\r\n// Start WiiM Now Playing app\r\nWNP.Init();\r\n"],"names":["window","WNP","s","locHostname","location","hostname","locPort","port","rndAlbumArtUri","aDeviceUI","aServerUI","d","serverSettings","deviceList","prevTransportState","prevPlayMedium","prevSourceIdent","prevTrackInfo","r","Init","console","log","socket","io","connect","setUIReferences","setSocketDefinitions","setUIListeners","setTimeout","emit","rndAlbumArt","setInterval","addElementToRef","id","element","document","getElementById","warn","forEach","btnPrev","addEventListener","wnpAction","getAttribute","disabled","btnPlay","btnNext","btnDevSelect","btnDevVolume","btnRefresh","selDeviceChoices","value","btnReboot","btnUpdate","btnShutdown","btnReloadUI","reload","on","msg","os","userInfo","shell","selectedDevice","friendlyName","devName","innerText","sUrl","toLowerCase","sServerUrlHostname","children","innerHTML","networkInterfaces","aIpAddress","sLocationIp","split","pop","sIpPattern","join","Object","keys","key","index","sIpFound","find","addr","address","startsWith","sServerUrlIP","sServerVersion","version","server","sClientVersion","client","sort","a","b","devicesWiiM","filter","manufacturer","length","optGroup","createElement","label","device","opt","title","setAttribute","appendChild","devicesOther","timeStampDiff","CurrentTransportState","stateTimeStamp","metadataTimeStamp","Math","round","relTime","RelTime","trackDuration","TrackDuration","playerProgress","getPlayerProgress","progressPlayed","played","progressLeft","left","progressPercent","percent","PlayMedium","className","playMedium","trackSource","TrackSource","sourceIdent","getSourceIdent","identImg","src","alt","mediaSource","outerHTML","mediaTitle","trackMetaData","mediaSubTitle","mediaArtist","mediaAlbum","trackChanged","currentTrackInfo","songBitrate","songBitDepth","songSampleRate","mediaBitRate","toFixed","mediaBitDepth","mediaSampleRate","mediaQualityIdent","style","display","songQuality","songActualQuality","qualiIdent","getQualityIdent","identId","albumArtUri","checkAlbumArtURI","albumArt","setAlbumArt","devVol","CurrentVolume","LoopMode","btnRepeat","btnShuffle","currentTransportState","relTimeSec","convertToSeconds","trackDurationSec","percentPlayed","convertToMinutes","total","sDuration","timeSections","totalSeconds","i","nMultiplier","pow","parseInt","seconds","tempDate","Date","setSeconds","toISOString","substring","sAlbumArtUri","nTimestamp","encodeURIComponent","imgUri","bgAlbumArtBlur","backgroundImage","prefix","rndNumber","min","max","floor","random","sIdentUri","sIdent"],"version":3,"file":"client.f5252d48.js.map"}